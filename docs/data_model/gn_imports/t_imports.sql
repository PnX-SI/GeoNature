
CREATE TABLE gn_imports.t_imports (
    id_import integer NOT NULL,
    format_source_file character varying(10),
    srid integer,
    separator character varying,
    encoding character varying,
    full_file_name character varying(255),
    id_dataset integer,
    date_create_import timestamp without time zone DEFAULT now(),
    date_update_import timestamp without time zone DEFAULT now(),
    date_end_import timestamp without time zone,
    source_count integer,
    uuid_autogenerated boolean,
    altitude_autogenerated boolean,
    date_min_data timestamp without time zone,
    date_max_data timestamp without time zone,
    processed boolean DEFAULT false NOT NULL,
    need_fix boolean DEFAULT false,
    fix_comment text,
    detected_encoding character varying,
    source_file bytea,
    columns character varying[],
    fieldmapping json,
    contentmapping json,
    detected_separator character varying,
    task_id character varying(155),
    erroneous_rows integer[],
    loaded boolean DEFAULT false NOT NULL,
    id_destination integer NOT NULL,
    statistics json DEFAULT '{}'::jsonb NOT NULL
);

CREATE SEQUENCE gn_imports.t_imports_id_import_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;

ALTER SEQUENCE gn_imports.t_imports_id_import_seq OWNED BY gn_imports.t_imports.id_import;

ALTER TABLE ONLY gn_imports.t_imports
    ADD CONSTRAINT pk_gn_imports_t_imports PRIMARY KEY (id_import);

ALTER TABLE ONLY gn_imports.t_imports
    ADD CONSTRAINT fk_gn_meta_t_datasets FOREIGN KEY (id_dataset) REFERENCES gn_meta.t_datasets(id_dataset) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE ONLY gn_imports.t_imports
    ADD CONSTRAINT t_imports_id_destination_fkey FOREIGN KEY (id_destination) REFERENCES gn_imports.bib_destinations(id_destination) ON DELETE RESTRICT;

