

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>INSTALLATION AUTONOME &mdash; GeoNature 2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SPECIFICITES DEPOBIO" href="installation-mtes.html" />
    <link rel="prev" title="INSTALLATION GLOBALE" href="installation-all.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html" class="icon icon-home"> GeoNature
          

          
            
            <img src="_static/LogoGeonature.jpg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation-all.html">INSTALLATION GLOBALE</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">INSTALLATION AUTONOME</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequis">Prérequis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparation-du-serveur">Préparation du serveur</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#python-3-7-sur-debian-9">Python 3.7 sur Debian 9</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation-de-l-application">Installation de l’application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creation-de-la-base-de-donnees">Création de la base de données</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Installation de l’application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-apache">Configuration Apache</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dependances">Dépendances</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mise-a-jour-de-l-application">Mise à jour de l’application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#passer-en-mode-developpement">Passer en mode développement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation-mtes.html">SPECIFICITES DEPOBIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-manual.html">MANUEL UTILISATEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin-manual.html">MANUEL ADMINISTRATEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="import-level-1.html">IMPORT NIVEAU 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="import-level-2.html">IMPORT NIVEAU 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">DEVELOPPEMENT</a></li>
<li class="toctree-l1"><a class="reference internal" href="versions-compatibility.html">COMPATIBILITE</a></li>
<li class="toctree-l1"><a class="reference internal" href="conf-apache.html">CONFIGURATION APACHE</a></li>
<li class="toctree-l1"><a class="reference internal" href="https.html">HTTPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">AUTEURS</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">CHANGELOG</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GeoNature</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>INSTALLATION AUTONOME</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/installation-standalone.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation-autonome">
<h1>INSTALLATION AUTONOME<a class="headerlink" href="#installation-autonome" title="Permalink to this headline">¶</a></h1>
<p><strong>Attention</strong> : Ne suivez cette documentation que si vous souhaitez installer GeoNature de manière autonome (sans TaxHub ou UsersHub).
Pour une installation packagée voir cette <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/install_all/docs/installation-all.rst">documentation</a>.</p>
<div class="section" id="prerequis">
<h2>Prérequis<a class="headerlink" href="#prerequis" title="Permalink to this headline">¶</a></h2>
<p>Ressources minimum serveur :</p>
<ul class="simple">
<li>Un serveur Linux <strong>architecture 64-bits</strong> disposant d’au moins de 4 Go RAM et de 20 Go d’espace disque.</li>
</ul>
<p>GeoNature utilise les technologies suivantes:</p>
<ul class="simple">
<li>PostgreSQL / PostGIS</li>
<li>Python 3 et dépendances Python nécessaires à l’application</li>
<li>Flask (framework web Python)</li>
<li>Apache</li>
<li>Angular 7, Angular CLI, NodeJS</li>
<li>Librairies javascript (Leaflet, ChartJS)</li>
<li>Librairies CSS (Bootstrap, Material Design)</li>
</ul>
</div>
<div class="section" id="preparation-du-serveur">
<h2>Préparation du serveur<a class="headerlink" href="#preparation-du-serveur" title="Permalink to this headline">¶</a></h2>
<p>Commencer la procédure en se connectant au serveur en SSH avec l’utilisateur linux <code class="docutils literal"><span class="pre">root</span></code>.</p>
<ul>
<li><p class="first">Mettre à jour de la liste des dépôts Linux :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">upgrade</span>
</pre></div>
</div>
</li>
<li><p class="first">Créer un utilisateur linux (nommé <code class="docutils literal"><span class="pre">geonatureadmin</span></code> dans notre cas) pour ne pas travailler en <code class="docutils literal"><span class="pre">root</span></code> :</p>
</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">adduser</span> <span class="n">geonatureadmin</span>
</pre></div>
</div>
<ul class="simple">
<li>Lui donner ensuite des droits <code class="docutils literal"><span class="pre">sudo</span></code> :</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">adduser</span> <span class="n">geonatureadmin</span> <span class="n">sudo</span>
</pre></div>
</div>
<ul>
<li><p class="first">Se reconnecter en SSH au serveur avec le nouvel utilisateur pour ne pas faire l’installation en <code class="docutils literal"><span class="pre">root</span></code>. On ne se connectera plus en <code class="docutils literal"><span class="pre">root</span></code>. Si besoin d’éxecuter des commandes avec des droits d’administrateur, on les précède de <code class="docutils literal"><span class="pre">sudo</span></code>. Il est d’ailleurs possible renforcer la sécurité du serveur en bloquant la connexion SSH au serveur avec root. Voir <a class="reference external" href="https://docs.ovh.com/fr/vps/conseils-securisation-vps/">https://docs.ovh.com/fr/vps/conseils-securisation-vps/</a> pour plus d’informations sur le sécurisation du serveur.</p>
</li>
<li><p class="first">Lancez les commandes suivantes pour installer les dépendances de GeoNature (Debian 10) :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">wget</span> <span class="n">git</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">postgresql</span> <span class="n">postgis</span> <span class="n">postgresql</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="mi">11</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">postgis</span><span class="o">-</span><span class="mf">2.5</span> <span class="n">postgis</span> <span class="n">postgresql</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="n">postgis</span><span class="o">-</span><span class="mf">2.5</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span> <span class="n">python3</span><span class="o">-</span><span class="n">dev</span> <span class="n">python3</span><span class="o">-</span><span class="n">setuptools</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span> <span class="n">libpq</span><span class="o">-</span><span class="n">dev</span> <span class="n">libgdal</span><span class="o">-</span><span class="n">dev</span> <span class="n">python</span><span class="o">-</span><span class="n">gdal</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">python3</span><span class="o">-</span><span class="n">wheel</span> <span class="n">python3</span><span class="o">-</span><span class="n">cffi</span> <span class="n">libcairo2</span> <span class="n">libpango</span><span class="o">-</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">0</span> <span class="n">libpangocairo</span><span class="o">-</span><span class="mf">1.0</span><span class="o">-</span><span class="mi">0</span> <span class="n">libgdk</span><span class="o">-</span><span class="n">pixbuf2</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span> <span class="n">libffi</span><span class="o">-</span><span class="n">dev</span> <span class="n">shared</span><span class="o">-</span><span class="n">mime</span><span class="o">-</span><span class="n">info</span>
<span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">pip</span><span class="o">==</span><span class="mf">20.0</span><span class="o">.</span><span class="mi">2</span>
<span class="n">pip3</span> <span class="n">install</span> <span class="n">virtualenv</span><span class="o">==</span><span class="mf">20.0</span><span class="o">.</span><span class="mi">1</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">supervisor</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">apache2</span>
<span class="c1"># installation de NVM</span>
<span class="n">wget</span> <span class="o">-</span><span class="n">qO</span><span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">creationix</span><span class="o">/</span><span class="n">nvm</span><span class="o">/</span><span class="n">v0</span><span class="o">.</span><span class="mf">33.6</span><span class="o">/</span><span class="n">install</span><span class="o">.</span><span class="n">sh</span> <span class="o">|</span> <span class="n">bash</span>

<span class="n">export</span> <span class="n">NVM_DIR</span><span class="o">=</span><span class="s2">&quot;$HOME/.nvm&quot;</span>
<span class="p">[</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> \<span class="o">.</span> <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span>  <span class="c1"># This loads nvm</span>
<span class="p">[</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&quot;$NVM_DIR/bash_completion&quot;</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> \<span class="o">.</span> <span class="s2">&quot;$NVM_DIR/bash_completion&quot;</span>  <span class="c1"># This loads nvm bash_completion</span>
</pre></div>
</div>
</li>
</ul>
<p>Sur Ubuntu 18, installez la version 10 de postgresql-server-dev avec la commande <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">postgresql-server-dev-10</span></code>. La version est à adapter sur les autres versions de Debian ou Ubuntu.</p>
<div class="section" id="python-3-7-sur-debian-9">
<h3>Python 3.7 sur Debian 9<a class="headerlink" href="#python-3-7-sur-debian-9" title="Permalink to this headline">¶</a></h3>
<p>A partir la version 2.5.0 de GeoNature, la version Python 3.5 n’est plus supportée. Seules les version 3.6+ le sont.</p>
<p>Si vous êtes encore sur Debian 9 (fourni par défaut avec Python 3.5), veuillez suivre les instructions suivantes pour monter la version de Python sur Debian 9 :</p>
<p>Installer <code class="docutils literal"><span class="pre">pyenv</span></code> (utilitaire pour installer différentes versions de Python)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">upgrade</span>

<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">libssl</span><span class="o">-</span><span class="n">dev</span> <span class="n">zlib1g</span><span class="o">-</span><span class="n">dev</span> <span class="n">libbz2</span><span class="o">-</span><span class="n">dev</span> \
<span class="n">libreadline</span><span class="o">-</span><span class="n">dev</span> <span class="n">libsqlite3</span><span class="o">-</span><span class="n">dev</span> <span class="n">wget</span> <span class="n">curl</span> <span class="n">llvm</span> <span class="n">libncurses5</span><span class="o">-</span><span class="n">dev</span> <span class="n">libncursesw5</span><span class="o">-</span><span class="n">dev</span> \
<span class="n">xz</span><span class="o">-</span><span class="n">utils</span> <span class="n">tk</span><span class="o">-</span><span class="n">dev</span> <span class="n">libffi</span><span class="o">-</span><span class="n">dev</span> <span class="n">liblzma</span><span class="o">-</span><span class="n">dev</span> <span class="n">python</span><span class="o">-</span><span class="n">openssl</span> <span class="n">git</span>

<span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pyenv</span><span class="o">.</span><span class="n">run</span> <span class="o">|</span> <span class="n">bash</span>

<span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;$HOME/.pyenv/bin:$PATH&quot;</span>
<span class="nb">eval</span> <span class="s2">&quot;$(pyenv init -)&quot;</span>
<span class="nb">eval</span> <span class="s2">&quot;$(pyenv virtualenv-init -)&quot;</span>
</pre></div>
</div>
<p>Installer Python 3.7.9 :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pyenv</span> <span class="n">install</span> <span class="mf">3.7</span><span class="o">.</span><span class="mi">9</span>
<span class="n">pyenv</span> <span class="k">global</span> <span class="mf">3.7</span><span class="o">.</span><span class="mi">9</span>
</pre></div>
</div>
<p>Editer ensuite le fichier <code class="docutils literal"><span class="pre">config/settings.ini</span></code> pour changer la variable <code class="docutils literal"><span class="pre">python_path</span></code> (remplacer &lt;MON_USER&gt; par votre utilisateur linux courant.
NB : faire pareil dans TaxHub et UsersHub.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">MON_USER</span><span class="o">&gt;/.</span><span class="n">pyenv</span><span class="o">/</span><span class="n">shims</span><span class="o">/</span><span class="n">python3</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="installation-de-l-application">
<h2>Installation de l’application<a class="headerlink" href="#installation-de-l-application" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Se placer dans le répertoire de l’utilisateur (<code class="docutils literal"><span class="pre">/home/geonatureadmin/</span></code> dans notre cas)</p>
</li>
<li><p class="first">Récupérer l’application (<code class="docutils literal"><span class="pre">X.Y.Z</span></code> à remplacer par le numéro de la <a class="reference external" href="https://github.com/PnX-SI/GeoNature/releases">dernière version stable de GeoNature</a>). Voir le <a class="reference external" href="versions-compatibility.rst">tableau de compatibilité</a> des versions de GeoNature avec ses dépendances.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">PnX</span><span class="o">-</span><span class="n">SI</span><span class="o">/</span><span class="n">GeoNature</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
</li>
<li><p class="first">Dézipper l’archive de l’application</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">unzip</span> <span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">zip</span>
<span class="n">rm</span> <span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
</li>
<li><p class="first">Renommer le répertoire de l’application puis placez-vous dedans :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mv GeoNature-X.Y.Z /home/`whoami`/geonature/
cd geonature
</pre></div>
</div>
</li>
<li><p class="first">Copier puis mettre à jour le fichier de configuration (<code class="docutils literal"><span class="pre">config/settings.ini</span></code>) comportant les informations relatives à votre environnement serveur :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">config</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">ini</span><span class="o">.</span><span class="n">sample</span> <span class="n">config</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">ini</span>
<span class="n">nano</span> <span class="n">config</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">ini</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="creation-de-la-base-de-donnees">
<h3>Création de la base de données<a class="headerlink" href="#creation-de-la-base-de-donnees" title="Permalink to this headline">¶</a></h3>
<p>Créer un utilisateur de base de données (cf <code class="docutils literal"><span class="pre">settings.ini</span></code>) :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">u</span> <span class="n">postgres</span> <span class="o">-</span><span class="n">s</span> <span class="n">psql</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;CREATE ROLE $user_pg WITH LOGIN PASSWORD &#39;$user_pg_pass&#39;;&quot;</span>
</pre></div>
</div>
<p>Pendant l’installation, vous serez invité à fournir le mot de passe <code class="docutils literal"><span class="pre">sudo</span></code> de votre utilisateur linux.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">install</span>
<span class="o">./</span><span class="n">install_db</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>Installation de l’application<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Lancer le script d’installation de l’application (depuis le répertoire <code class="docutils literal"><span class="pre">install</span></code>):</p>
<p>La commande <code class="docutils literal"><span class="pre">install_app.sh</span></code> comporte deux paramètres optionnels qui doivent être utilisés dans l’ordre :</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-s</span></code> ou <code class="docutils literal"><span class="pre">--settings-path</span></code> pour spécifier un autre emplacement pour le fichier <code class="docutils literal"><span class="pre">settings.ini</span></code></li>
<li><code class="docutils literal"><span class="pre">-d</span></code> ou <code class="docutils literal"><span class="pre">--dev</span></code> permet d’installer des dépendances python utile pour le développement de GeoNature et de ne pas compiler inutilement le frontend</li>
<li><code class="docutils literal"><span class="pre">-h</span></code> ou <code class="docutils literal"><span class="pre">--help</span></code> affiche l’aide pour cette commande <code class="docutils literal"><span class="pre">install_app.sh</span></code></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">touch</span> <span class="o">../</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">install_app</span><span class="o">.</span><span class="n">log</span>
<span class="o">./</span><span class="n">install_app</span><span class="o">.</span><span class="n">sh</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">tee</span> <span class="o">../</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">install_app</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>Pendant l’installation, vous serez invité à fournir le mot de passe <code class="docutils literal"><span class="pre">sudo</span></code> de votre utilisateur linux.</p>
<p><code class="docutils literal"><span class="pre">nvm</span></code> (node version manager) est utilisé pour installer les dernières versions de <code class="docutils literal"><span class="pre">node</span></code> et <code class="docutils literal"><span class="pre">npm</span></code>.</p>
<p>Une fois l’installation terminée, lancer cette commande pour ajouter <code class="docutils literal"><span class="pre">nvm</span></code> dans la path de votre serveur :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">NVM_DIR</span><span class="o">=</span><span class="s2">&quot;$HOME/.nvm&quot;</span>
<span class="p">[</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">.</span> <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-apache">
<h3>Configuration Apache<a class="headerlink" href="#configuration-apache" title="Permalink to this headline">¶</a></h3>
<p>Créer le fichier de configuration Apache de GeoNature</p>
<p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/apache2/sites-available/geonature.conf</span></code></p>
<p>Puis coller la configuration suivante:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Alias</span> <span class="o">/</span><span class="n">geonature</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">geonatureadmin</span><span class="o">/</span><span class="n">geonature</span><span class="o">/</span><span class="n">frontend</span><span class="o">/</span><span class="n">dist</span>
<span class="o">&lt;</span><span class="n">Directory</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">geonatureadmin</span><span class="o">/</span><span class="n">geonature</span><span class="o">/</span><span class="n">frontend</span><span class="o">/</span><span class="n">dist</span><span class="o">&gt;</span>
  <span class="n">Require</span> <span class="nb">all</span> <span class="n">granted</span>
<span class="o">&lt;/</span><span class="n">Directory</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Location</span> <span class="o">/</span><span class="n">geonature</span><span class="o">/</span><span class="n">api</span><span class="o">&gt;</span>
 <span class="n">ProxyPass</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span>
 <span class="n">ProxyPassReverse</span>  <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span>
<span class="o">&lt;/</span><span class="n">Location</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Activer les modules suivants:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">a2enmod</span> <span class="n">rewrite</span>
<span class="n">sudo</span> <span class="n">a2enmod</span> <span class="n">proxy</span>
<span class="n">sudo</span> <span class="n">a2enmod</span> <span class="n">proxy_http</span>
</pre></div>
</div>
<p>Activer la nouvelle configuration:</p>
<p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">a2ensite</span> <span class="pre">geonature.conf</span></code></p>
<p>et redémarrer Apache:</p>
<p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">apache2</span> <span class="pre">restart</span></code></p>
<p>L’application est disponible à l’adresse suivante :</p>
<ul class="simple">
<li><a class="reference external" href="http://monip.com/geonature">http://monip.com/geonature</a></li>
</ul>
<p>Editez ensuite le fichier de configuration Apache <code class="docutils literal"><span class="pre">/etc/apache2/sites-available/geonature.conf</span></code> en modifiant l’alias :</p>
<ul class="simple">
<li>Pour <code class="docutils literal"><span class="pre">/</span></code> : <code class="docutils literal"><span class="pre">Alias</span> <span class="pre">/</span> <span class="pre">/home/test/geonature/frontend/dist</span></code></li>
<li>Pour <code class="docutils literal"><span class="pre">/saisie</span></code>: <code class="docutils literal"><span class="pre">Alias</span> <span class="pre">/saisie</span> <span class="pre">/home/test/geonature/frontend/dist</span></code></li>
</ul>
</div>
</div>
<div class="section" id="dependances">
<h2>Dépendances<a class="headerlink" href="#dependances" title="Permalink to this headline">¶</a></h2>
<p>Lors de l’installation de la BDD (<code class="docutils literal"><span class="pre">install_db.sh</span></code>) le schéma <code class="docutils literal"><span class="pre">utilisateurs</span></code> de UsersHub et le schéma <code class="docutils literal"><span class="pre">taxonomie</span></code> de TaxHub sont intégrés automatiquement dans la BDD de GeoNature.</p>
<p>UsersHub n’est pas nécessaire au fonctionnement de GeoNature mais il sera utile pour avoir une interface de gestion des utilisateurs, des groupes et de leurs droits.</p>
<p>Par contre il est nécessaire d’installer TaxHub (<a class="reference external" href="https://github.com/PnX-SI/TaxHub">https://github.com/PnX-SI/TaxHub</a>) pour que GeoNature fonctionne. En effet, GeoNature utilise l’API de TaxHub. Une fois GeoNature installé, il vous faut donc installer TaxHub en le connectant à la BDD de GeoNature, vu que son schéma <code class="docutils literal"><span class="pre">taxonomie</span></code> a déjà été installé par le script <code class="docutils literal"><span class="pre">install_db.sh</span></code> de GeoNature. Lors de l’installation de TaxHub, n’installez donc que l’application et pas la BDD.</p>
<p>Télécharger Taxhub depuis le dépôt github depuis la racine de votre utilisateur:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">PnX</span><span class="o">-</span><span class="n">SI</span><span class="o">/</span><span class="n">TaxHub</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">zip</span>
<span class="n">unzip</span> <span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">zip</span>
<span class="n">rm</span> <span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
<p>en mode développeur:</p>
<p><code class="docutils literal"><span class="pre">https://github.com/PnX-SI/TaxHub.git</span></code></p>
<p>Rendez vous dans le répertoire téléchargé et dézippé, puis “désamplez” le fichier <code class="docutils literal"><span class="pre">settings.ini</span></code> et remplissez la configuration avec les paramètres de connexion à la BDD GeoNature précedemment installée :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">settings</span><span class="o">.</span><span class="n">ini</span><span class="o">.</span><span class="n">sample</span> <span class="n">settings</span><span class="o">.</span><span class="n">ini</span>
<span class="n">nano</span> <span class="n">settings</span><span class="o">.</span><span class="n">ini</span>
</pre></div>
</div>
<p>Lancer le script d’installation de l’application :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">var</span>
<span class="n">mkdir</span> <span class="n">var</span><span class="o">/</span><span class="n">log</span>
<span class="n">touch</span> <span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">install_app</span><span class="o">.</span><span class="n">log</span>
<span class="o">./</span><span class="n">install_app</span><span class="o">.</span><span class="n">sh</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">tee</span> <span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">install_app</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>Suite à l’execution de ce script, l’application Taxhub a été lancé automatiquement par le superviseur et est disponible à l’adresse <code class="docutils literal"><span class="pre">127.0.0.1:5000</span></code> (et l’API, à <code class="docutils literal"><span class="pre">127.0.0.1:5000/api</span></code>)</p>
<p>Voir la doc d’installation de TaxHub : <a class="reference external" href="http://taxhub.readthedocs.io/">http://taxhub.readthedocs.io/</a></p>
<p>Voir la doc d’installation de UsersHub : <a class="reference external" href="http://usershub.readthedocs.io/">http://usershub.readthedocs.io/</a></p>
</div>
<div class="section" id="mise-a-jour-de-l-application">
<h2>Mise à jour de l’application<a class="headerlink" href="#mise-a-jour-de-l-application" title="Permalink to this headline">¶</a></h2>
<p>Attention, avant chaque mise à jour, il est important de sauvegarder l’application et sa base de données, ou de faire un snapshot du serveur pour pouvoir revenir à son état antérieure avant mise à jour en cas de problème.</p>
<p>La mise à jour de GeoNature consiste à télécharger sa nouvelle version dans un nouveau répertoire, récupérer les fichiers de configuration et de surcouche depuis la version actuelle et de relancer l’installation dans le répertoire de la nouvelle version.</p>
<p>La mise à jour doit être réalisée avec votre utilisateur linux courant (<code class="docutils literal"><span class="pre">geonatureadmin</span></code> par exemple) et non pas le super-utilisateur <code class="docutils literal"><span class="pre">root</span></code>.</p>
<ul>
<li><p class="first">Télécharger la dernière version de GeoNature :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">PnX</span><span class="o">-</span><span class="n">SI</span><span class="o">/</span><span class="n">GeoNature</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">zip</span>
<span class="n">unzip</span> <span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">zip</span>
<span class="n">rm</span> <span class="n">X</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
</li>
<li><p class="first">Renommer l’ancien repertoire de l’application, ainsi que le nouveau :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mv /home/`whoami`/geonature/ /home/`whoami`/geonature_old/
mv GeoNature-X.Y.Z /home/`whoami`/geonature/
cd geonature
</pre></div>
</div>
</li>
<li><p class="first">Suivez les éventuelles notes de version spécifiques décrites au niveau de chaque version : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/releases">https://github.com/PnX-SI/GeoNature/releases</a>.</p>
</li>
</ul>
<p>⚠️ Si la release inclut des scripts de migration SQL : <em>lancer ces scripts avec l’utilisateur de BDD courant</em> (généralement <code class="docutils literal"><span class="pre">geonatadmin</span></code>) et non le super-utilisateur <code class="docutils literal"><span class="pre">postgres</span></code>.</p>
<p>Sauf mentions contraires dans les notes de version, vous pouvez sauter des versions mais en suivant bien les différentes notes de versions intermédiaires et notamment les scripts de mise à jour de la base de données à exécuter successivement.</p>
<ul>
<li><p class="first">Si vous devez aussi mettre à jour TaxHub et/ou UsersHub, suivez leurs notes de versions mais aussi leur documentation (<a class="reference external" href="https://usershub.readthedocs.io">https://usershub.readthedocs.io</a> et <a class="reference external" href="https://taxhub.readthedocs.io">https://taxhub.readthedocs.io</a>).</p>
</li>
<li><p class="first">Lancez le script de <code class="docutils literal"><span class="pre">migration.sh</span></code> à la racine du dossier <code class="docutils literal"><span class="pre">geonature</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">install</span><span class="o">/</span><span class="n">migration</span><span class="o">/</span><span class="n">migration</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="passer-en-mode-developpement">
<h2>Passer en mode développement<a class="headerlink" href="#passer-en-mode-developpement" title="Permalink to this headline">¶</a></h2>
<p>Si vous avez téléchargé GeoNature zippé (via la procédure d’installation globale <code class="docutils literal"><span class="pre">install_all.sh</span></code> ou en suivant la documentation d’installation standalone), il est nécessaire de rattacher votre répertoire au dépôt GitHub afin de pouvoir télécharger les dernières avancées du coeur en <code class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></code>. Pour cela, suivez les commandes suivantes en vous placant à la racine du répertoire de GeoNature.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">---</span> <span class="n">Se</span> <span class="n">créer</span> <span class="n">un</span> <span class="n">répertoire</span> <span class="o">.</span><span class="n">git</span> <span class="o">---</span>
<span class="n">mkdir</span> <span class="o">.</span><span class="n">git</span>
<span class="o">---</span>  <span class="n">récupérer</span> <span class="n">l</span><span class="s1">&#39;historique du dépôt ---</span>
<span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">depth</span><span class="o">=</span><span class="mi">2</span> <span class="o">--</span><span class="n">bare</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">PnX</span><span class="o">-</span><span class="n">SI</span><span class="o">/</span><span class="n">GeoNature</span><span class="o">.</span><span class="n">git</span> <span class="o">.</span><span class="n">git</span>
<span class="o">---</span> <span class="n">initialiser</span> <span class="n">un</span> <span class="n">dépôt</span> <span class="n">git</span> <span class="n">à</span> <span class="n">partir</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;historique téléchargé ---</span>
<span class="n">git</span> <span class="n">init</span>
<span class="o">---</span> <span class="n">vérifier</span> <span class="n">que</span> <span class="n">le</span> <span class="n">dépôt</span> <span class="n">distant</span> <span class="n">et</span> <span class="n">le</span> <span class="n">contenu</span> <span class="n">local</span> <span class="n">sont</span> <span class="n">synchronisés</span> <span class="o">---</span>
<span class="n">git</span> <span class="n">pull</span>
<span class="o">---</span> <span class="n">Reset</span> <span class="n">sur</span> <span class="n">HEAD</span> <span class="n">pour</span> <span class="n">mettre</span> <span class="n">à</span> <span class="n">jour</span> <span class="n">les</span> <span class="n">status</span> <span class="o">---</span>
<span class="n">git</span> <span class="n">reset</span> <span class="n">HEAD</span>
<span class="o">-&gt;</span> <span class="n">vous</span> <span class="n">êtes</span> <span class="n">à</span> <span class="n">jour</span> <span class="n">sur</span> <span class="n">la</span> <span class="n">branche</span> <span class="n">master</span>
</pre></div>
</div>
<p>&#64;TODO : A relire et à basculer dans DOC DEVELOPEMENT ?</p>
<p>Editez le fichier de configuration de GeoNature (<code class="docutils literal"><span class="pre">&lt;GEONATURE_DIRECTORY&gt;/config/geonature_config.toml</span></code>) de la manière suivante :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">URL_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;http://127.0.0.1:4200&#39;</span>
<span class="n">API_ENDPOINT</span> <span class="o">=</span> <span class="s1">&#39;http://127.0.0.1:8000&#39;</span>
<span class="n">API_TAXHUB</span> <span class="o">=</span>  <span class="s1">&#39;http://127.0.0.1:5000/api&#39;</span>
<span class="n">ID_APPLICATION_GEONATURE</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Puis le fichier <code class="docutils literal"><span class="pre">/home/&lt;mon_user&gt;/geonature/frontend/src/conf/app.config.ts</span></code> :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">URL_APPLICATION</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:4200&#39;</span><span class="p">,</span>
<span class="n">API_ENDPOINT</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:8000&#39;</span><span class="p">,</span>
<span class="n">API_TAXHUB</span><span class="p">:</span>  <span class="s1">&#39;http://127.0.0.1:5000/api&#39;</span><span class="p">,</span>
<span class="n">ID_APPLICATION_GEONATURE</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
<ul>
<li><p class="first">Lancer le serveur de développement du frontend grâce à Angular-CLI :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">frontend</span>
<span class="n">npm</span> <span class="n">run</span> <span class="n">start</span>
</pre></div>
</div>
</li>
<li><p class="first">Lancer l’API en mode développement</p>
</li>
</ul>
<p>Ouvrir un nouveau terminal :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">backend</span>
</pre></div>
</div>
<p>Stopper d’abord gunicorn qui est lancé en mode production via le supervisor :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">supervisorctl</span> <span class="n">stop</span> <span class="n">geonature2</span>
</pre></div>
</div>
<p>Puis lancer le backend en mode développement :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">geonature</span> <span class="n">dev_back</span>
</pre></div>
</div>
<p><strong>Le serveur de développement du backend est disponible à l’adresse 127.0.0.1:8000</strong></p>
<p><strong>Le serveur de développement du frontend est disponible à l’adresse 127.0.0.1:4200</strong>.</p>
<p>Vous pouvez vous connecter à l’application avec l’identifiant <code class="docutils literal"><span class="pre">admin</span></code> et le mot de passe <code class="docutils literal"><span class="pre">admin</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="installation-mtes.html" class="btn btn-neutral float-right" title="SPECIFICITES DEPOBIO" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation-all.html" class="btn btn-neutral float-left" title="INSTALLATION GLOBALE" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2019, PnE, PnC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>