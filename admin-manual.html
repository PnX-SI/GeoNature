<!doctype html>
<html class="no-js" lang="fr" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Recherche" href="search.html" /><link rel="next" title="DÃ©veloppement" href="development.html" /><link rel="prev" title="Manuel utilisateur" href="user-manual.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Manuel administrateur - Documentation GeoNature 2.15.4</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Documentation GeoNature 2.15.4</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/LogoGeonature.jpg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Documentation GeoNature 2.15.4</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Recherche" name="q" aria-label="Recherche">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-manual.html">Manuel utilisateur</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Manuel administrateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">DÃ©veloppement</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Auteurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">CHANGELOG</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api-references.html">API REFERENCES</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API REFERENCES</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="autoapi/geonature/index.html">geonature</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of geonature</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="autoapi/geonature/app/index.html">geonature.app</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="autoapi/geonature/core/index.html">geonature.core</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of geonature.core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/admin/index.html">geonature.core.admin</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of geonature.core.admin</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/admin/admin/index.html">geonature.core.admin.admin</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/admin/utils/index.html">geonature.core.admin.utils</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/command/index.html">geonature.core.command</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of geonature.core.command</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/command/__main__/index.html">geonature.core.command.__main__</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/command/create_gn_module/index.html">geonature.core.command.create_gn_module</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/command/main/index.html">geonature.core.command.main</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/core/errors/index.html">geonature.core.errors</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_commons/index.html">geonature.core.gn_commons</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of geonature.core.gn_commons</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_commons/admin/index.html">geonature.core.gn_commons.admin</a></li>
<li class="toctree-l5 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_commons/medias/index.html">geonature.core.gn_commons.medias</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of geonature.core.gn_commons.medias</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_commons/medias/routes/index.html">geonature.core.gn_commons.medias.routes</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_commons/models/index.html">geonature.core.gn_commons.models</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of geonature.core.gn_commons.models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_commons/models/additional_fields/index.html">geonature.core.gn_commons.models.additional_fields</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_commons/models/base/index.html">geonature.core.gn_commons.models.base</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_commons/repositories/index.html">geonature.core.gn_commons.repositories</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_commons/routes/index.html">geonature.core.gn_commons.routes</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_commons/schemas/index.html">geonature.core.gn_commons.schemas</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_commons/tasks/index.html">geonature.core.gn_commons.tasks</a></li>
<li class="toctree-l5 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_commons/validation/index.html">geonature.core.gn_commons.validation</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of geonature.core.gn_commons.validation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_commons/validation/routes/index.html">geonature.core.gn_commons.validation.routes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_meta/index.html">geonature.core.gn_meta</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of geonature.core.gn_meta</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_meta/models/index.html">geonature.core.gn_meta.models</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of geonature.core.gn_meta.models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_meta/models/aframework/index.html">geonature.core.gn_meta.models.aframework</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_meta/models/commons/index.html">geonature.core.gn_meta.models.commons</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_meta/models/datasets/index.html">geonature.core.gn_meta.models.datasets</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_meta/repositories/index.html">geonature.core.gn_meta.repositories</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_meta/routes/index.html">geonature.core.gn_meta.routes</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_meta/schemas/index.html">geonature.core.gn_meta.schemas</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_monitoring/index.html">geonature.core.gn_monitoring</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of geonature.core.gn_monitoring</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_monitoring/models/index.html">geonature.core.gn_monitoring.models</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_monitoring/routes/index.html">geonature.core.gn_monitoring.routes</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_permissions/index.html">geonature.core.gn_permissions</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of geonature.core.gn_permissions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_permissions/admin/index.html">geonature.core.gn_permissions.admin</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_permissions/commands/index.html">geonature.core.gn_permissions.commands</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_permissions/decorators/index.html">geonature.core.gn_permissions.decorators</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_permissions/models/index.html">geonature.core.gn_permissions.models</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_permissions/routes/index.html">geonature.core.gn_permissions.routes</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_permissions/schemas/index.html">geonature.core.gn_permissions.schemas</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_permissions/tools/index.html">geonature.core.gn_permissions.tools</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_profiles/index.html">geonature.core.gn_profiles</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of geonature.core.gn_profiles</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_profiles/models/index.html">geonature.core.gn_profiles.models</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_profiles/routes/index.html">geonature.core.gn_profiles.routes</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_profiles/tasks/index.html">geonature.core.gn_profiles.tasks</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/index.html">geonature.core.gn_synthese</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of geonature.core.gn_synthese</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/imports/index.html">geonature.core.gn_synthese.imports</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of geonature.core.gn_synthese.imports</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/imports/actions/index.html">geonature.core.gn_synthese.imports.actions</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/imports/geo/index.html">geonature.core.gn_synthese.imports.geo</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/imports/plot/index.html">geonature.core.gn_synthese.imports.plot</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/models/index.html">geonature.core.gn_synthese.models</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/module/index.html">geonature.core.gn_synthese.module</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/routes/index.html">geonature.core.gn_synthese.routes</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/schemas/index.html">geonature.core.gn_synthese.schemas</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/synthese_config/index.html">geonature.core.gn_synthese.synthese_config</a></li>
<li class="toctree-l5 has-children"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/utils/index.html">geonature.core.gn_synthese.utils</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of geonature.core.gn_synthese.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/utils/blurring/index.html">geonature.core.gn_synthese.utils.blurring</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/utils/orm/index.html">geonature.core.gn_synthese.utils.orm</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/utils/process/index.html">geonature.core.gn_synthese.utils.process</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/gn_synthese/utils/query_select_sqla/index.html">geonature.core.gn_synthese.utils.query_select_sqla</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/imports/index.html">geonature.core.imports</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of geonature.core.imports</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/actions/index.html">geonature.core.imports.actions</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/admin/index.html">geonature.core.imports.admin</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/blueprint/index.html">geonature.core.imports.blueprint</a></li>
<li class="toctree-l5 has-children"><a class="reference internal" href="autoapi/geonature/core/imports/checks/index.html">geonature.core.imports.checks</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of geonature.core.imports.checks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6 has-children"><a class="reference internal" href="autoapi/geonature/core/imports/checks/dataframe/index.html">geonature.core.imports.checks.dataframe</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of geonature.core.imports.checks.dataframe</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/dataframe/cast/index.html">geonature.core.imports.checks.dataframe.cast</a></li>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/dataframe/core/index.html">geonature.core.imports.checks.dataframe.core</a></li>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/dataframe/dates/index.html">geonature.core.imports.checks.dataframe.dates</a></li>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/dataframe/geometry/index.html">geonature.core.imports.checks.dataframe.geometry</a></li>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/dataframe/utils/index.html">geonature.core.imports.checks.dataframe.utils</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/imports/checks/errors/index.html">geonature.core.imports.checks.errors</a></li>
<li class="toctree-l6 has-children"><a class="reference internal" href="autoapi/geonature/core/imports/checks/sql/index.html">geonature.core.imports.checks.sql</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of geonature.core.imports.checks.sql</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/sql/core/index.html">geonature.core.imports.checks.sql.core</a></li>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/sql/extra/index.html">geonature.core.imports.checks.sql.extra</a></li>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/sql/geo/index.html">geonature.core.imports.checks.sql.geo</a></li>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/sql/nomenclature/index.html">geonature.core.imports.checks.sql.nomenclature</a></li>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/sql/parent/index.html">geonature.core.imports.checks.sql.parent</a></li>
<li class="toctree-l7"><a class="reference internal" href="autoapi/geonature/core/imports/checks/sql/utils/index.html">geonature.core.imports.checks.sql.utils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/commands/index.html">geonature.core.imports.commands</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/config_schema/index.html">geonature.core.imports.config_schema</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/logs/index.html">geonature.core.imports.logs</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/models/index.html">geonature.core.imports.models</a></li>
<li class="toctree-l5 has-children"><a class="reference internal" href="autoapi/geonature/core/imports/routes/index.html">geonature.core.imports.routes</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of geonature.core.imports.routes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/imports/routes/fields/index.html">geonature.core.imports.routes.fields</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/imports/routes/imports/index.html">geonature.core.imports.routes.imports</a></li>
<li class="toctree-l6"><a class="reference internal" href="autoapi/geonature/core/imports/routes/mappings/index.html">geonature.core.imports.routes.mappings</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/schemas/index.html">geonature.core.imports.schemas</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/tasks/index.html">geonature.core.imports.tasks</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/templates/index.html">geonature.core.imports.templates</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/imports/utils/index.html">geonature.core.imports.utils</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/notifications/index.html">geonature.core.notifications</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of geonature.core.notifications</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/notifications/admin/index.html">geonature.core.notifications.admin</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/notifications/models/index.html">geonature.core.notifications.models</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/notifications/routes/index.html">geonature.core.notifications.routes</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/notifications/tasks/index.html">geonature.core.notifications.tasks</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/notifications/utils/index.html">geonature.core.notifications.utils</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/sensitivity/index.html">geonature.core.sensitivity</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of geonature.core.sensitivity</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/sensitivity/models/index.html">geonature.core.sensitivity.models</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/sensitivity/routes/index.html">geonature.core.sensitivity.routes</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/sensitivity/utils/index.html">geonature.core.sensitivity.utils</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/taxonomie/index.html">geonature.core.taxonomie</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of geonature.core.taxonomie</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/taxonomie/admin/index.html">geonature.core.taxonomie.admin</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/taxonomie/schemas/index.html">geonature.core.taxonomie.schemas</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="autoapi/geonature/core/users/index.html">geonature.core.users</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of geonature.core.users</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/users/models/index.html">geonature.core.users.models</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/users/register_post_actions/index.html">geonature.core.users.register_post_actions</a></li>
<li class="toctree-l5"><a class="reference internal" href="autoapi/geonature/core/users/routes/index.html">geonature.core.users.routes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/geonature/middlewares/index.html">geonature.middlewares</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/geonature/tasks/index.html">geonature.tasks</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="autoapi/geonature/utils/index.html">geonature.utils</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of geonature.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/celery/index.html">geonature.utils.celery</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/command/index.html">geonature.utils.command</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/config/index.html">geonature.utils.config</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/config_schema/index.html">geonature.utils.config_schema</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/env/index.html">geonature.utils.env</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/errors/index.html">geonature.utils.errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/filemanager/index.html">geonature.utils.filemanager</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/logs/index.html">geonature.utils.logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/metaclass_utils/index.html">geonature.utils.metaclass_utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/module/index.html">geonature.utils.module</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/schema/index.html">geonature.utils.schema</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/sentry/index.html">geonature.utils.sentry</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/utilsgeometrytools/index.html">geonature.utils.utilsgeometrytools</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/utilsmails/index.html">geonature.utils.utilsmails</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/utilsrequests/index.html">geonature.utils.utilsrequests</a></li>
<li class="toctree-l4"><a class="reference internal" href="autoapi/geonature/utils/utilstoml/index.html">geonature.utils.utilstoml</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/admin-manual.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="manuel-administrateur">
<h1>Manuel administrateur<a class="headerlink" href="#manuel-administrateur" title="Lien vers cette rubrique">Â¶</a></h1>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Lien vers cette rubrique">Â¶</a></h2>
<p>GeoNature possÃ¨de une architecture modulaire et sâappuie sur plusieurs Â«Â servicesÂ Â» indÃ©pendants pour fonctionner :</p>
<ul class="simple">
<li><p>UsersHub et son sous-module dâauthentification Flask (<a class="reference external" href="https://github.com/PnX-SI/UsersHub-authentification-module">https://github.com/PnX-SI/UsersHub-authentification-module</a>) sont utilisÃ©s pour gÃ©rer le schÃ©ma de BDD <code class="docutils literal notranslate"><span class="pre">ref_users</span></code> (actuellement nommÃ© <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>) et lâauthentification. UsersHub permet une gestion centralisÃ©e de ses utilisateurs (listes, organismes, applications), utilisable par les diffÃ©rentes applications de son systÃ¨me dâinformations.</p></li>
<li><p>TaxHub (<a class="reference external" href="https://github.com/PnX-SI/TaxHub">https://github.com/PnX-SI/TaxHub</a>) est utilisÃ© pour la gestion du schÃ©ma de BDD <code class="docutils literal notranslate"><span class="pre">ref_taxonomy</span></code> (actuellement nommÃ© <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code>). LâAPI de TaxHub est utilisÃ©e pour rÃ©cupÃ©rer des informations sur les espÃ¨ces et la taxonomie en gÃ©nÃ©ral. TaxHub est intÃ©grÃ© Ã  GeoNature depuis sa version 2.15.</p></li>
<li><p>Un sous-module Flask (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/">https://github.com/PnX-SI/Nomenclature-api-module/</a>) a Ã©tÃ© crÃ©Ã© pour une gestion centralisÃ©e des nomenclatures (<a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/">https://github.com/PnX-SI/Nomenclature-api-module/</a>), il pilote le schÃ©ma <code class="docutils literal notranslate"><span class="pre">ref_nomenclature</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> est le schÃ©ma de base de donnÃ©es qui gÃ¨re le rÃ©fÃ©rentiel gÃ©ographique. Il est utilisÃ© pour gÃ©rer les zonages, les communes, le MNT, le calcul automatique dâaltitude et les intersections spatiales.</p></li>
</ul>
<p>GeoNature a Ã©galement une sÃ©paration claire entre le backend (API: intÃ©raction avec la base de donnÃ©es) et le frontend (interface utilisateur). Le backend peut Ãªtre considÃ©rÃ© comme un Â«Â serviceÂ Â» dont se sert le frontend pour rÃ©cupÃ©rer ou poster des donnÃ©es.
NB : Le backend et le frontend se lancent sÃ©parÃ©ment dans GeoNature.</p>
<img alt="_images/design-geonature.png" src="_images/design-geonature.png" />
</section>
<section id="base-de-donnees">
<h2>Base de donnÃ©es<a class="headerlink" href="#base-de-donnees" title="Lien vers cette rubrique">Â¶</a></h2>
<p>Dans la continuitÃ© de sa version 1, GeoNature V2 utilise le SGBD PostgreSQL et sa cartouche spatiale PostGIS. Cependant lâarchitecture du modÃ¨le de donnÃ©es a Ã©tÃ© complÃ©tement revue.</p>
<p>La base de donnÃ©es a notamment Ã©tÃ© refondue pour sâappuyer au maximum sur des standards, comme le standard dâOccurrences de taxons du SINP (Voir <a class="reference external" href="http://standards-sinp.mnhn.fr/category/standards/occurrences-de-taxons/">http://standards-sinp.mnhn.fr/category/standards/occurrences-de-taxons/</a>).</p>
<p>La base de donnÃ©es a Ã©galement Ã©tÃ© traduite en Anglais et supporte dÃ©sormais le multilangue.</p>
<p>Les prÃ©fixes des schÃ©mas de BDD sont dÃ©sormais standardisÃ©s : <code class="docutils literal notranslate"><span class="pre">ref_</span></code> concerne les rÃ©fÃ©rentiels externes, <code class="docutils literal notranslate"><span class="pre">gn_</span></code> concerne les schÃ©mas du coeur de GeoNature et <code class="docutils literal notranslate"><span class="pre">pr_</span></code> les schÃ©mas des protocoles.</p>
<p>Autres standards :</p>
<ul class="simple">
<li><p>Noms de tables, commentaires et fonctions en anglais</p></li>
<li><p>Pas de nom de table dans les noms de champs</p></li>
<li><p>Nom de schema Ã©ventuellement dans nom de table</p></li>
</ul>
<p>SchÃ©ma simplifiÃ© de la BDD :</p>
<img alt="http://geonature.fr/docs/img/admin-manual/GN-schema-BDD.jpg" src="http://geonature.fr/docs/img/admin-manual/GN-schema-BDD.jpg" />
<ul class="simple">
<li><p>En jaune, les schÃ©mas des rÃ©ferentiels.</p></li>
<li><p>En rose, les schÃ©mas du coeur de GeoNature</p></li>
<li><p>En bleu, les schÃ©mas des protocoles et sources de donnÃ©es</p></li>
<li><p>En vert, les schÃ©mas des applications pouvant interagir avec le coeur de GeoNature</p></li>
</ul>
<p>Depuis la version 2.0.0-rc.4, il faut noter que les permissions (CRUVED) ont Ã©tÃ© retirÃ©es du schÃ©ma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> (<code class="docutils literal notranslate"><span class="pre">ref_users</span></code>) de UsersHub pour lâintÃ©grer dans GeoNature dans un schÃ©ma <code class="docutils literal notranslate"><span class="pre">gn_permissions</span></code>, Ã  ajouter en rose.</p>
<p>ModÃ¨le simplifiÃ© de la BDD (2017-12-15) :</p>
<img alt="_images/2017-12-15-GN2-MCD-simplifie.jpg" src="_images/2017-12-15-GN2-MCD-simplifie.jpg" />
<p>DerniÃ¨re version complÃ¨te de la base de donnÃ©es (GeoNature 2.1 / 2019-08) :</p>
<img alt="_images/2019-08-GN2-1-MCD.png" src="_images/2019-08-GN2-1-MCD.png" />
<p>Les relations complexes entre les schÃ©mas ont Ã©tÃ© grisÃ©es pour faciliter la lisibilitÃ©.</p>
<section id="administration-avec-alembic">
<h3>Administration avec Alembic<a class="headerlink" href="#administration-avec-alembic" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Ã partir de la version 2.7.5 de GeoNature, la gestion du schÃ©ma de la base de donnÃ©es se fait avec lâoutil <a class="reference external" href="https://alembic.sqlalchemy.org/en/latest/">Alembic</a>.
Celui-ci fonctionne grÃ¢ce Ã  des fichiers de migration qui sont appliquÃ©s de maniÃ¨re atomique (via une transaction) Ã  la base de donnÃ©es, leur application Ã©tant enregistrÃ© dans la table <code class="docutils literal notranslate"><span class="pre">public.alembic_version</span></code> permettant en chaque instant de savoir dans quel Ã©tat la base de donnÃ©es se trouve.</p>
<p>Les fichiers de migrations de GeoNature se trouve dans le dossier <code class="docutils literal notranslate"><span class="pre">backend/geonature/migrations/versions/</span></code>.
Il est possible pour nâimporte quelle dÃ©pendance ou module GeoNature de fournir Ã©galement des fichiers de migrations. Pour que ceux-ci soient dÃ©tectÃ©s par Alembic, il suffira de dÃ©finir un point dâentrÃ©e dans le <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> de la dÃ©pendance ou du module concernÃ© :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setuptools</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span>
    <span class="err">â¦</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;alembic&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;migrations = my_module:migrations&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="err">â¦</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Il est Ã©galement possible de spÃ©cifier lâemplacement de rÃ©visions Alembic manuellement dans la configuration de GeoNature. Cela est nÃ©cessaire entre autre pour UsersHub afin de pouvoir manipuler son schÃ©ma alors que UsersHub nâest usuellement pas installÃ© dans le venv de GeoNature (seul UsersHub-authentification-module lâest) :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[ALEMBIC]</span>
<span class="n">VERSION_LOCATIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/path/to/usershub/app/migrations/versions&#39;</span>
</pre></div>
</div>
<p>Chaque fichier de migration est caractÃ©risÃ© par :</p>
<ul class="simple">
<li><p>un identifiant, <cite>e.g.</cite> <code class="docutils literal notranslate"><span class="pre">f06cc80cc8ba</span></code></p></li>
<li><p>une branche : Les branches permettent de sÃ©parer les fichiers de migrations afin de pouvoir les appliquer sÃ©parÃ©ment. Par exemple, pour un dÃ©ploiement de TaxHub sans GeoNature, il peut Ãªtre intÃ©ressant de crÃ©er le schÃ©ma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> sans crÃ©er les schÃ©mas de GeoNature, et ainsi gÃ©rer indÃ©pendamment les migrations de chaque schÃ©ma.</p></li>
<li><p>un ancÃªtre : Lorsquâun fichier de migration reprÃ©sente lâÃ©volution dâun Ã©tat antÃ©rieur de la base de donnÃ©es, lâancÃªtre indique dans quelle version la base de donnÃ©es doit se trouver avant dâappliquer le-dis fichier de migration.</p></li>
<li><p>des dÃ©pendances : Il est possible dâindiquer quâune migration nÃ©cessite quâune ou plusieurs autres migrations aient Ã©tÃ© prÃ©alablement appliquÃ©es. Par exemple, ceci permet dâindiquer que le schÃ©ma de GeoNature nÃ©cessite les schÃ©mas <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> et <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>.</p></li>
</ul>
<p>Les commandes Alembic sont disponibles grÃ¢ce Ã  la sous-commande <code class="docutils literal notranslate"><span class="pre">db</span></code> de la commande <code class="docutils literal notranslate"><span class="pre">geonature</span></code> :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>--help
</pre></div>
</div>
<p>Les deux sous-commandes <code class="docutils literal notranslate"><span class="pre">status</span></code> et <code class="docutils literal notranslate"><span class="pre">autoupgrade</span></code> sont spÃ©cifiques Ã  GeoNature afin dâaider Ã  lâutilisation dâAlembic.</p>
<p>La commande <code class="docutils literal notranslate"><span class="pre">status</span></code> permet de visualiser les branches et lâensemble de leurs rÃ©visions.
Pour chaque rÃ©vision est indiquÃ© si celle-ci est appliquÃ©e Ã  la base de donnÃ©es.
Si une branche a au moins sa premiÃ¨re rÃ©vision dâappliquÃ©e, alors un petit symbole indique si cette branche est Ã  jour, câest-Ã -dire si toutes les rÃ©visions de la branche ont Ã©tÃ© appliquÃ©es (<code class="docutils literal notranslate"><span class="pre">â</span></code>) ou si la branche est en retard, câest-Ã -dire que celle-ci contient des rÃ©visions qui ne sont pas encore appliquÃ©es Ã  la base de donnÃ©es (<code class="docutils literal notranslate"><span class="pre">Ã</span></code>).</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>geonature<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â°<span class="w"> </span>f06cc80cc8ba<span class="w"> </span>geonature<span class="w"> </span>schemas<span class="w"> </span><span class="m">2</span>.7.5
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>c0fdf2ee7f4f<span class="w"> </span>auto<span class="w"> </span>update<span class="w"> </span>cor_area_synthese
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>7077aa76da3d<span class="w"> </span>bump<span class="w"> </span>dependencies
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>2a2e5c519fd1<span class="w"> </span>fix<span class="w"> </span>gn_synthese.get_default_nomenclature_value
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>5f4c4b644844<span class="w"> </span>delete<span class="w"> </span>cascade<span class="w"> </span>on<span class="w">  </span>cor_dataset_territory<span class="w"> </span>and<span class="w"> </span>cor_dataset_protocol
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>2aa558b1be3a<span class="w"> </span>add<span class="w"> </span>schema<span class="w"> </span>gn_profiles
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>1eb624249f2b<span class="w"> </span>add<span class="w"> </span>default<span class="w"> </span>value<span class="w"> </span><span class="k">in</span><span class="w"> </span>additionalFields<span class="w"> </span>bib
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>7471f51011c8<span class="w"> </span>change<span class="w"> </span>index_vm_valid_profiles_cd_ref<span class="w"> </span>to<span class="w"> </span>unique<span class="w"> </span>index
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>9a9f4971edcd<span class="w"> </span>fix<span class="w"> </span>altitude<span class="w"> </span>trigger
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>6f7d5549d49e<span class="w"> </span>delete<span class="w"> </span>view<span class="w"> </span>v_synthese_validation_forwebapp
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â£â<span class="w"> </span>dde31e76ce45<span class="w"> </span>remove<span class="w"> </span>old<span class="w"> </span>profile<span class="w"> </span><span class="k">function</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w">  </span>â<span class="w"> </span>61e46813d621<span class="w"> </span>Update<span class="w"> </span>synthese<span class="w"> </span>sensitivity
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w">  </span>â<span class="w"> </span>dfec5f64ac73<span class="w"> </span>Fix<span class="w"> </span>sensitivity<span class="w"> </span>algorithm
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w">  </span>â<span class="w"> </span>ac08dcf3f27b<span class="w"> </span>Do<span class="w"> </span>not<span class="w"> </span>auto-compute<span class="w"> </span>diffusion_level
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>30edd97ae582<span class="w"> </span>Remove<span class="w"> </span>gn_export.t_config_exports
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>ââ<span class="w"> </span>1dbc45309d6e<span class="w"> </span>Merge<span class="w"> </span>sensitivity
<span class="o">[</span>geonature-samples<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>3d0bf4ee67d1<span class="w"> </span>geonature<span class="w"> </span>samples
<span class="o">[</span>habitats<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>62e63cd6135d<span class="w"> </span>create<span class="w"> </span>ref_habitats<span class="w"> </span>schema
<span class="o">[</span>habitats_inpn_data<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â°<span class="w"> </span>46e91e738845<span class="w"> </span>insert<span class="w"> </span>inpn<span class="w"> </span>data<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_habitats<span class="w"> </span>schema
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â¸<span class="w"> </span>805442837a68<span class="w"> </span>correction<span class="w"> </span>on<span class="w"> </span>habref<span class="w"> </span>data
<span class="o">[</span>ign_bd_alti<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>1715cf31a75d<span class="w"> </span>Insert<span class="w"> </span>default<span class="w"> </span>French<span class="w"> </span>DEM<span class="w"> </span><span class="o">(</span>IGN<span class="w"> </span>250m<span class="w"> </span>BD<span class="w"> </span>alti<span class="o">)</span>
<span class="o">[</span>ign_bd_alti_vector<span class="o">]</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w"> </span>â<span class="w"> </span>87651375c2e8<span class="w"> </span>Vectorize<span class="w"> </span>French<span class="w"> </span>DEM
<span class="o">[</span>nomenclatures<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â°<span class="w"> </span>6015397d686a<span class="w"> </span>create<span class="w"> </span>ref_nomenclature<span class="w"> </span>schema<span class="w"> </span><span class="m">1</span>.3.9
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>11e7741319fd<span class="w"> </span>fix<span class="w"> </span>ref_nomenclatures.get_default_nomenclature_value
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>f8c2c8482419<span class="w"> </span>fix<span class="w"> </span>ref_nomenclatures.get_default_nomenclature_value
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â¸<span class="w"> </span>b820c66d8daa<span class="w"> </span>fix<span class="w"> </span>ref_nomenclatures.get_nomenclature_label
<span class="o">[</span>nomenclatures_inpn_data<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>96a713739fdd<span class="w"> </span>insert<span class="w"> </span>inpn<span class="w"> </span>data<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_nomenclatures
<span class="o">[</span>nomenclatures_taxonomie<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>f5436084bf17<span class="w"> </span>add<span class="w"> </span>support<span class="w"> </span><span class="k">for</span><span class="w"> </span>taxonomy<span class="w"> </span>into<span class="w"> </span>ref_nomenclatures
<span class="o">[</span>nomenclatures_taxonomie_inpn_data<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>a763fb554ff2<span class="w"> </span>insert<span class="w"> </span>taxonomic<span class="w"> </span>inpn<span class="w"> </span>data<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_nomenclatures
<span class="o">[</span>occhab<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>2984569d5df6<span class="w"> </span>create<span class="w"> </span>occhab<span class="w"> </span>schema
<span class="o">[</span>occhab-samples<span class="o">]</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w"> </span>â<span class="w"> </span>21f661247023<span class="w"> </span>insert<span class="w"> </span>occhab<span class="w"> </span>sample<span class="w"> </span>data
<span class="o">[</span>occtax<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â°<span class="w"> </span>29c199e07eaa<span class="w"> </span>create<span class="w"> </span>occtax<span class="w"> </span>schema
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>addb71d8efad<span class="w"> </span>create<span class="w"> </span>occtax<span class="w"> </span><span class="nb">export</span><span class="w"> </span>view
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>f57107d2d0ad<span class="w"> </span>fix<span class="w"> </span>get_default_nomenclature_value
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>494cb2245a43<span class="w"> </span>trigger<span class="w"> </span>comportement
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â¸<span class="w"> </span>944072911ff7<span class="w"> </span>update<span class="w"> </span>synthese<span class="w"> </span>data<span class="w"> </span><span class="o">(</span>bug<span class="w"> </span>occtax<span class="w"> </span>trigger<span class="o">)</span>
<span class="o">[</span>occtax-samples<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>cce08a64eb4f<span class="w"> </span>insert<span class="w"> </span>occtax<span class="w"> </span>sample<span class="w"> </span>data
<span class="o">[</span>occtax-samples-test<span class="o">]</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w"> </span>â<span class="w"> </span>2a0ab7644e1c<span class="w"> </span>occtax<span class="w"> </span>sample<span class="w"> </span><span class="nb">test</span>
<span class="o">[</span>ref_geo<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â°<span class="w"> </span>6afe74833ed0<span class="w"> </span>ref_geo<span class="w"> </span>schema
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>e0ac4c9f5c0a<span class="w"> </span>add<span class="w"> </span>indexes<span class="w"> </span>on<span class="w"> </span>FK<span class="w"> </span>referencing<span class="w"> </span>l_areas.id_area
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â¸<span class="w"> </span>4882d6141a41<span class="w"> </span>add<span class="w"> </span>regions<span class="w"> </span><span class="k">in</span><span class="w"> </span>area<span class="w"> </span>types
<span class="o">[</span>ref_geo_fr_departments<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>3fdaa1805575<span class="w"> </span>Insert<span class="w"> </span>French<span class="w"> </span>departments<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_geo
<span class="o">[</span>ref_geo_fr_municipalities<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>0dfdbfbccd63<span class="w"> </span>Insert<span class="w"> </span>French<span class="w"> </span>municipalities<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_geo
<span class="o">[</span>ref_geo_fr_regions<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>d02f4563bebe<span class="w"> </span>Insert<span class="w"> </span>French<span class="w"> </span>regions<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_geo
<span class="o">[</span>ref_geo_fr_regions_1970<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>05a0ae652c13<span class="w"> </span>Insert<span class="w"> </span>French<span class="w"> </span>regions<span class="w"> </span><span class="m">1970</span>-2016<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_geo
<span class="o">[</span>ref_geo_inpn_grids_1<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>586613e2faeb<span class="w"> </span>Insert<span class="w"> </span>INPN<span class="w"> </span><span class="m">1</span>Ã1<span class="w"> </span>grids<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_geo
<span class="o">[</span>ref_geo_inpn_grids_10<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>ede150d9afd9<span class="w"> </span>Insert<span class="w"> </span>INPN<span class="w"> </span><span class="m">10</span>Ã10<span class="w"> </span>grids<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_geo
<span class="o">[</span>ref_geo_inpn_grids_5<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>7d6e98441e4c<span class="w"> </span>Insert<span class="w"> </span>INPN<span class="w"> </span><span class="m">5</span>Ã5<span class="w"> </span>grids<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_geo
<span class="o">[</span>ref_sensitivity_inpn<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>7dfd0a813f86<span class="w"> </span>Insert<span class="w"> </span>INPN<span class="w"> </span>rules<span class="w"> </span><span class="k">in</span><span class="w"> </span>sensitivity<span class="w"> </span>referential
<span class="o">[</span>sql_utils<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>3842a6d800a0<span class="w"> </span>Add<span class="w"> </span>public<span class="w"> </span>shared<span class="w"> </span>functions
<span class="o">[</span>taxhub<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>fa5a90853c45<span class="w"> </span>taxhub
<span class="o">[</span>taxhub-admin<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>3fe8c07741be<span class="w"> </span>taxhub
<span class="o">[</span>taxonomie<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â°<span class="w"> </span>9c2c0254aadc<span class="w"> </span>create<span class="w"> </span>taxonomie<span class="w"> </span>schema<span class="w"> </span>version<span class="w"> </span><span class="m">1</span>.8.1
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>7540702c6407<span class="w"> </span>cd_ref<span class="w"> </span>utility<span class="w"> </span>functions
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>98035939bc0d<span class="w"> </span>find_all_taxons_parents
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>c93cbb35cfe4<span class="w"> </span><span class="nb">set</span><span class="w"> </span>default<span class="w"> </span>value<span class="w"> </span><span class="k">for</span><span class="w"> </span>id_liste
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â¸<span class="w"> </span>4fb7e197d241<span class="w"> </span>create<span class="w"> </span>taxonomie.v_bdc_status<span class="w"> </span>view
<span class="o">[</span>taxonomie_attributes_example<span class="o">]</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w"> </span>â<span class="w"> </span>aa7533601e41<span class="w"> </span>add<span class="w"> </span>attributes<span class="w"> </span>exemple<span class="w"> </span>to<span class="w"> </span>taxonomie
<span class="o">[</span>taxonomie_inpn_data<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>f61f95136ec3<span class="w"> </span>insert<span class="w"> </span>inpn<span class="w"> </span>data<span class="w"> </span><span class="k">in</span><span class="w"> </span>taxonomie<span class="w"> </span>schema
<span class="o">[</span>taxonomie_taxons_example<span class="o">]</span>
<span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="o">]</span><span class="w"> </span>â<span class="w"> </span>8222017dc3f6<span class="w"> </span>add<span class="w"> </span>taxons<span class="w"> </span>exemple<span class="w"> </span>to<span class="w"> </span>taxonomie
<span class="o">[</span>usershub<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â°<span class="w"> </span>9445a69f2bed<span class="w"> </span>UsersHub
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â¸<span class="w"> </span>6ec215fe023e<span class="w"> </span>upgrade<span class="w"> </span>utilisateurs<span class="w"> </span>schema
<span class="o">[</span>usershub-samples<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>f63a8f44c969<span class="w"> </span>UsersHub<span class="w"> </span>samples<span class="w"> </span>data
<span class="o">[</span>utilisateurs<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â°<span class="w"> </span>fa35dfe5ff27<span class="w"> </span>utilisateurs<span class="w"> </span>schema<span class="w"> </span><span class="m">1</span>.4.7<span class="w"> </span><span class="o">(</span>usershub<span class="w"> </span><span class="m">2</span>.1.3<span class="o">)</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>830cc8f4daef<span class="w"> </span>add<span class="w"> </span>additional_data<span class="w"> </span>field<span class="w"> </span>to<span class="w"> </span>bib_organismes
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>5b334b77f5f5<span class="w"> </span>fix<span class="w"> </span>v_roleslist_forall_applications
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>951b8270a1cf<span class="w"> </span>add<span class="w"> </span>unique<span class="w"> </span>constraint<span class="w"> </span>on<span class="w"> </span>bib_organismes.uuid_organisme
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â¸<span class="w"> </span>10e87bc144cd<span class="w"> </span>get_id_role_by_name<span class="o">()</span>
<span class="o">[</span>utilisateurs-samples<span class="w"> </span>â<span class="o">]</span>
<span class="w">  </span><span class="o">[</span>x<span class="o">]</span><span class="w"> </span>â<span class="w"> </span>72f227e37bdf<span class="w"> </span>utilisateurs<span class="w"> </span>sample<span class="w"> </span>data
</pre></div>
</div>
<p>La commande <code class="docutils literal notranslate"><span class="pre">autoupgrade</span></code> permet de mettre automatiquement Ã  jour toutes les branches dont au moins une rÃ©vision est appliquÃ©e lorsque celles-ci possÃ¨dent une ou plusieurs rÃ©visions non appliquÃ©es.
Cette commande est appelÃ©e par le script <code class="docutils literal notranslate"><span class="pre">migration.sh</span></code> lors dâune mise Ã  jour de la base de donnÃ©es.
Elle accepte Ã©galement les paramÃ¨tres <code class="docutils literal notranslate"><span class="pre">-x</span></code> qui sont alors fournis Ã  la commande <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> lorsque appelÃ©e sur chaque branche en retard.</p>
<p>La commande <code class="docutils literal notranslate"><span class="pre">heads</span></code> permet de lister lâensemble des branches disponibles, ainsi que la derniÃ¨re rÃ©vision disponible pour chaque branche :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>heads
e0ac4c9f5c0a<span class="w"> </span><span class="o">(</span>ref_geo<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
7077aa76da3d<span class="w"> </span><span class="o">(</span>geonature<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
586613e2faeb<span class="w"> </span><span class="o">(</span>ref_geo_inpn_grids_1<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
1715cf31a75d<span class="w"> </span><span class="o">(</span>ign_bd_alti<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
3d0bf4ee67d1<span class="w"> </span><span class="o">(</span>geonature-samples<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
0dfdbfbccd63<span class="w"> </span><span class="o">(</span>ref_geo_fr_municipalities<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
7d6e98441e4c<span class="w"> </span><span class="o">(</span>ref_geo_inpn_grids_5<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
87651375c2e8<span class="w"> </span><span class="o">(</span>ign_bd_alti_vector<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
3fdaa1805575<span class="w"> </span><span class="o">(</span>ref_geo_fr_departments<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
ede150d9afd9<span class="w"> </span><span class="o">(</span>ref_geo_inpn_grids_10<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
3842a6d800a0<span class="w"> </span><span class="o">(</span>sql_utils<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
951b8270a1cf<span class="w"> </span><span class="o">(</span>utilisateurs<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
72f227e37bdf<span class="w"> </span><span class="o">(</span>utilisateurs-samples<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
f5436084bf17<span class="w"> </span><span class="o">(</span>nomenclatures_taxonomie<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
6015397d686a<span class="w"> </span><span class="o">(</span>nomenclatures<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
96a713739fdd<span class="w"> </span><span class="o">(</span>nomenclatures_inpn_data<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
a763fb554ff2<span class="w"> </span><span class="o">(</span>nomenclatures_taxonomie_inpn_data<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
4fb7e197d241<span class="w"> </span><span class="o">(</span>taxonomie<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
aa7533601e41<span class="w"> </span><span class="o">(</span>taxonomie_attributes_example<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
3fe8c07741be<span class="w"> </span><span class="o">(</span>taxhub-admin<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
8222017dc3f6<span class="w"> </span><span class="o">(</span>taxonomie_taxons_example<span class="o">)</span><span class="w"> </span><span class="o">(</span>head<span class="o">)</span>
f61f95136ec3<span class="w"> </span><span class="o">(</span>taxonomie_inpn_data<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
fa5a90853c45<span class="w"> </span><span class="o">(</span>taxhub<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
46e91e738845<span class="w"> </span><span class="o">(</span>habitats_inpn_data<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
62e63cd6135d<span class="w"> </span><span class="o">(</span>habitats<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
</pre></div>
</div>
<p>La commande <code class="docutils literal notranslate"><span class="pre">history</span></code> permet de lister lâensemble de fichier de rÃ©visions. Il est Ã©galement possible de lister les rÃ©visions devant Ãªtre appliquÃ©es pour passer dâun Ã©tat Ã  un autre. Par exemple, voici la liste des rÃ©visions Ã  appliquer pour passer dâune base de donnÃ©es vierge (<code class="docutils literal notranslate"><span class="pre">base</span></code>) Ã  une base avec la branche <code class="docutils literal notranslate"><span class="pre">nomenclatures_inpn_data</span></code> Ã  jour (<code class="docutils literal notranslate"><span class="pre">head</span></code>) :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span><span class="nb">history</span><span class="w"> </span>-r<span class="w"> </span>base:nomenclatures_inpn_data@head
&lt;base&gt;<span class="w"> </span><span class="o">(</span>6015397d686a<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>96a713739fdd<span class="w"> </span><span class="o">(</span>nomenclatures_inpn_data<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>,<span class="w"> </span>insert<span class="w"> </span>inpn<span class="w"> </span>data<span class="w"> </span><span class="k">in</span><span class="w"> </span>ref_nomenclatures
&lt;base&gt;<span class="w"> </span><span class="o">(</span>fa35dfe5ff27,<span class="w"> </span>3842a6d800a0<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>6015397d686a<span class="w"> </span><span class="o">(</span>nomenclatures<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>,<span class="w"> </span>create<span class="w"> </span>ref_nomenclature<span class="w"> </span>schema<span class="w"> </span><span class="m">1</span>.3.9
&lt;base&gt;<span class="w"> </span>-&gt;<span class="w"> </span>3842a6d800a0<span class="w"> </span><span class="o">(</span>sql_utils<span class="o">)</span><span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>,<span class="w"> </span>Add<span class="w"> </span>public<span class="w"> </span>shared<span class="w"> </span>functions
&lt;base&gt;<span class="w"> </span>-&gt;<span class="w"> </span>fa35dfe5ff27<span class="w"> </span><span class="o">(</span>utilisateurs<span class="o">)</span>,<span class="w"> </span>utilisateurs<span class="w"> </span>schema<span class="w"> </span><span class="m">1</span>.4.7<span class="w"> </span><span class="o">(</span>usershub<span class="w"> </span><span class="m">2</span>.1.3<span class="o">)</span>
</pre></div>
</div>
<p>Si vous avez dÃ©jÃ  une base de donnÃ©es existante correspondant Ã  une installation de GeoNature en version 2.7.5 et que vous passez Ã  Alembic, vous pouvez lâindiquer grÃ¢ce Ã  la commande suivante :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>stamp<span class="w"> </span>f06cc80cc8ba
</pre></div>
</div>
<p>Il est possible que votre base de donnÃ©es contienne quelques donnÃ©es supplÃ©mentaires (rÃ©fÃ©rentiel gÃ©ographique des communes, â¦), quâil faut donc indiquer Ã  Alembic aussi.
Reportez-vous aux notes de versions de la release 2.8.0 de GeoNature afin de consulter la liste des rÃ©visions Ã  Ã©ventuellement Â« <cite>stamper</cite> Â».</p>
<p>Vous pouvez demander Ã  Alembic dans quel Ã©tat se trouve votre base de donnÃ©es avec la commande <code class="docutils literal notranslate"><span class="pre">current</span></code> :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>current
62e63cd6135d<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
f06cc80cc8ba
3842a6d800a0<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
9c2c0254aadc
72f227e37bdf<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
fa35dfe5ff27
6015397d686a<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
6afe74833ed0
a763fb554ff2<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
f5436084bf17<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
46e91e738845<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
f61f95136ec3<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
96a713739fdd<span class="w"> </span><span class="o">(</span>effective<span class="w"> </span>head<span class="o">)</span>
</pre></div>
</div>
<p>La liste obtenue contient, pour chaque branche, la derniÃ¨re migration appliquÃ©e.
Notons toutefois que Alembic ne stocke pas lâensemble de cette liste dans la table <code class="docutils literal notranslate"><span class="pre">public.alembic_revision</span></code>, mais se restreint uniquement aux migrations dont lâapplication ne peut Ãªtre dÃ©duit des indications de dÃ©pendances.</p>
<p>Il est possible de nâafficher que les informations liÃ©es Ã  une rÃ©vision avec la commande <code class="docutils literal notranslate"><span class="pre">show</span></code> :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>show<span class="w"> </span>f06cc80cc8ba
Rev:<span class="w"> </span>f06cc80cc8ba
Parent:<span class="w"> </span>&lt;base&gt;
Also<span class="w"> </span>depends<span class="w"> </span>on:<span class="w"> </span>72f227e37bdf,<span class="w"> </span>a763fb554ff2,<span class="w"> </span>46e91e738845,<span class="w"> </span>6afe74833ed0
Branch<span class="w"> </span>names:<span class="w"> </span>geonature
Path:<span class="w"> </span>backend/geonature/migrations/versions/f06cc80cc8ba_2_7_5.py

<span class="w">    </span>geonature<span class="w"> </span>schemas<span class="w"> </span><span class="m">2</span>.7.5

<span class="w">    </span>Revision<span class="w"> </span>ID:<span class="w"> </span>f06cc80cc8ba
<span class="w">    </span>Create<span class="w"> </span>Date:<span class="w"> </span><span class="m">2021</span>-08-10<span class="w"> </span><span class="m">14</span>:23:55.144250
</pre></div>
</div>
<p>Lâabsence de lâindication <code class="docutils literal notranslate"><span class="pre">(head)</span></code> Ã  cÃ´tÃ© du numÃ©ro de rÃ©vision indique quâil ne sâagit pas de la derniÃ¨re rÃ©vision disponible pour la branche <code class="docutils literal notranslate"><span class="pre">geonature</span></code>.
Vous pouvez alors mettre Ã  jour cette branche avec la commande <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>upgrade<span class="w"> </span>geonature@head
</pre></div>
</div>
<p>Il est possible de monter des branches optionnelles pour, par exemple, bÃ©nÃ©ficier des mailles 10Ã10 dans son rÃ©fÃ©rentiel gÃ©ographique :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>upgrade<span class="w"> </span>ref_geo_inpn_grids_10@head<span class="w"> </span>-x<span class="w"> </span>data-directory<span class="o">=</span>./tmp_geo
</pre></div>
</div>
<p>Lâensemble des branches disponibles est dÃ©crit dans la sous-section ci-aprÃ¨s.</p>
<p>Lâargument <code class="docutils literal notranslate"><span class="pre">-x</span></code> permet de fournir des variables Ã  usage des fichiers de migrations. Dans le cas des migrations de donnÃ©es de zones gÃ©ographiques, celles-ci supporte la variable <code class="docutils literal notranslate"><span class="pre">data-directory</span></code> permettant de spÃ©cifier oÃ¹ doivent Ãªtre cherchÃ©es et Ã©ventuellement tÃ©lÃ©chargÃ©es les donnÃ©es gÃ©ographiques. Si lâargument nâest pas spÃ©cifiÃ©, un dossier temporaire, supprimÃ© Ã  la fin de la procÃ©dure, sera utilisÃ©.</p>
<p>Pour supprimer les mailles 10Ã10 de son rÃ©fÃ©rentiel gÃ©ographique, on utilisera :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>downgrade<span class="w"> </span>ref_geo_inpn_grids_10@base
</pre></div>
</div>
<p>Dans le cas dâune branche contenant plusieurs migrations, on pourra appliquer ou dÃ©sappliquer chaque migration individuellement avec <code class="docutils literal notranslate"><span class="pre">upgrade</span> <span class="pre">branch&#64;+1</span></code> ou <code class="docutils literal notranslate"><span class="pre">downgrade</span> <span class="pre">branch&#64;-1</span></code>. Il est Ã©galement possible de rÃ©fÃ©rencer directement un numÃ©ro de migration.</p>
<p>Si lâon souhaite appliquer une migration manuellement, ou si lâon souhaite la modifier, il est possible de passer lâargument <code class="docutils literal notranslate"><span class="pre">--sql</span></code> aux commandes <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> et <code class="docutils literal notranslate"><span class="pre">downgrade</span></code> afin de rÃ©cupÃ©rer le code SQL de la migration. Cela ne fonctionne toutefois pas avec certaines migrations telles que les migrations de donnÃ©es gÃ©ographiques, en raison dâimport SQL nÃ©cessitant de manipuler directement le curseur SQLAlchemy.</p>
<p>Pour crÃ©er un nouveau fichier de migration afin dây placer ses Ã©volutions de la base de donnÃ©es, on utilisera la commande suivante :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>revision<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;add table gn_commons.t_foo&quot;</span><span class="w"> </span>--head<span class="w"> </span>geonature@head
Generating<span class="w"> </span><span class="o">[</span>â¦<span class="o">]</span>/backend/geonature/migrations/versions/31250092bce3_add_table_gn_commons_t_foo.py<span class="w"> </span>...<span class="w">  </span><span class="k">done</span>
</pre></div>
</div>
<p>La <a class="reference external" href="https://alembic.sqlalchemy.org/en/latest/ops.html">documentation dâAlembic</a> liste les opÃ©rations prises en charge.
Certaines opÃ©rations complexes telles que la crÃ©ation de trigger ne sont pas prÃ©vues, mais il reste toujours possible dâexÃ©cuter du SQL directement avec lâopÃ©rateur <code class="docutils literal notranslate"><span class="pre">op.execute</span></code>.</p>
<section id="description-des-branches">
<h4>Description des branches<a class="headerlink" href="#description-des-branches" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Cette section liste les branches Alembic disponibles et leur impact sur la base de donnÃ©es.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sql_utils</span></code> : Fournit quelques fonctions SQl utilitaires dans le schÃ©ma <code class="docutils literal notranslate"><span class="pre">public</span></code>. Fourni par Utils-Flask-SQLAlchemy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span></code> : CrÃ©Ã© les schÃ©mas propres Ã  GeoNature (<code class="docutils literal notranslate"><span class="pre">gn_commons</span></code>, <code class="docutils literal notranslate"><span class="pre">gn_synthese</span></code>, â¦).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature-samples</span></code> : InsÃ¨re quelques donnÃ©es dâexemple en base.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> : CrÃ©Ã© le schÃ©ma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code>. Fournie par TaxHub.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nomenclatures</span></code> : CrÃ©e le schÃ©ma <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures</span></code>. Fourni par Nomenclature-api-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nomenclatures_inpn_data</span></code> : InsÃ¨re le rÃ©fÃ©rentiel des nomenclatures de lâINPN en base. Fourni par Nomenclature-api-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nomenclatures_taxonomie</span></code> : ComplÃ¨te le schÃ©ma <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures</span></code> pour accueillir les nomenclatures liÃ©es Ã  la taxonomie.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nomenclatures_taxonomie_inpn_data</span></code> : InsÃ¨re les nomenclatures liÃ©es Ã  la taxonomie en base.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> : Installe le schÃ©ma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>. Fournie par UsersHub-authentification-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">utilisateurs-samples</span></code> : InsÃ¨re des donnÃ©es dâexemples (utilisateurs, groupes) dans le schÃ©ma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>. Fourni par UsersHub-authentification-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">habitats</span></code> : CrÃ©Ã© le schÃ©ma <code class="docutils literal notranslate"><span class="pre">ref_habitats</span></code>. Fourni par Habref-api-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">habitats_inpn_data</span></code> : InsÃ¨re le rÃ©fÃ©rentiel HABREF de lâINPN en base. Fourni par Habref-api-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> : CrÃ©Ã© le schÃ©ma <code class="docutils literal notranslate"><span class="pre">ref_geo</span></code>. Fourni par RefGeo.</p></li>
</ul>
<p>Si vous utilisez UsersHub, vous pouvez Ãªtre intÃ©ressÃ© par les branches suivantes :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">usershub</span></code> : DÃ©clare lâapplication UsersHub dans la liste des applications. Fourni par UsersHub.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usershub-samples</span></code> : Associe le groupe Â« Grp_admin Â» issue des donnÃ©es dâexemple Ã  lâapplication UsersHub et au profil Â« Administrateur Â» permettant aux utilisateurs du groupe de se connecter Ã  UsersHub. Fourni par UsersHub.</p></li>
</ul>
<p>Les branches ci-aprÃ¨s sont totalement optionnelles :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_inpn_grids_1</span></code> : InsÃ¨re les mailles 1Ã1 km (INPN) dans le rÃ©fÃ©rentiel gÃ©ographique (type de zone <code class="docutils literal notranslate"><span class="pre">M1</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_inpn_grids_5</span></code> : InsÃ¨re les mailles 5Ã5 km (INPN) dans le rÃ©fÃ©rentiel gÃ©ographique (type de zone <code class="docutils literal notranslate"><span class="pre">M5</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_inpn_grids_10</span></code> : InsÃ¨re les mailles 10Ã10 km (INPN) dans le rÃ©fÃ©rentiel gÃ©ographique (type de zone <code class="docutils literal notranslate"><span class="pre">M10</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_fr_municipalities</span></code> : InsÃ¨re les communes franÃ§aises (IGN fÃ©vrier 2020) dans le rÃ©fÃ©rentiel gÃ©ographique (type de zone <code class="docutils literal notranslate"><span class="pre">COM</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_fr_departments</span></code> : InsÃ¨re les dÃ©partements franÃ§ais (IGN fÃ©vrier 2020) dans le rÃ©fÃ©rentiel gÃ©ographique (type de zone <code class="docutils literal notranslate"><span class="pre">DEP</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ign_bd_alti</span></code> : InsÃ¨re le modÃ¨le numÃ©rique de terrain (MNT) de lâIGN en base.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ign_bd_alti_vector</span></code> : Vectorise le MNT.</p></li>
</ul>
<p>Note : pour plusieurs fichiers de rÃ©vision, notamment liÃ©s au rÃ©fÃ©rentiel gÃ©ographique ou nÃ©cessitant des donnÃ©es INPN, il est nÃ©cessaire de tÃ©lÃ©charger des ressources externes. Il est possible dâenregistrer les donnÃ©es tÃ©lÃ©chargÃ©es (et ne pas les re-tÃ©lÃ©charger si elles sont dÃ©jÃ  prÃ©sentes) avec <code class="docutils literal notranslate"><span class="pre">-x</span> <span class="pre">data-directory=â¦</span></code> :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>db<span class="w"> </span>upgrade<span class="w"> </span>â¦@head<span class="w"> </span>-x<span class="w"> </span>data-directory<span class="o">=</span>./data/
</pre></div>
</div>
</section>
</section>
<section id="gestion-des-droits">
<h3>Gestion des droits<a class="headerlink" href="#gestion-des-droits" title="Lien vers cette rubrique">Â¶</a></h3>
<section id="acces-a-geonature-et-cruved">
<h4>AccÃ¨s Ã  GeoNature et CRUVED<a class="headerlink" href="#acces-a-geonature-et-cruved" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Les comptes des utilisateurs, leur mot de passe, email, groupes et leur accÃ¨s Ã  lâapplication GeoNature sont gÃ©rÃ©s de maniÃ¨re centralisÃ©e dans lâapplication UsersHub. Pour quâun rÃ´le (utilisateur ou groupe) ait accÃ¨s Ã  GeoNature, il faut lui attribuer un profil de Â«Â LecteurÂ Â» dans lâapplication GeoNature, grÃ¢ce Ã  lâapplication UsersHub qui va modifier la table <code class="docutils literal notranslate"><span class="pre">utilisateurs.cor_role_app_profil</span></code>.</p>
<p>La gestion des droits (permissions) des rÃ´les, spÃ©cifique Ã  GeoNature, est ensuite gÃ©rÃ©e dans un schÃ©ma (<code class="docutils literal notranslate"><span class="pre">gn_permissions</span></code>) depuis le module ADMIN de GeoNature. Voir <a class="reference external" href="https://docs.geonature.fr/user-manual.html#gestion-des-permissions">https://docs.geonature.fr/user-manual.html#gestion-des-permissions</a>.</p>
<p>La gestion des permissions dans GeoNature, comme dans beaucoup dâapplications, est liÃ©e Ã  des actions (Create / Read / Update / Delete aka CRUD). Pour les besoins mÃ©tier de lâapplication, nous avons rajoutÃ© deux actions : Â«Â ExporterÂ Â» et Â«Â ValiderÂ Â» (non utilisÃ©e), ce qui donne le CRUVED : Create / Read / Update / Validate / Export / Delete.</p>
<p>Chaque module peut utiliser toutes ou certaines de ces actions.</p>
<p>Selon les modules, on peut appliquer des filtres sur ces actions. Notamment des filtres dâappartenance (portÃ©e / scope) :</p>
<ul class="simple">
<li><p>PortÃ©e 1 = Seulement mes donnÃ©es. Cela concerne les donnÃ©es sur lesquels je suis :</p>
<ul>
<li><p>observateur</p></li>
<li><p>personne ayant effectuÃ©e la saisie de la donnÃ©e</p></li>
<li><p>personnellement acteur du jeu de donnÃ©es de la donnÃ©e</p></li>
<li><p>personne ayant saisi le JDD de la donnÃ©e</p></li>
</ul>
</li>
<li><p>PortÃ©e 2 = Les donnÃ©es de mon organisme. PortÃ©e 1 + :</p>
<ul>
<li><p>les donnÃ©es sur lesquelles mon organisme est acteur du JDD de la donnÃ©e</p></li>
</ul>
</li>
</ul>
<p>Exemple :</p>
<ul class="simple">
<li><p>Utilisateur 1 peut effectuer lâaction Â«Â DELETEÂ Â» sur Â«Â SES DONNEESÂ Â»</p></li>
<li><p>Utilisateur Admin peut effectuer lâaction Â«Â UPDATEÂ Â» sur Â«Â TOUTES LES DONNEESÂ Â» (sans filtre dâappartenance)</p></li>
</ul>
<p>Ces permissions sont attribuÃ©es module par module, et Ã©ventuellement sur des objets de certains modules.</p>
</section>
<section id="cas-particulier-de-l-action-c">
<h4>Cas particulier de lâaction Â«Â CÂ Â»<a class="headerlink" href="#cas-particulier-de-l-action-c" title="Lien vers cette rubrique">Â¶</a></h4>
<div class="line-block">
<div class="line">Dans les modules de saisie (comme Occtax), on veut que des utilisateurs puissent saisir uniquement dans certains JDD.</div>
<div class="line">La liste des JDD ouverts Ã  la saisie est contrÃ´lÃ©e par lâaction Â«Â CREATEÂ Â» du module dans lequel on se trouve.</div>
<div class="line">Comme il nâest pas Â«Â normalÂ Â» de pouvoir saisir dans des JDD sur lesquels on nâa pas les permissions de lecture, la portÃ©e de lâaction Â«Â CREATEÂ Â» vient simplement rÃ©duire la liste des JDD sur lesquels on a les permissions de lecture (Â«Â READÂ Â»).</div>
<div class="line">MÃªme si la portÃ©e de lâaction Â«Â CREATEÂ Â» sur le module est supÃ©rieure Ã  celle de lâaction Â«Â READÂ Â», lâutilisateur ne verra que les JDD sur lesquels il a des permissions de lecture.</div>
</div>
</section>
<section id="permissions-d-administrateur">
<h4>Permissions dâadministrateur<a class="headerlink" href="#permissions-d-administrateur" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Chaque module (ou sous-module) dÃ©finit ses permissions disponibles lors de son installation. Cependant une fois installÃ©, aucun utilisateur nâa de permission sur un nouveau module. Il faut les dÃ©finir explicitement.</p>
<p>Une commande dÃ©diÃ©e permet dâajouter toutes les permissions sur tous les modules Ã  un groupe ou utilisateur ayant le rÃ´le dâadministrateur. Cette commande peut Ãªtre relancÃ©e aprÃ¨s lâinstallation dâun nouveau module :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># changer &quot;Grp_Admin&quot; par le nom de votre groupe d&#39;administrateur si vous l&#39;avez changÃ©</span>
geonature<span class="w"> </span>permissions<span class="w"> </span>supergrant<span class="w"> </span>--group<span class="w"> </span>--nom<span class="w"> </span><span class="s2">&quot;Grp_admin&quot;</span>
</pre></div>
</div>
</section>
<section id="recapitulatif">
<h4>RÃ©capitulatif<a class="headerlink" href="#recapitulatif" title="Lien vers cette rubrique">Â¶</a></h4>
<ul class="simple">
<li><p>Dans GeoNature on peut attribuer Ã  un role des actions possibles dans un module, sur lesquels on peut ajouter des filtres (dÃ©finis dans la table <code class="docutils literal notranslate"><span class="pre">gn_permissions.t_permissions</span></code>).</p></li>
<li><p>6 actions sont possibles dans GeoNature : Create / Read / Update / Validate / Export / Delete (aka CRUVED).</p></li>
<li><p>DiffÃ©rents types de filtre existent. Le plus courant est le filtre dâappartenance (portÃ©e) : 2 filtres dâappartenance sont attribuables Ã  des actions : Mes donnÃ©es / Les donnÃ©es de mon organisme. La synthÃ¨se dispose aussi dâun filtre de sensibilitÃ©.</p></li>
<li><p>Des fonctions PostgreSQL ont aussi Ã©tÃ© intÃ©grÃ©es pour faciliter la rÃ©cupÃ©ration de ces informations (<code class="docutils literal notranslate"><span class="pre">gn_permissions.cruved_for_user_in_module</span></code>, <code class="docutils literal notranslate"><span class="pre">gn_permissions.does_user_have_scope_permission</span></code>, â¦)</p></li>
<li><p>Si un utilisateur nâa aucune permission sur un module, alors il ne lui sera pas affichÃ© dans le menu latÃ©ral et il ne pourra pas y accÃ©der</p></li>
<li><p>Il est aussi possible de ne pas utiliser UsersHub pour gÃ©rer les utilisateurs et de connecter GeoNature Ã  un CAS (voir configuration). Actuellement ce paramÃ©trage est fonctionnel en se connectant au CAS de lâINPN (MNHN)</p></li>
</ul>
<p>A noter que toutes les actions et tous les filtres nâont pas Ã©tÃ© implÃ©mentÃ©es dans tous les modules. Elles le sont en fonction des besoins de chaque module. Chaque module dÃ©finit la liste de ses permissions disponibles (actions et filtres).</p>
</section>
</section>
<section id="nomenclatures">
<h3>Nomenclatures<a class="headerlink" href="#nomenclatures" title="Lien vers cette rubrique">Â¶</a></h3>
<ul class="simple">
<li><p>Toutes les valeurs des listes dÃ©roulantes sont gÃ©rÃ©es dans une table gÃ©nÃ©rique <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.t_nomenclatures</span></code></p></li>
<li><p>Elles sâappuient sur les nomenclatures du SINP (<a class="reference external" href="http://standards-sinp.mnhn.fr/nomenclature/">http://standards-sinp.mnhn.fr/nomenclature/</a>) qui peuvent Ãªtre dÃ©sactivÃ©es ou completÃ©es</p></li>
<li><p>Chaque nomenclature est associÃ©e Ã  un type (<code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.bib_nomenclatures_types</span></code>), et une vue par type de nomenclature a Ã©tÃ© ajoutÃ©e pour simplifier leur usage</p></li>
<li><p>Ces nomenclatures sont gÃ©rÃ©es dans un sous-module pour pouvoir les rÃ©utiliser (ainsi que leur mÃ©canisme) dans dâautres applications : <a class="reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/">https://github.com/PnX-SI/Nomenclature-api-module/</a></p></li>
<li><p>Les identifiants des nomenclatures et des types de nomenclature sont des serials (entiers auto-incrÃ©mentÃ©s) et ne sont pas prÃ©dÃ©finis lors de lâinstallation, ni utilisÃ©es en dur dans le code des applications. En effet, les nomenclatures peuvent varier en fonction des structures. On utilise le <code class="docutils literal notranslate"><span class="pre">cd_nomenclature</span></code> et le <code class="docutils literal notranslate"><span class="pre">mnÃ©monique</span></code> du type de nomenclature pour retrouver dynamiquement lâ<code class="docutils literal notranslate"><span class="pre">id_nomenclature</span></code> dâune nomenclature. Câest cependant cet identifiant quâon stocke au niveau des donnÃ©es pour garantir lâintÃ©gritÃ© rÃ©fÃ©rentielle</p></li>
<li><p>Chaque nomenclature peut Ãªtre associÃ©e Ã  un rÃ¨gne ou un group2inpn (<code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.cor_taxref_nomenclature</span></code>) pour proposer des nomenclatures correspondants Ã  un taxon</p></li>
<li><p>Il est possible de dÃ©sactiver des nomenclatures en passant la valeur de la colonne <code class="docutils literal notranslate"><span class="pre">active</span></code> en <cite>false</cite>.</p></li>
<li><p>Les valeurs par dÃ©faut sont dÃ©finies dans chaque module</p></li>
<li><p>Pour Occtax câest dans <code class="docutils literal notranslate"><span class="pre">pr_occtax.defaults_nomenclatures_value</span></code>. Elles peuvent Ãªtre dÃ©finies pour chaque type de nomenclature ainsi que par organisme, rÃ¨gne et/ou group2inpn</p></li>
<li><p>Si organisme = 0 alors la valeur par dÃ©faut sâapplique Ã  tous les organismes. Idem pour les rÃ¨gnes et group2inpn</p></li>
<li><p>La fonction <code class="docutils literal notranslate"><span class="pre">pr_occtax.get_default_nomenclature_value</span></code> permet de renvoyer lâid de la nomenclature par dÃ©faut</p></li>
<li><p>Ces valeurs par dÃ©faut sont aussi utilisÃ©es pour certains champs qui sont cachÃ©s (statut_observation, floutage, statut_validationâ¦) mais ne sont donc pas modifiables par lâutilisateur</p></li>
<li><p>Il existe aussi une table pour dÃ©finir des valeurs par dÃ©faut gÃ©nÃ©rales de nomenclature (<code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.defaults_nomenclatures_value</span></code>)</p></li>
<li><p>Elles peuvent Ãªtre administrÃ©es dans le module Admin de GeoNature.</p></li>
</ul>
</section>
<section id="metadonnees">
<h3>MÃ©tadonnÃ©es<a class="headerlink" href="#metadonnees" title="Lien vers cette rubrique">Â¶</a></h3>
<ul class="simple">
<li><p>Elles sont gÃ©rÃ©es dans le schÃ©ma <code class="docutils literal notranslate"><span class="pre">gn_meta</span></code> basÃ© sur le standard MÃ©tadonnÃ©es du SINP (<a class="reference external" href="http://standards-sinp.mnhn.fr/category/standards/metadonnees/">http://standards-sinp.mnhn.fr/category/standards/metadonnees/</a>).</p></li>
<li><p>Elles permettent de gÃ©rer des jeux de donnÃ©es, des cadres dâacquisition, des acteurs (propriÃ©taire, financeur, producteurâ¦) et des protocoles.</p></li>
<li><p>Elles peuvent Ãªtre administrÃ©es dans le module MÃ©tadonnÃ©es de GeoNature.</p></li>
<li><p>Les acteurs sont quant Ã  eux gÃ©rÃ©s dans la table <code class="docutils literal notranslate"><span class="pre">utilisateurs.bib_organismes</span></code> et donc paramÃ©trables dans UsersHub.</p></li>
</ul>
</section>
<section id="donnees-sig">
<h3>DonnÃ©es SIG<a class="headerlink" href="#donnees-sig" title="Lien vers cette rubrique">Â¶</a></h3>
<ul class="simple">
<li><p>Le schÃ©ma <code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> permet de gÃ©rer les donnÃ©es SIG (zonages, communes, MNTâ¦) de maniÃ¨re centralisÃ©e, potentiellement partagÃ© avec dâautres BDD</p></li>
<li><p>Il contient une table des zonages, des types de zonages, des communes, des grilles (mailles) et un MNT raster ou vectorisÃ© (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/issues/235">https://github.com/PnX-SI/GeoNature/issues/235</a>)</p></li>
<li><p>La fonction <code class="docutils literal notranslate"><span class="pre">ref_geo.fct_get_area_intersection</span></code> permet de renvoyer les zonages intersectÃ©s par une observation en fournissant sa gÃ©omÃ©trie</p></li>
<li><p>La fonction <code class="docutils literal notranslate"><span class="pre">ref_geo.fct_get_altitude_intersection</span></code> permet de renvoyer lâaltitude min et max dâune observation en fournissant sa gÃ©omÃ©trie</p></li>
<li><p>Les intersections dâune observation avec les zonages sont stockÃ©es au niveau de la synthÃ¨se (<code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code>) et non au niveau de la donnÃ©e source pour allÃ©ger et simplifier leur gestion</p></li>
</ul>
</section>
<section id="profils-de-taxons">
<h3>Profils de taxons<a class="headerlink" href="#profils-de-taxons" title="Lien vers cette rubrique">Â¶</a></h3>
<section id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Lien vers cette rubrique">Â¶</a></h4>
<p>GeoNature dispose dâun mÃ©canisme permettant de calculer des profils pour chaque taxon en se basant sur les donnÃ©es validÃ©es prÃ©sentes dans la SynthÃ¨se de lâinstance.</p>
<p>Ces profils sont stockÃ©s dans un schÃ©ma dÃ©diÃ© <code class="docutils literal notranslate"><span class="pre">gn_profiles</span></code>, et plus prÃ©cisÃ©ment dans les deux vues matÃ©rialisÃ©es suivantes :</p>
<ol class="arabic simple">
<li><p>La vue matÃ©rialisÃ©e <code class="docutils literal notranslate"><span class="pre">gn_profiles.vm_valid_profiles</span></code> comporte des informations gÃ©nÃ©rales sur chaque taxon :</p></li>
</ol>
<ul class="simple">
<li><p>Lâaire dâoccurrences</p></li>
<li><p>Les altitudes extrÃªmes dâobservation du taxon</p></li>
<li><p>Les dates de premiÃ¨re et de derniÃ¨re observation</p></li>
<li><p>Le nombre de donnÃ©es valides pour le taxon considÃ©rÃ©</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>La vue matÃ©rialisÃ©e <code class="docutils literal notranslate"><span class="pre">gn_profiles.vm_cor_taxon_phenology</span></code> comporte les Â«Â combinaisonsÂ Â» dâinformations relatives Ã  la phÃ©nologie des taxons (voir dÃ©tail des calculs ci-dessous) :</p></li>
</ol>
<ul class="simple">
<li><p>La pÃ©riode dâobservation</p></li>
<li><p>Le stade de vie (activable ou non)</p></li>
<li><p>Les altitudes min et max</p></li>
<li><p>Les altitudes Â«Â fiablesÂ Â» en Ã©cartant les valeurs extrÃªmes</p></li>
<li><p>Le nombre de donnÃ©es correspondant Ã  cette Â«Â combinaison phÃ©nologiqueÂ Â»</p></li>
</ul>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">gn_profiles.refresh_profiles()</span></code> permet de rafraichir ces vues matÃ©rialisÃ©es.</p>
<p>Pour lancer manuellement cette fonction, ouvrez une console SQL et exÃ©cutez la requÃªte <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">gn_profiles.refresh_profiles();</span></code>.</p>
<p>Cette fonction est aussi diponible en tant que fonction GeoNature quâil est prÃ©fÃ©rable dâutiliser : <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">profiles</span> <span class="pre">update</span></code></p>
<p>Pour automatiser lâexÃ©cution de cette fonction (tous les jours Ã  minuit dans cet exemple), <a class="reference internal" href="installation.html#cron"><span class="std std-ref">crÃ©er une tÃ¢che planfiÃ©e</span></a>.</p>
</section>
<section id="usage">
<h4>Usage<a class="headerlink" href="#usage" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Pour chaque taxon (cd_ref) disposant de donnÃ©es dans la vue <code class="docutils literal notranslate"><span class="pre">gn_profiles.v_synthese_for_profiles</span></code> (vue filtrÃ©e basÃ©e sur la synthÃ¨se de lâinstance), un profil est gÃ©nÃ©rÃ©. Il comporte lâaire dâoccurrence, les limites altitudinales et les combinaisons phÃ©nologiques jugÃ©es cohÃ©rentes sur la base des donnÃ©es disponibles.</p>
<p>Ces profils sont dÃ©clinÃ©s sur :</p>
<ul class="simple">
<li><p>Le module Validation permet dâattirer lâattention des validateurs sur les donnÃ©es qui sortent du Â«Â cadreÂ Â» dÃ©jÃ  connu pour le taxon considÃ©rÃ©, et dâapporter des Ã©lÃ©ments de contexte en complÃ©ment de la donnÃ©e en cours de validation</p></li>
<li><p>Le module SynthÃ¨se (fiche dâinformation, onglet validation) permet dâapporter des Ã©lÃ©ments de contexte en complÃ©ment des donnÃ©es brutes consultÃ©es</p></li>
<li><p>Le module Occtax permet dâalerter les utilisateurs lors de la saisie de donnÃ©es qui sortent du Â«Â cadreÂ Â» dÃ©jÃ  connu pour un taxon considÃ©rÃ©</p></li>
<li><p>Le processus de validation automatique permet de valider automatiquement les observations respectant le profil de taxons (non activÃ© par dÃ©faut).</p></li>
</ul>
<img alt="https://media.githubusercontent.com/media/PnX-SI/GeoNature/refs/heads/master/docs/images/validation.png" src="https://media.githubusercontent.com/media/PnX-SI/GeoNature/refs/heads/master/docs/images/validation.png" />
<img alt="https://media.githubusercontent.com/media/PnX-SI/GeoNature/refs/heads/master/docs/images/contexte_donnee.png" src="https://media.githubusercontent.com/media/PnX-SI/GeoNature/refs/heads/master/docs/images/contexte_donnee.png" />
<p>Plusieurs fonctions permettent de vÃ©rifier si une donnÃ©e de la synthÃ¨se est cohÃ©rente au regard du profil du taxon en question :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gn_profiles.check_profile_distribution</span></code> : permet de vÃ©rifier si la donnÃ©e testÃ©e est totalement incluse dans lâaire dâoccurrences dÃ©jÃ  connue pour son taxon.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gn_profiles.check_profile_phenology</span></code> : permet de vÃ©rifier si la phÃ©nologie dâune donnÃ©e (pÃ©riode, stade de vie, altitudes) est une combinaison dÃ©jÃ  connue dans le profil du taxon</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gn_profiles.check_profile_altitudes</span></code> : permet de vÃ©rifier si une donnÃ©e est bien situÃ©e dans la fourchette dâaltitudes connue pour le taxon en question</p></li>
</ul>
</section>
<section id="configuration-et-parametrage">
<h4>Configuration et paramÃ©trage<a class="headerlink" href="#configuration-et-parametrage" title="Lien vers cette rubrique">Â¶</a></h4>
<p><em>ParamÃ¨tres de calcul des profils</em> :</p>
<p>Le calcul des profils de taxons repose sur plusieurs variables, paramÃ©trables soit pour tout le mÃ©canisme, soit pour des taxons donnÃ©s.</p>
<p>Les paramÃ¨tres gÃ©nÃ©raux dans la table <code class="docutils literal notranslate"><span class="pre">gn_profiles.t_parameters</span></code> :</p>
<ul class="simple">
<li><p>Le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">id_valid_status_for_profiles</span></code> : permet de lister les <code class="docutils literal notranslate"><span class="pre">id_nomenclatures</span></code> des statuts de validation Ã  prendre en compte pour les calculs des profils. Par exemple, en ne listant que les identifiants des nomenclatures Â«Â Certain -trÃ¨s probableÂ Â» et Â«Â ProbableÂ Â», seules ces donnÃ©es valides seront prises en compte lors du calcul des profils (comportement par dÃ©faut). En listant tous les identifiants des nomenclatures des statuts de validation, lâensemble des donnÃ©es alimenteront les profils de taxons.</p></li>
<li><p>Le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">id_rang_for_profiles</span></code> : permet de lister les <code class="docutils literal notranslate"><span class="pre">id_rang</span></code> de Taxref Ã  prendre en compte pour les calculs des profils. Par dÃ©faut, les profils ne sont calculÃ©s que pour les cd_ref correspondant Ã  des Genres, EspÃ¨ces et Sous-espÃ¨ces.</p></li>
<li><p>Le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> dÃ©finit le pourcentage de donnÃ©es Ã  conserver lors du calcul des altitudes valides (<code class="docutils literal notranslate"><span class="pre">gn_profiles.vm_cor_taxon_phenology</span></code>), en retirant ainsi les extrÃªmes. Ce paramÃ¨tre, dÃ©finit Ã  95% par dÃ©faut, doit Ãªtre compris entre 51 et 100% (voir dÃ©tails ci-aprÃ¨s).</p></li>
</ul>
<p>Les deux premiers paramÃ¨tres permettent de filtrer les donnÃ©es dans la vue <code class="docutils literal notranslate"><span class="pre">gn_profiles.v_synthese_for_profiles</span></code>. Cette vue comporte les donnÃ©es de la synthÃ¨se qui rÃ©pondent aux paramÃ¨tres et qui alimenteront les profils de taxons. Les clauses WHERE de cette vue peuvent Ãªtre adaptÃ©es pour filtrer les donnÃ©es sur davantage de critÃ¨res et rÃ©pondre aux besoins plus spÃ©cifiques, mais sa structure doit rester inchangÃ©e.</p>
<p>Les paramÃ¨tres dÃ©finis par taxon le sont dans la table <code class="docutils literal notranslate"><span class="pre">gn_profiles.cor_taxons_parameters</span></code> :</p>
<p>Les profils peuvent Ãªtre calculÃ©s avec des rÃ¨gles diffÃ©rentes en fonction des taxons. Ceux-ci sont dÃ©finis au niveau du cd_nom, Ã  nâimporte quel rang (espÃ¨ce, famille, rÃ¨gne etc). Ils seront appliquÃ©s de maniÃ¨re rÃ©cursive Ã  tous les taxons situÃ©s Â«Â sousÂ Â» le cd_ref paramÃ©trÃ©.</p>
<p>Dans le cas oÃ¹ un taxon hÃ©rite de plusieurs rÃ¨gles (une dÃ©finie pour son ordre et une autre dÃ©finie pour sa famille par exemple), les paramÃ¨tres dÃ©finis au plus proche du taxon considÃ©rÃ© seront pris en compte.</p>
<p>Par exemple, sâil existe des paramÃ¨tres pour le phylum Â«Â AnimaliaÂ Â» (cd_nom 183716) et dâautres pour le renard (cd_nom 60585), les paramÃ¨tres du renard seront appliquÃ©s en prioritÃ© pour cette espÃ¨ce, mais les paramÃ¨tres Animalia sâappliqueront Ã  tous les autres animaux.</p>
<p>Les rÃ¨gles appliquables Ã  chaque taxon sont rÃ©cupÃ©rÃ©es par la fonction <code class="docutils literal notranslate"><span class="pre">gn_profiles.get_parameters(cdnom)</span></code>.</p>
<p>Pour chaque cd_nom, il est ainsi possible de dÃ©finir les paramÃ¨tres suivants :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spatial_precision</span></code> : La prÃ©cision spatiale utilisÃ©e pour calculer les profils. Elle est exprimÃ©e selon lâunitÃ© de mesure de la projection locale de lâinstance GeoNature : mÃ¨tres pour le Lambert93, degrÃ© pour le WGS84 etc. Elle dÃ©finit Ã  la fois la taille de la zone tampon appliquÃ©e autour de chaque observation pour dÃ©finir lâaire dâoccurrences du taxon, ainsi que la distance maximale admise entre le centroÃ¯de et les limites dâune observation pour quâelle soit prise en compte lors du calcul des profils (Ã©vite quâune donnÃ©e imprÃ©cise valide Ã  elle seule une grande zone).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">temporal_precision_days</span></code> : La prÃ©cision temporelle en jours utilisÃ©e pour calculer les profils. Elle dÃ©finit Ã  la fois le pas de temps avec lequel la phÃ©nologie est calculÃ©e, ainsi que la prÃ©cision temporelle minimale requise (diffÃ©rence entre date dÃ©but et date fin de lâobservation) pour quâune donnÃ©e soit prise en compte dans le calcul des profils. Une prÃ©cision de 365 jours ou plus permettra de ne pas tenir compte de la pÃ©riode (toutes les donnÃ©es seront dans une unique pÃ©riode de lâannÃ©e).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">active_life_stage</span></code> : DÃ©finit si le stade de vie doit Ãªtre pris en compte ou non lors du calcul des profils.</p></li>
</ul>
<p>Par dÃ©faut, une prÃ©cision spatiale de 2000m et une prÃ©cision temporelle de 10j (dÃ©cade) sont paramÃ©trÃ©s pour tous les phylums, sans tenir compte des stades de vie.</p>
<p>A terme, dâautres variables pourront complÃ©ter ces profils : habitats (habref) ou comportement (nidification, reproduction, migrationâ¦) notamment.</p>
<p><em>Configuration - Activer/dÃ©sactiver les profils</em> :</p>
<p>Il est possible de dÃ©sactiver lâensemble des fonctionnalitÃ©s liÃ©es aux profils dans lâinterface, en utilisant le paramÃ¨tre suivant dans le fichier <code class="docutils literal notranslate"><span class="pre">geonature/config/geonature_config.toml</span></code></p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[FRONTEND]</span>
<span class="w">  </span><span class="n">ENABLE_PROFILES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="err">/</span><span class="n">false</span>
</pre></div>
</div>
</section>
<section id="calcul-des-phenologies">
<h4>Calcul des phÃ©nologies<a class="headerlink" href="#calcul-des-phenologies" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Pour chaque taxon, la phÃ©nologie est calculÃ©e en croisant dans un premier temps les pÃ©riodes dâobservations et, selon les paramÃ¨tres, les stades de vie.</p>
<p>Pour chacune des combinaisons obtenues (pÃ©riode x stade de vie), sont alors calculÃ©es :</p>
<ul class="simple">
<li><p>Lâaltitude minimale (toutes donnÃ©es comprises)</p></li>
<li><p>Lâaltitude maximale (toutes donnÃ©es comprises)</p></li>
<li><p>Lâaltitude minimale fiable (en retirant x% de donnÃ©es extrÃªmes selon le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code>)</p></li>
<li><p>Lâaltitude maximale fiable (en retirant x% de donnÃ©es extrÃªmes selon le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code>)</p></li>
<li><p>Le nombre de donnÃ©es valides correspondantes</p></li>
</ul>
<p><em>Exclusion des donnÃ©es extrÃªmes</em></p>
<p>Afin que des donnÃ©es exceptionnelles, bien que valides, ne soient pas considÃ©rÃ©es comme une Â«Â normeÂ Â», les profils permettent dâexclure un certain pourcentage de donnÃ©es extrÃªmes. Pour ce faire :</p>
<ul class="simple">
<li><p>Le nombre de donnÃ©es exclues est systÃ©matiquement arrondi Ã  lâentier supÃ©rieur, pour les extrÃªmes Â«Â basÂ Â» et les extrÃªmes Â«Â hautsÂ Â»</p></li>
<li><p>Aucune altitude fiable nâest calculÃ©e sâil y a davantage de donnÃ©es exclues que de donnÃ©es conservÃ©es</p></li>
<li><p>Le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> doit donc Ãªtre compris entre 51 et 100% : en dessous de 50%, le nombre de donnÃ©es supprimÃ©es est supÃ©rieur au nombre de donnÃ©es conservÃ©es, aucune altitude fiable ne sera calculÃ©e. Si le paramÃ¨tre est Ã  100%, les altitudes fiables seront identiques aux altitudes extrÃªmes observÃ©es pour la pÃ©riode (et le stade) donnÃ©s</p></li>
</ul>
<p>Il faut donc (1/[1- <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> /100])+1 donnÃ©es pour que des altitudes fiables soient calculÃ©es, soit :</p>
<ul class="simple">
<li><p>101 donnÃ©es minimum par pÃ©riode/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =99</p></li>
<li><p>51 donnÃ©es minimum par pÃ©riode/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =98</p></li>
<li><p>21 donnÃ©es minimum par pÃ©riode/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =95</p></li>
<li><p>11 donnÃ©es minimum par pÃ©riode/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =90</p></li>
<li><p>3 donnÃ©es minimum par pÃ©riode/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =51</p></li>
</ul>
</section>
</section>
<section id="fonctions">
<h3>Fonctions<a class="headerlink" href="#fonctions" title="Lien vers cette rubrique">Â¶</a></h3>
<p>La base de donnÃ©es contient de nombreuses fonctions.</p>
<p><strong>gn_synthese</strong></p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Fonction</p></th>
<th class="head"><p>ParamÃ¨tres</p></th>
<th class="head"><p>RÃ©sultat</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>get_default_nomenclature_value</p></td>
<td><p>id_type_nomenclature,
idorganism, regne, group2inpn</p></td>
<td><p>Entier</p></td>
<td><p>Function that return the default
nomenclature id with a nomenclature
type, organism id, regne, group2_inpn</p></td>
</tr>
<tr class="row-odd"><td><p>fct_trig_insert_in_cor_area_synthese</p></td>
<td><p>geom</p></td>
<td><p>Trigger</p></td>
<td><p>Trigger intersectant la gÃ©omÃ©trie
dâune observation avec tous les zonages</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>ref_geo</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ref_geo</span><span class="p">.</span><span class="n">fct_get_altitude_intersection</span><span class="p">(</span><span class="k">IN</span><span class="w"> </span><span class="n">mygeom</span><span class="w"> </span><span class="n">geometry</span><span class="p">)</span>
<span class="c1">-- Fonction qui retourne l&#39;altitude min et max de la gÃ©omÃ©trie passÃ©e en paramÃ¨tre</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ref_geo</span><span class="p">.</span><span class="n">fct_get_area_intersection</span><span class="p">(</span>
<span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">mygeom</span><span class="w"> </span><span class="n">geometry</span><span class="p">,</span>
<span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">myidtype</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">::</span><span class="nb">integer</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">TABLE</span><span class="p">(</span><span class="n">id_area</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">id_type</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">area_code</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">area_name</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span>
<span class="c1">-- Fonction qui retourne un tableau des zonages (id_area) intersectant la gÃ©omÃ©trie passÃ©e en paramÃ¨tre</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ref_geo</span><span class="p">.</span><span class="n">get_id_area_type</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function which return the id_type_area from the type_code of an area type</span>
</pre></div>
</div>
<p><strong>pr_occtax</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">pr_occtax</span><span class="p">.</span><span class="n">get_id_counting_from_id_releve</span><span class="p">(</span><span class="n">my_id_releve</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span><span class="p">[]</span>
<span class="c1">-- Function which return the id_countings in an array (table pr_occtax.cor_counting_occtax) from the id_releve(integer)</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">myidorganism</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">myregne</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">mygroup2inpn</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function that return the default nomenclature id with wanteds nomenclature type, organism id, regne, group2_inp  --Return -1 if nothing matche with given parameters</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">pr_occtax</span><span class="p">.</span><span class="n">insert_in_synthese</span><span class="p">(</span><span class="n">my_id_counting</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span><span class="p">[]</span>
</pre></div>
</div>
<p><strong>ref_nomenclatures</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_id_nomenclature_type</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function which return the id_type from the mnemonique of a nomenclature type</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">myidorganism</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function that return the default nomenclature id with wanteds nomenclature type (mnemonique), organism id</span>
<span class="c1">--Return -1 if nothing matche with given parameters</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">check_nomenclature_type_by_mnemonique</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--Function that checks if an id_nomenclature matches with wanted nomenclature type (use mnemonique type)</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">check_nomenclature_type_by_cd_nomenclature</span><span class="p">(</span><span class="n">mycdnomenclature</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span>
<span class="c1">--Function that checks if an id_nomenclature matches with wanted nomenclature type (use mnemonique type)</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">check_nomenclature_type_by_id</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">myidtype</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--Function that checks if an id_nomenclature matches with wanted nomenclature type (use id_type)</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_id_nomenclature</span><span class="p">(</span>
<span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span>
<span class="n">mycdnomenclature</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function which return the id_nomenclature from an mnemonique_type and an cd_nomenclature</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_nomenclature_label</span><span class="p">(</span>
<span class="n">myidnomenclature</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="n">mylanguage</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span>
<span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span>
<span class="c1">--Function which return the label from the id_nomenclature and the language</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_cd_nomenclature</span><span class="p">(</span><span class="n">myidnomenclature</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span>
<span class="c1">--Function which return the cd_nomenclature from an id_nomenclature</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_filtered_nomenclature</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">myregne</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">mygroup</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function that returns a list of id_nomenclature depending on regne and/or group2_inpn sent with parameters.</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">calculate_sensitivity</span><span class="p">(</span>
<span class="n">mycdnom</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="n">mynomenclatureid</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function to return id_nomenclature depending on observation sensitivity</span>
<span class="c1">--USAGE : SELECT ref_nomenclatures.calculate_sensitivity(240,21);</span>
</pre></div>
</div>
<p><strong>gn_profiles</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">gn_profiles</span><span class="p">.</span><span class="n">get_parameters</span><span class="p">(</span><span class="n">mycdnom</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">TABLE</span><span class="p">(</span><span class="n">cd_ref</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">spatial_precision</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">temporal_precision_days</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">active_life_stage</span><span class="w"> </span><span class="nb">boolean</span><span class="p">,</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="nb">smallint</span><span class="p">)</span>
<span class="c1">-- fonction permettant de rÃ©cupÃ©rer les paramÃ¨tres les plus adaptÃ©s</span>
<span class="c1">-- (dÃ©finis au plus proche du taxon) pour calculer le profil d&#39;un taxon donnÃ©</span>
<span class="c1">-- par exemple, s&#39;il existe des paramÃ¨tres pour les &quot;Animalia&quot; des paramÃ¨tres pour le renard,</span>
<span class="c1">-- les paramÃ¨tres du renard surcoucheront les paramÃ¨tres Animalia pour cette espÃ¨ce</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">gn_profiles</span><span class="p">.</span><span class="n">check_profile_distribution</span><span class="p">(</span>
<span class="w">    </span><span class="n">in_geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">,</span>
<span class="w">    </span><span class="n">profil_geom</span><span class="w"> </span><span class="n">geometry</span>
<span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--fonction permettant de vÃ©rifier la cohÃ©rence d&#39;une donnÃ©e d&#39;occurrence en s&#39;assurant que sa localisation est totalement incluse dans l&#39;aire d&#39;occurrences valide dÃ©finie par le profil du taxon en question</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">gn_profiles</span><span class="p">.</span><span class="n">check_profile_phenology</span><span class="p">(</span>
<span class="w">    </span><span class="n">in_cd_ref</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_date_min</span><span class="w"> </span><span class="nb">date</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_date_max</span><span class="w"> </span><span class="nb">date</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_altitude_min</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_altitude_max</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_id_nomenclature_life_stage</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">check_life_stage</span><span class="w"> </span><span class="nb">boolean</span>
<span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--fonction permettant de vÃ©rifier la cohÃ©rence d&#39;une donnÃ©e d&#39;occurrence en s&#39;assurant que sa phÃ©nologie (dates, altitude, stade de vie selon les paramÃ¨tres) correspond bien Ã  la phÃ©nologie valide dÃ©finie par le profil du taxon en question</span>
<span class="c1">--La fonction renvoie &#39;false&#39; pour les donnÃ©es trop imprÃ©cises (durÃ©e d&#39;observation supÃ©rieure Ã  la prÃ©cision temporelle dÃ©finie dans les paramÃ¨tres des profils).</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">gn_profiles</span><span class="p">.</span><span class="n">check_profile_altitudes</span><span class="p">(</span>
<span class="w">  </span><span class="n">in_alt_min</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">in_alt_max</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">profil_altitude_min</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">profil_altitude_max</span><span class="w"> </span><span class="nb">integer</span>
<span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--fonction permettant de vÃ©rifier la cohÃ©rence d&#39;une donnÃ©e d&#39;occurrence en s&#39;assurant que son altitude se trouve entiÃ¨rement comprise dans la fourchette altitudinale valide du taxon en question</span>
</pre></div>
</div>
</section>
<section id="tables-transversales">
<h3>Tables transversales<a class="headerlink" href="#tables-transversales" title="Lien vers cette rubrique">Â¶</a></h3>
<p>GeoNature contient aussi des tables de stockage transversales qui peuvent Ãªtre utilisÃ©es par tous les modules. Câest le cas pour la validation, la sensibilitÃ©, lâhistorisation des modifications et les mÃ©dias.</p>
<p>Cela permet de ne pas avoir Ã  mettre en place des tables et mÃ©canismes dans chaque module, mais de sâappuyer sur un stockage, des fonctions et dÃ©veloppements factorisÃ©s, centralisÃ©s et partagÃ©s.</p>
<p>Ces tables utilisent notamment le mÃ©canisme des UUID (identifiant unique) pour retrouver les enregistrements. Depuis une table source (Occtax ou un autre module) on peut retrouver les enregistrements stockÃ©es dans les tables transversales en utilisant un <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">&lt;TABLE_TRANSVERSALE&gt;.uuid_attached_row</span> <span class="pre">=</span> <span class="pre">&lt;MON_UUID_SOURCE&gt;</span></code> et ainsi retrouver lâhistorique de validation, les mÃ©dias ou encore la sensibilitÃ© associÃ©s Ã  une donnÃ©e.</p>
<p>Voir <a class="reference external" href="https://github.com/PnX-SI/GeoNature/issues/339">https://github.com/PnX-SI/GeoNature/issues/339</a></p>
</section>
<section id="triggers-vers-la-synthese">
<h3>Triggers vers la synthÃ¨se<a class="headerlink" href="#triggers-vers-la-synthese" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Voir ceux mis en place de Occtax vers SynthÃ¨se.</p>
<p>Cheminement dâune donnÃ©e Occtax :</p>
<ol class="arabic simple">
<li><p>Formulaire Occtax</p></li>
<li><p>Ecriture dans la table <code class="docutils literal notranslate"><span class="pre">cor_counting_occtax</span></code> et gÃ©nÃ©ration dâun nouvel UUID</p></li>
<li><p>Trigger dâÃ©criture dans la table verticale <code class="docutils literal notranslate"><span class="pre">t_validations</span></code> Ã  partir de la valeur par dÃ©faut de la nomenclature de validation (<code class="docutils literal notranslate"><span class="pre">gn_common.ref_nomenclatures.defaults_nomenclatures_value</span></code>)</p></li>
<li><p>Trigger dâÃ©criture dâOcctax vers la synthÃ¨se (on ne maitrise pas lâordre de ces 2 triggers qui sont lancÃ©s en mÃªme temps)</p></li>
<li><p>Trigger de rapatriement du dernier statut de validation de la table verticale vers la synthÃ¨se.</p></li>
</ol>
</section>
<section id="triggers-dans-la-synthese">
<h3>Triggers dans la synthÃ¨se<a class="headerlink" href="#triggers-dans-la-synthese" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Version 2.1.0 de GeoNature</p>
<img alt="https://geonature.fr/docs/img/2019-06-triggers-gn_synthese.jpg" src="https://geonature.fr/docs/img/2019-06-triggers-gn_synthese.jpg" />
<p><strong>Table : synthese</strong></p>
<p>Table contenant lâensemble des donnÃ©es.
Respecte le standard Occurrence de taxon du SINP.</p>
<ul class="simple">
<li><p>tri_meta_dates_change_synthese</p>
<ul>
<li><p>BEFORE INSERT OR UPDATE</p></li>
<li><p>Mise Ã  jour des champs <code class="docutils literal notranslate"><span class="pre">meta_create_date</span></code> et <code class="docutils literal notranslate"><span class="pre">meta_update_date</span></code></p></li>
</ul>
</li>
<li><p>tri_insert_cor_area_synthese</p>
<ul>
<li><p>AFTER INSERT OR UPDATE OF the_geom_local</p></li>
<li><p>Mise Ã  jour de la table <code class="docutils literal notranslate"><span class="pre">cor_area_synthese</span></code></p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>Si update : suppression des enregistrements de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code> avec lâid_synthese concernÃ©</p></li>
<li><p>Insertion des id_areas intersectant la gÃ©omÃ©trie de la synthÃ¨se dans <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code>. <em>Prise en compte de toutes les aires quâelles soient ou non actives. Manque enable = true</em></p></li>
</ol>
</li>
</ul>
</li>
<li><p>tri_del_area_synt_maj_corarea_tax</p>
<ul>
<li><p>BEFORE DELETE</p></li>
<li><p>Mise Ã  jour des tables <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> et <code class="docutils literal notranslate"><span class="pre">cor_area_synthese</span></code></p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>RÃ©cupÃ©ration de lâensemble des aires intersectant la donnÃ©e de synthÃ¨se</p></li>
<li><p>Suppression des enregistrement de <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> avec le cd_nom et les aires concernÃ©s</p></li>
<li><p>Insertion dans <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> recalculant les max, nb_obs et couleur pour chaque aire pour lâensemble des donnÃ©es avec les aires concernÃ©es et le cd_nom concernÃ© ne correspondant pas Ã  la donnÃ©e supprimÃ©e</p></li>
<li><p>Suppression des enregistrements de <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code></p></li>
</ol>
</li>
</ul>
</li>
<li><p>tri_update_cor_area_taxon_update_cd_nom</p>
<ul>
<li><p>AFTER UPDATE OF cd_nom</p></li>
<li><p>Mise Ã  jour de la table cor_area_taxon</p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>RÃ©cupÃ©ration de lâensemble des aires intersectant la donnÃ©e de synthÃ¨se</p></li>
<li><p>Recalcul <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> pour lâancien cd_nom via fonction <code class="docutils literal notranslate"><span class="pre">gn_synthese.delete_and_insert_area_taxon</span></code></p></li>
<li><p>Recalcul <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> pour le nouveau cd_nom via fonction <code class="docutils literal notranslate"><span class="pre">gn_synthese.delete_and_insert_area_taxon</span></code></p></li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>Table : cor_area_synthese</strong></p>
<p>Table contenant lâensemble des id_areas intersectant les enregistrements de la synthÃ¨se</p>
<ul class="simple">
<li><p>tri_maj_cor_area_taxon</p>
<ul>
<li><p>AFTER INSERT OR UPDATE</p></li>
<li><p>Mise Ã  jour des donnÃ©es de cor_area_taxon</p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>RÃ©cupÃ©ration du cd_nom en lien avec lâenregistrement <code class="docutils literal notranslate"><span class="pre">cor_area_synthese</span></code></p></li>
<li><p>Suppression des donnÃ©es de <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> avec le <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> et <code class="docutils literal notranslate"><span class="pre">id_area</span></code> concernÃ©s</p></li>
<li><p>Insertion des donnÃ©es dans <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> en lien avec le <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> et <code class="docutils literal notranslate"><span class="pre">id_area</span></code></p></li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>Table : cor_observer_synthese</strong></p>
<ul class="simple">
<li><p>trg_maj_synthese_observers_txt</p>
<ul>
<li><p>AFTER INSERT OR UPDATE OR DELETE</p></li>
<li><p>Mise Ã  jour du champ <code class="docutils literal notranslate"><span class="pre">observers</span></code> de la table <code class="docutils literal notranslate"><span class="pre">synthese</span></code></p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>Construction de la valeur textuelle des observateurs</p></li>
<li><p>Mise Ã  jour du champ observer de lâenregistrement de la table <code class="docutils literal notranslate"><span class="pre">synthese</span></code></p></li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>FONCTIONS</strong></p>
<ul class="simple">
<li><p>delete_and_insert_area_taxon</p>
<ul>
<li><p>Fonction qui met Ã  jour la table <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> en fonction dâun <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> et dâune liste dâ<code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">area</span></code></p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>Suppression des enregistrement de la table <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> avec le <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> et les <code class="docutils literal notranslate"><span class="pre">id_area</span></code> concernÃ©s</p></li>
<li><p>Insertion des donnÃ©es dans <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code></p></li>
</ol>
</li>
</ul>
</li>
<li><p>color_taxon</p>
<ul>
<li><p>Fonction qui associe une couleur Ã  une durÃ©e</p></li>
<li><p><em>Passer les couleurs en paramÃ¨tres : table  gn_commons.t_parameters ?</em></p></li>
<li><p><em>Passer la fonction en immutable</em></p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="modularite">
<h2>ModularitÃ©<a class="headerlink" href="#modularite" title="Lien vers cette rubrique">Â¶</a></h2>
<p>Chaque module doit avoir son propre schÃ©ma dans la BDD, avec ses propres fichiers SQL de crÃ©ation comme le module OccTax : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/tree/develop/contrib/occtax/data">https://github.com/PnX-SI/GeoNature/tree/develop/contrib/occtax/data</a></p>
<p>CÃ´tÃ© Backend, chaque module a aussi son modÃ¨le et ses routes : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/tree/develop/contrib/occtax/backend">https://github.com/PnX-SI/GeoNature/tree/develop/contrib/occtax/backend</a></p>
<p>Idem cÃ´tÃ© Frontend, oÃ¹ chaque module a sa configuration et ses composants : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/tree/develop/contrib/occtax/frontend/app">https://github.com/PnX-SI/GeoNature/tree/develop/contrib/occtax/frontend/app</a></p>
<p>Mais en pouvant utiliser des composants du CÅur comme expliquÃ© dans la documentation Developpeur.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Lien vers cette rubrique">Â¶</a></h2>
<p>Pour configurer GeoNature, actuellement il y a :</p>
<ul class="simple">
<li><p>Une configuration pour lâinstallation : <code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code></p></li>
<li><p>Une configuration globale de lâapplication : <code class="docutils literal notranslate"><span class="pre">&lt;GEONATURE_DIRECTORY&gt;/config/geonature_config.toml</span></code> (gÃ©nÃ©rÃ©e lors de lâinstallation de GeoNature)</p></li>
<li><p>Une configuration optionnelle par module : placÃ©e dans le dossier de configuration de GeoNature (<code class="docutils literal notranslate"><span class="pre">&lt;GEONATURE_DIRECTORY&gt;/config/</span></code>)</p></li>
<li><p>Une table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_parameters</span></code> pour des paramÃ¨tres gÃ©rÃ©s dans la BDD</p></li>
</ul>
<p>TODO : Partie Â«Â Configuration applicativeÂ Â» du schÃ©ma Ã  mettre Ã  jour, car caduque.</p>
<img alt="https://geonature.fr/docs/img/admin-manual/administration-geonature.png" src="https://geonature.fr/docs/img/admin-manual/administration-geonature.png" />
<section id="configuration-generale-de-l-application">
<h3>Configuration gÃ©nÃ©rale de lâapplication<a class="headerlink" href="#configuration-generale-de-l-application" title="Lien vers cette rubrique">Â¶</a></h3>
<p>La configuration gÃ©nÃ©rale de GeoNature se fait dans le fichier <code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code>.
Une version minimaliste est gÃ©nÃ©rÃ©e Ã  lâinstallation Ã  partir du fichier <code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code>.
Vous pouvez complÃ©ter votre configuration en vous inspirant des paramÃ¨tres par dÃ©faut prÃ©sents dans le fichier <code class="docutils literal notranslate"><span class="pre">config/default_config.toml.example</span></code>.</p>
<p id="post-config-change">Depuis la version 2.12.0 de GeoNature, la configuration de GeoNature et de ses modules est envoyÃ©e dynamiquement du backend au frontend par lâAPI de GeoNature et ne nÃ©cessite donc plus de regÃ©nÃ©rer la configuration ni de rebuilder le frontend.</p>
<p>De plus, Ã  chaque modification du fichier de configuration de GeoNature ou dâun de ses modules, le backend est rechargÃ© automatiquement.</p>
<p>Cependant, si vous faites une erreur dans un des fichiers de configuration, le chargement automatique va entrainer un plantage de GeoNature. Dans ce cas, mme si lâerreur dâun des fichiers de configuration est corrigÃ©e, il faut redÃ©marrer manuellement GeoNature avec la commande <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">geonature</span></code>.</p>
<p>Pour les versions prÃ©cÃ©dentes de GeoNature, Ã  chaque modification du fichier de configuration, vous devez :</p>
<ul>
<li><p>relancer le backend : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">geonature</span></code></p></li>
<li><p>regÃ©nÃ©rer le fichier de configuration du frontend :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>backend/venv/bin/activate
geonature<span class="w"> </span>generate-frontend-config
</pre></div>
</div>
</li>
<li><p>rebuilder le frontend :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>frontend
nvm<span class="w"> </span>use
npm<span class="w"> </span>run<span class="w"> </span>build
</pre></div>
</div>
</li>
</ul>
<p>Vous pouvez Ã©galement lancer la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">update-configuration</span></code> qui gÃ©nÃ¨rera la configuration frontend de GeoNature ainsi que de lâensemble des modules installÃ©s avant de lancer le build du frontend.</p>
</section>
<section id="configuration-d-un-gn-module">
<h3>Configuration dâun gn_module<a class="headerlink" href="#configuration-d-un-gn-module" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Voir la <a class="reference internal" href="installation.html#module-config"><span class="std std-ref">rubrique concernant la configuration des modules</span></a>.</p>
</section>
</section>
<section id="exploitation">
<h2>Exploitation<a class="headerlink" href="#exploitation" title="Lien vers cette rubrique">Â¶</a></h2>
<section id="logs">
<h3>Logs<a class="headerlink" href="#logs" title="Lien vers cette rubrique">Â¶</a></h3>
<ul class="simple">
<li><p>Logs dâinstallation de GeoNature : <code class="docutils literal notranslate"><span class="pre">geonature/install/install.log</span></code></p></li>
<li><p>Logs de GeoNature : <code class="docutils literal notranslate"><span class="pre">/var/log/geonature/geonature.log</span></code></p></li>
<li><p>Logs du worker Celery : <code class="docutils literal notranslate"><span class="pre">/var/log/geonature/geonature-worker.log</span></code></p></li>
<li><p>Logs de UsersHub : <code class="docutils literal notranslate"><span class="pre">/var/log/usershub.log</span></code></p></li>
</ul>
</section>
<section id="commandes-geonature">
<h3>Commandes GeoNature<a class="headerlink" href="#commandes-geonature" title="Lien vers cette rubrique">Â¶</a></h3>
<p>GeoNature est fourni avec une sÃ©rie de commandes pour administrer lâapplication.
Pour les exÃ©cuter, il est nÃ©cessaire dâÃªtre dans le virtualenv python de GeoNature</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd &lt;GEONATURE_DIRECTORY&gt;</span>
<span class="go">source backend/venv/bin/activate</span>
</pre></div>
</div>
<p>Le prÃ©fixe (venv) se met alors au dÃ©but de votre invite de commande.</p>
<p>Voici la liste des commandes disponibles (aussi disponibles en tapant la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">--help</span></code>) :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">activate-gn-module</span></code> : Active un gn_module installÃ© (PossibilitÃ© dâactiver seulement le backend ou le frontend)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deactivate-gn-module</span></code> : DÃ©sactive gn_un module activÃ© (PossibiltÃ© de dÃ©sactiver seulement le backend ou le frontend)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dev-back</span></code> : Lance le backend en mode dÃ©veloppement</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generate-frontend-module-route</span></code> : GÃ©nÃ¨re ou regÃ©nÃ¨re le fichier de routing du frontend en incluant les gn_module installÃ©s (Fait automatiquement lors de lâinstallation dâun module)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">install-gn-module</span></code> : Installe un gn_module</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generate-frontend-config</span></code> : RegÃ©nÃ¨re le fichier de configuration du frontend. A exÃ©cuter suite Ã  une modification du fichier <code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code> (utile avant GeoNature 2.12.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update-module-configuration</span></code> : Met Ã  jour la configuration dâun module. A exÃ©cuter suite Ã  une modification du fichier <code class="docutils literal notranslate"><span class="pre">conf_gn_module.toml</span></code> (utile avant GeoNature 2.12.0)</p></li>
</ul>
<p>Effectuez <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">&lt;nom_commande&gt;</span> <span class="pre">--help</span></code> pour accÃ©der Ã  la documentation et Ã  des exemples dâutilisation de chaque commande.</p>
</section>
<section id="demarrer-arreter-les-api">
<h3>DÃ©marrer / arrÃªter les API<a class="headerlink" href="#demarrer-arreter-les-api" title="Lien vers cette rubrique">Â¶</a></h3>
<ul class="simple">
<li><p>DÃ©marrer GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">geonature</span></code></p></li>
<li><p>ArrÃªter GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">stop</span> <span class="pre">geonature</span></code></p></li>
<li><p>Recharger GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">reload</span> <span class="pre">geonature</span></code></p></li>
<li><p>RedÃ©marrer GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">geonature</span></code></p></li>
<li><p>VÃ©rifier lâÃ©tat de GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">geonature</span></code></p></li>
</ul>
</section>
<section id="supervision-des-services">
<h3>Supervision des services<a class="headerlink" href="#supervision-des-services" title="Lien vers cette rubrique">Â¶</a></h3>
<ul class="simple">
<li><p>VÃ©rifier que lâapplication GeoNature est accessible en http</p></li>
<li><p>VÃ©rifier que leurs services (API) sont lancÃ©s et fonctionnent correctement (tester les deux routes ci-dessous).</p>
<ul>
<li><p>Exemple de route locale pour tester lâAPI GeoNature : <a class="reference external" href="http://127.0.0.1:8000/occtax/defaultNomenclatures">http://127.0.0.1:8000/occtax/defaultNomenclatures</a> qui ne doit pas renvoyer de 404. URL absolue : <a class="reference external" href="https://urlgeonature/api/occtax/defaultNomenclatures">https://urlgeonature/api/occtax/defaultNomenclatures</a></p></li>
</ul>
</li>
<li><p>VÃ©rifier que le fichier de logs de GeoNature nâest pas trop volumineux pour la capacitÃ© du serveur</p></li>
<li><p>VÃ©rifier que les services nÃ©cessaires au fonctionnement de lâapplication tournent bien (Apache, PostgreSQL)</p></li>
</ul>
</section>
<section id="maintenance">
<h3>Maintenance<a class="headerlink" href="#maintenance" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Lors dâune opÃ©ration de maintenance (montÃ©e en version, modification de la base de donnÃ©esâ¦), vous pouvez rendre lâapplication momentanÃ©ment indisponible.</p>
<p>Pour cela, dÃ©sactivez la configuration Apache de GeoNature, puis activez la configuration du mode de maintenance :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo a2dissite geonature</span>
<span class="go">sudo a2ensite geonature_maintenance</span>
<span class="go">sudo apachectl restart</span>
</pre></div>
</div>
<p>A la fin de lâopÃ©ration de maintenance, effectuer la manipulation inverse :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo a2dissite geonature_maintenance</span>
<span class="go">sudo a2ensite geonature</span>
<span class="go">sudo apachectl restart</span>
</pre></div>
</div>
<p>Attention : ne pas stopper le backend (des opÃ©rations en BDD en cours pourraient Ãªtre corrompues)</p>
<ul>
<li><p>RedÃ©marrage de PostgreSQL</p>
<p>Si vous effectuez des manipulations de PostgreSQL qui nÃ©cessitent un redÃ©marrage du SGBD (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">postgresql</span> <span class="pre">restart</span></code>), il faut impÃ©rativement lancer un redÃ©marrage de lâAPI GeoNature pour que celle-ci continue de fonctionner. Pour cela, lancez la commande <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">geonature</span></code> (GeoNature 2.8+).</p>
<p><strong>NB</strong>: Ne pas faire ces manipulations sans avertir les utilisateurs dâune perturbation temporaire des applications.</p>
</li>
</ul>
</section>
<section id="parametres-gunicorn">
<h3>ParamÃ¨tres Gunicorn<a class="headerlink" href="#parametres-gunicorn" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Voici les paramÃ¨tres de Gunicorn par dÃ©faut :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_PROC_NAME=geonature</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_NUM_WORKERS=4</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_HOST=127.0.0.1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_PORT=8000</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_TIMEOUT=30</span></code></p></li>
</ul>
<p>Pour modifier une de ces variables, crÃ©er un fichier <code class="docutils literal notranslate"><span class="pre">environ</span></code> Ã  la racine de votre dossier GeoNature, et indiquer la variable dâenvironnement avec sa valeur modifiÃ©e.</p>
<p>Si vous souhaitez modifier de maniÃ¨re plus avancÃ©e la ligne de commande <code class="docutils literal notranslate"><span class="pre">gunicorn</span></code>, surcouchez le service systemd :</p>
<ul>
<li><p>Lancez <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">edit</span> <span class="pre">geonature</span></code> ce qui va crÃ©er le fichier <code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/geonature.service.d/override.conf</span></code> et ouvrir un Ã©diteur pour vous permettre de le modifier</p></li>
<li><p>Indiquez :</p>
<div class="highlight-conf notranslate"><div class="highlight"><pre><span></span>[Service]
ExecStart=
ExecStart=/path/to/venv/bin/unicorn geonature:create_app() â¦
</pre></div>
</div>
<p>Note : le premier <code class="docutils literal notranslate"><span class="pre">ExecStart</span></code> permet de rÃ©initialiser la commande de lancement de gunicorn.</p>
</li>
</ul>
</section>
</section>
<section id="sauvegarde-et-restauration">
<h2>Sauvegarde et restauration<a class="headerlink" href="#sauvegarde-et-restauration" title="Lien vers cette rubrique">Â¶</a></h2>
<section id="sauvegarde">
<h3>Sauvegarde<a class="headerlink" href="#sauvegarde" title="Lien vers cette rubrique">Â¶</a></h3>
<ul class="simple">
<li><p>Sauvegarde de la base de donnÃ©es :</p></li>
</ul>
<p>Les sauvegardes de la BDD sont Ã  faire avec lâutilisateur <code class="docutils literal notranslate"><span class="pre">postgres</span></code>. Commencer par crÃ©er un rÃ©pertoire et lui donner des droits sur le rÃ©pertoire oÃ¹ seront faites les sauvegardes.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># CrÃ©er le rÃ©pertoire pour stocker les sauvegardes</span>
mkdir<span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/backup
<span class="c1"># Ajouter l&#39;utilisateur postgres au groupe de l&#39;utilisateur linux courant pour qu&#39;il ait les droits d&#39;Ã©crire dans les mÃªmes rÃ©pertoires</span>
sudo<span class="w"> </span>adduser<span class="w"> </span>postgres<span class="w"> </span><span class="sb">`</span>whoami<span class="sb">`</span>
<span class="c1"># ajout de droit aux groupes de l&#39;utilisateur courant sur le rÃ©pertoire `backup`</span>
chmod<span class="w"> </span>g+rwx<span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/backup
</pre></div>
</div>
<p>Connectez-vous avec lâutilisateur linux <code class="docutils literal notranslate"><span class="pre">postgres</span></code> pour lancer une sauvegarde de la BDD :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>su<span class="w"> </span>postgres
pg_dump<span class="w"> </span>-Fc<span class="w"> </span>geonature2db<span class="w">  </span>&gt;<span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/backup/<span class="sb">`</span>date<span class="w"> </span>+%Y-%m-%d-%H:%M<span class="sb">`</span>-geonaturedb.backup
<span class="nb">exit</span>
</pre></div>
</div>
<p>Si la sauvegarde ne se fait pas, câest quâil faut revoir les droits du rÃ©pertoire oÃ¹ sont faites les sauvegardes pour que lâutilisateur <code class="docutils literal notranslate"><span class="pre">postgres</span></code> puisse y Ã©crire</p>
<p>OpÃ©ration Ã  faire rÃ©guliÃ¨rement grÃ¢ce Ã  une tÃ¢che cron.</p>
<ul>
<li><p>Sauvegarde des fichiers de configuration :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/geonature/config
tar<span class="w"> </span>-zcvf<span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/backup/<span class="sb">`</span>date<span class="w"> </span>+%Y%m%d%H%M<span class="sb">`</span>-geonature_config.tar.gz<span class="w"> </span>./
</pre></div>
</div>
</li>
</ul>
<p>OpÃ©ration Ã  faire Ã  chaque modification dâun paramÃ¨tre de configuration.</p>
<ul>
<li><p>Sauvegarde des fichiers de customisation :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/geonature/custom
tar<span class="w"> </span>-zcvf<span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/<span class="sb">`</span>date<span class="w"> </span>+%Y%m%d%H%M<span class="sb">`</span>-geonature_custom.tar.gz<span class="w"> </span>./
</pre></div>
</div>
</li>
</ul>
<p>OpÃ©ration Ã  faire Ã  chaque modification de la customisation de lâapplication.</p>
<ul>
<li><p>Sauvegarde des modules externes :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/geonature/external_modules
tar<span class="w"> </span>-zcvf<span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/backup/<span class="sb">`</span>date<span class="w"> </span>+%Y%m%d%H%M<span class="sb">`</span>-external_modules.tar.gz<span class="w"> </span>./
</pre></div>
</div>
</li>
</ul>
</section>
<section id="restauration">
<h3>Restauration<a class="headerlink" href="#restauration" title="Lien vers cette rubrique">Â¶</a></h3>
<ul>
<li><p>Restauration de la base de donnÃ©es :</p>
<ul>
<li><p>CrÃ©er une base de donnÃ©es vierge (on part du principe que la base de donnÃ©es <code class="docutils literal notranslate"><span class="pre">geonature2db</span></code> nâexiste pas ou plus). Sinon adaptez le nom de la BDD et Ã©galement la configuration de connexion de lâapplication Ã  la BDD dans <code class="docutils literal notranslate"><span class="pre">&lt;GEONATURE_DIRECTORY&gt;/config/geonature_config.toml</span></code></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>-n<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>-s<span class="w"> </span>createdb<span class="w"> </span>-O<span class="w"> </span>&lt;MON_USER&gt;<span class="w"> </span>geonature2db
sudo<span class="w"> </span>-n<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>-s<span class="w"> </span>psql<span class="w"> </span>-d<span class="w"> </span>geonature2db<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;CREATE EXTENSION IF NOT EXISTS &quot;postgis&quot;;&#39;</span>
sudo<span class="w"> </span>-n<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>-s<span class="w"> </span>psql<span class="w"> </span>-d<span class="w"> </span>geonature2db<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;CREATE EXTENSION IF NOT EXISTS &quot;postgis_raster&quot;;&#39;</span><span class="w">  </span><span class="c1"># postgis&gt;=3.0 (Debian 11)</span>
sudo<span class="w"> </span>-n<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>-s<span class="w"> </span>psql<span class="w"> </span>-d<span class="w"> </span>geonature2db<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;CREATE EXTENSION IF NOT EXISTS &quot;hstore&quot;;&#39;</span>
sudo<span class="w"> </span>-n<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>-s<span class="w"> </span>psql<span class="w"> </span>-d<span class="w"> </span>geonature2db<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;CREATE EXTENSION IF NOT EXISTS &quot;uuid-ossp&quot;;&#39;</span>
sudo<span class="w"> </span>-n<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>-s<span class="w"> </span>psql<span class="w"> </span>-d<span class="w"> </span>geonature2db<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;CREATE EXTENSION IF NOT EXISTS &quot;pg_trgm&quot;;&#39;</span>
sudo<span class="w"> </span>-n<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>-s<span class="w"> </span>psql<span class="w"> </span>-d<span class="w"> </span>geonature2db<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;CREATE EXTENSION IF NOT EXISTS &quot;unaccent&quot;;&#39;</span>
sudo<span class="w"> </span>-n<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>-s<span class="w"> </span>psql<span class="w"> </span>-d<span class="w"> </span>geonature2db<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;CREATE EXTENSION IF NOT EXISTS &quot;ltree&quot;;&#39;</span>
</pre></div>
</div>
</li>
<li><p>Restaurer la BDD Ã  partir du backup</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>su<span class="w"> </span>postgres
pg_restore<span class="w"> </span>-d<span class="w"> </span>geonature2db<span class="w"> </span>&lt;MY_BACKUP_DIRECTORY_PATH&gt;/201803150917-geonaturedb.backup
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Restauration de la configuration et de la customisation :</p>
<ul>
<li><p>DÃ©compresser les fichiers prÃ©cÃ©demment sauvegardÃ©s pour les remettre au bon emplacement :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>rm<span class="w"> </span>&lt;GEONATURE_DIRECTORY&gt;/config/*
<span class="nb">cd</span><span class="w"> </span>&lt;GEONATURE_DIRECTORY&gt;/config
sudo<span class="w"> </span>tar<span class="w"> </span>-zxvf<span class="w"> </span>&lt;MY_BACKUP_DIRECTORY&gt;/201803150953-geonature_config.tar.gz

<span class="nb">cd</span><span class="w"> </span>/home/&lt;MY_USER&gt;/geonature/custom
rm<span class="w"> </span>-r<span class="w"> </span>&lt;MY_USER&gt;/geonature/custom/*
tar<span class="w"> </span>-zxvf<span class="w"> </span>&lt;MY_BACKUP_DIRECTORY&gt;/201803150953-geonature_custom.tar.gz

rm<span class="w"> </span>/home/&lt;MY_USER&gt;/geonature/external_modules/*
<span class="nb">cd</span><span class="w"> </span>&lt;GEONATURE_DIRECTORY&gt;/external_modules
tar<span class="w"> </span>-zxvf<span class="w"> </span>&lt;MY_BACKUP_DIRECTORY&gt;/201803151036-external_modules.tar.gz
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Relancer lâapplication GeoNature</p></li>
</ul>
</section>
</section>
<section id="customisation">
<h2>Customisation<a class="headerlink" href="#customisation" title="Lien vers cette rubrique">Â¶</a></h2>
<p>Tous les fichiers par dÃ©faut prÃ©sents dans le dossier <code class="docutils literal notranslate"><span class="pre">geonature/backend/static/</span></code> peuvent Ãªtre surcouchÃ©s, en placant un fichier du mÃªme nom dans <code class="docutils literal notranslate"><span class="pre">geonature/custom/</span></code>.</p>
<section id="integrer-son-logo">
<h3>IntÃ©grer son logo<a class="headerlink" href="#integrer-son-logo" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Le logo affichÃ© dans la barre de navigation de GeoNature (<code class="docutils literal notranslate"><span class="pre">backend/static/images/logo_structure.png</span></code>) peut Ãªtre surcouchÃ© dans le rÃ©pertoire en placant le votre dans <code class="docutils literal notranslate"><span class="pre">custom/images/logo_structure.png</span></code>. Idem pour toutes les images prÃ©sentes dans le dossier <code class="docutils literal notranslate"><span class="pre">backend/static/images/</span></code>.</p>
</section>
<section id="customiser-le-contenu">
<h3>Customiser le contenu<a class="headerlink" href="#customiser-le-contenu" title="Lien vers cette rubrique">Â¶</a></h3>
<ul class="simple">
<li><p>Customiser le contenu de la page dâintroduction :</p></li>
</ul>
<p>Le texte dâintroduction, le titre et le pied de page de la page dâAccueil de GeoNature peuvent Ãªtre modifiÃ©s Ã  tout moment, sans rÃ©installation de lâapplication.</p>
<p>Pour cela, renseignez les paramÃ¨tres dans le fichier de configuration de GeoNature (<code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code>) :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[HOME]</span>
<span class="w">    </span><span class="n">TITLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Bienvenue dans GeoNature&quot;</span>
<span class="w">    </span><span class="n">INTRODUCTION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="n">FOOTER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>Vous pouvez renseigner du code HTML sur plusieurs lignes dans ces paramÃ¨tres, en le plaÃ§ant entre triple quote (<code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;&lt;b&gt;Hello&lt;/b&gt;&quot;&quot;&quot;</span></code>).</p>
</section>
<section id="customiser-la-page-de-connexion">
<h3>Customiser la page de connexion<a class="headerlink" href="#customiser-la-page-de-connexion" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Il est possible dâajouter des liens vers des ressources externes sur la page de connexion de GeoNature. Pour cela,
remplissez un (ou plusieurs) item(s) <code class="docutils literal notranslate"><span class="pre">ACCOUNT_MANAGEMENT.EXTERNAL_LINKS</span></code> dans la configuration.
Dans cette variable, le lien est indiquÃ© dans la propriÃ©tÃ© <code class="docutils literal notranslate"><span class="pre">url</span></code> et le texte affichÃ© de ce dernier doit Ãªtre renseignÃ© dans le
propriÃ©tÃ© <code class="docutils literal notranslate"><span class="pre">label</span></code>. Plusieurs exemples sont disponible ci-dessous.</p>
<p><strong>Ajoutez un lien de contact</strong></p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[ACCOUNT_MANAGEMENT.EXTERNAL_LINKS]]</span>
<span class="w">    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Un problÃ¨me de connexion ?&quot;</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mailto:anne.onnyme@example.com&quot;</span>
</pre></div>
</div>
<p><strong>Ajoutez un lien vers un formulaire de contact</strong></p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[ACCOUNT_MANAGEMENT.EXTERNAL_LINKS]]</span>
<span class="w">    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Formulaire de contact&quot;</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://siteorganisme.fr/contact&quot;</span>
</pre></div>
</div>
</section>
<section id="customiser-l-aspect-esthetique">
<h3>Customiser lâaspect esthÃ©tique<a class="headerlink" href="#customiser-l-aspect-esthetique" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Le rendu esthÃ©tique de GeoNature repose principalement sur lâutilisation de Boostrap.</p>
<p>Les couleurs de textes, couleurs de fonds, forme des boutons etc peuvent Ãªtre adaptÃ©es en renseignant un fichier <code class="docutils literal notranslate"><span class="pre">custom/css/frontend.css</span></code> contenant votre surcouche des classes CSS de lâapplication.</p>
<p>Par exemple, pour remplacer la couleur de fond du bandeau de navigation par une image, on peut apporter la modification suivante :</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">html</span><span class="w"> </span><span class="nt">body</span><span class="w"> </span><span class="nt">pnx-root</span><span class="w"> </span><span class="nt">pnx-nav-home</span><span class="w"> </span><span class="nt">mat-sidenav-container</span><span class="p">.</span><span class="nc">sidenav-container</span><span class="p">.</span><span class="nc">mat-drawer-container</span><span class="p">.</span><span class="nc">mat-sidenav-container</span><span class="w"> </span><span class="nt">mat-sidenav-content</span><span class="p">.</span><span class="nc">mat-drawer-content</span><span class="p">.</span><span class="nc">mat-sidenav-content</span><span class="w"> </span><span class="nt">mat-toolbar</span><span class="p">#</span><span class="nn">app-toolbar</span><span class="p">.</span><span class="nc">row</span><span class="p">.</span><span class="nc">mat-toolbar</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">background</span><span class="w"> </span><span class="p">:</span>
<span class="w">   </span><span class="nb">url</span><span class="p">(</span><span class="sx">../images/bandeau_test.jpg</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dans ce cas, lâimage <code class="docutils literal notranslate"><span class="pre">bandeau_test.jpg</span></code> doit se trouver dans le rÃ©pertoire <code class="docutils literal notranslate"><span class="pre">custom/images</span></code>.</p>
<p>Autre exemple, il est possible personnaliser les polices ou les couleurs :</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="c">/* IMPORT POLICE BEBAS NEUE</span>
<span class="c">* ! Bebas Neue by @Ryoichi Tsunekawa</span>
<span class="c">* License - Open Font License</span>
<span class="c">*/</span>
<span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="nt">url</span><span class="o">(</span><span class="s1">&#39;https://fonts.googleapis.com/css2?family=Bebas+Neue&amp;display=swap&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="c">/* Couleurs principales de l&#39;application */</span>
<span class="p">.</span><span class="nc">color-blue</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="mh">#678BC5</span><span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">color-orange</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="mh">#DEC70D</span><span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">color-teal</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="mh">#A8DE0D</span><span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">color-red</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="mh">#DE280D</span><span class="cp">!important</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">appName</span><span class="w"> </span><span class="nt">h3</span><span class="p">{</span>
<span class="w">  </span><span class="k">font-family</span><span class="p">:</span><span class="n">Bebas</span><span class="w"> </span><span class="n">Neue</span><span class="p">,</span><span class="n">Arial</span><span class="p">,</span><span class="kc">sans-serif</span><span class="cp">!important</span><span class="p">;</span>
<span class="w">  </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="kc">xx-large</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Certains paramÃ¨tres demandent lâajout de la mention <code class="docutils literal notranslate"><span class="pre">!important</span></code> pour Ãªtre pris en compte (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/issues/2632">https://github.com/PnX-SI/GeoNature/issues/2632</a>).</p>
</section>
<section id="customiser-les-noms-et-pictos-des-modules">
<h3>Customiser les noms et pictos des modules<a class="headerlink" href="#customiser-les-noms-et-pictos-des-modules" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Vous pouvez modifier lâintitulÃ© et le pictogramme des modules dans le menu des modules. Pour cela, adaptez le contenu des champs <code class="docutils literal notranslate"><span class="pre">module_label</span></code> et <code class="docutils literal notranslate"><span class="pre">module_picto</span></code> (avec des icones de la librairie Font Awesome - <a class="reference external" href="https://fontawesome.com">https://fontawesome.com</a>) dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules</span></code> (aussi modifiable directement depuis le module Â«Â AdminÂ Â»).</p>
<p>Exemple :</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Module Occtax</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Occtax&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OCCTAX&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-map-marker&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OCCTAX&#39;</span><span class="p">;</span>
<span class="c1">-- Module Occhab</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Occhab&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OCCHAB&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-leaf&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OCCHAB&#39;</span><span class="p">;</span>
<span class="c1">-- Module Import</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Import&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;IMPORT&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-upload&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;IMPORT&#39;</span><span class="p">;</span>
<span class="c1">-- Module Export</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Export&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;EXPORTS&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-download&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;EXPORTS&#39;</span><span class="p">;</span>
<span class="c1">-- Module Dashboard</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Dashboard&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;DASHBOARD&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-bar-chart&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;DASHBOARD&#39;</span><span class="p">;</span>
<span class="c1">-- Module Validation</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Validation&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;VALIDATION&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-check&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;VALIDATION&#39;</span><span class="p">;</span>
<span class="c1">-- Module Monitorings (Suivis)</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Suivis&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MONITORINGS&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-eye&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MONITORINGS&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Depuis la version 2.5.0, il est aussi possible de customiser lâordre des modules dans le menu, par ordre alphabÃ©tique par dÃ©faut, en renseignant le champs <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules.module_order</span></code>.</p>
</section>
<section id="customiser-les-exports-pdf">
<h3>Customiser les exports PDF<a class="headerlink" href="#customiser-les-exports-pdf" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Vous pouvez modifier le bandeau et le logo fournis par dÃ©faut dans les exports PDF en surcouchant les images <code class="docutils literal notranslate"><span class="pre">Bandeau_pdf.png</span></code> et <code class="docutils literal notranslate"><span class="pre">Logo_pdf.png</span></code> prÃ©sentes dans le dossier <code class="docutils literal notranslate"><span class="pre">backend/static/images</span></code>, en placant les votres du mÃªme nom dans <code class="docutils literal notranslate"><span class="pre">custom/images</span></code>.</p>
<p>Le style des fichiers PDF est Ã©galement customisable grÃ¢ce au fichier Â«Â custom/css/metadata_pdf_custom.cssÂ Â», permettant de surcoucher les classes CSS du fichier <code class="docutils literal notranslate"><span class="pre">backend/static/css/metadata_pdf.css</span></code>. Par exemple, la classe <code class="docutils literal notranslate"><span class="pre">main-color</span></code> permet de changer la couleur des sÃ©parateurs (orange par dÃ©faut).</p>
</section>
</section>
<section id="integrer-des-donnees">
<h2>IntÃ©grer des donnÃ©es<a class="headerlink" href="#integrer-des-donnees" title="Lien vers cette rubrique">Â¶</a></h2>
<section id="referentiel-geographique">
<h3>RÃ©fÃ©rentiel gÃ©ographique<a class="headerlink" href="#referentiel-geographique" title="Lien vers cette rubrique">Â¶</a></h3>
<p>GeoNature est fourni avec des donnÃ©es gÃ©ographiques de base sur la mÃ©tropole (MNT national Ã  250m et communes de mÃ©tropole).</p>
<p><strong>1.</strong> Si vous souhaitez modifier le MNT pour mettre celui de votre territoire :</p>
<ul class="simple">
<li><p>Videz le contenu des tables <code class="docutils literal notranslate"><span class="pre">ref_geo.dem</span></code> et Ã©ventuellement <code class="docutils literal notranslate"><span class="pre">ref_geo.dem_vector</span></code></p></li>
<li><p>Uploadez le(s) fichier(s) du MNT sur le serveur</p></li>
<li><p>Suivez la procÃ©dure de chargement du MNT en lâadaptant :</p>
<ul>
<li><p><a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/backend/geonature/migrations/versions/1715cf31a75d_insert_ign_250m_bd_alti_in_dem.py">https://github.com/PnX-SI/GeoNature/blob/master/backend/geonature/migrations/versions/1715cf31a75d_insert_ign_250m_bd_alti_in_dem.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/backend/geonature/migrations/versions/87651375c2e8_vectorize_ign_bd_alti.py">https://github.com/PnX-SI/GeoNature/blob/master/backend/geonature/migrations/versions/87651375c2e8_vectorize_ign_bd_alti.py</a></p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ProcÃ©dure Ã  amÃ©liorer et simplifier : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/issues/235">https://github.com/PnX-SI/GeoNature/issues/235</a></p>
</div>
<p>Si vous nâavez pas choisi dâintÃ©grer le raster MNT national Ã  250m fourni par dÃ©faut lors de lâinstallation ou que vous souhaitez le remplacer, voici les commandes qui vous permettront de le faire.</p>
<p>Suppression du MNT par dÃ©faut (adapter le nom de la base de donnÃ©es : MYDBNAME).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;TRUNCATE TABLE ref_geo.dem;&quot;</span>
<span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;TRUNCATE TABLE ref_geo.dem_vector;&quot;</span>
</pre></div>
</div>
<p>Placer votre propre fichier MNT (ou vos diffÃ©rents fichiers Â«Â dallesÂ Â») dans le rÃ©pertoire <code class="docutils literal notranslate"><span class="pre">/tmp/geonature</span></code> (adapter le nom du fichier et son chemin ainsi que les paramÃ¨tres en majuscule).</p>
<p>Pour utiliser celui proposÃ© par dÃ©faut :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wget --cache=off http://geonature.fr/data/ign/BDALTIV2_2-0_250M_ASC_LAMB93-IGN69_FRANCE_2017-06-21.zip -P /tmp/geonature</span>
<span class="go">unzip /tmp/geonature/BDALTIV2_2-0_250M_ASC_LAMB93-IGN69_FRANCE_2017-06-21.zip -d /tmp/geonature</span>
<span class="go">export PGPASSWORD=MYUSERPGPASS;raster2pgsql -s MYSRID -c -C -I -M -d -t 5x5 /tmp/geonature/BDALTIV2_250M_FXX_0098_7150_MNT_LAMB93_IGN69.asc ref_geo.dem|psql -h localhost -U MYPGUSER -d MYDBNAME</span>
<span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;REINDEX INDEX ref_geo.dem_st_convexhull_idx;&quot;</span>
</pre></div>
</div>
<p>Si votre MNT source est constituÃ© de plusieurs fichiers (dalles),
assurez vous que toutes vos dalles ont le mÃªme systÃ¨me de projection
et le mÃªme format de fichier (tiff, asc, ou img par exemple).
AprÃ¨s avoir chargÃ© vos fichiers dans <code class="docutils literal notranslate"><span class="pre">tmp/geonature</span></code> (par exemple),
vous pouvez lancer la commande <code class="docutils literal notranslate"><span class="pre">export</span></code> en remplacant le nom des
fichiers par *.asc :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export PGPASSWORD=MYUSERPGPASS;raster2pgsql -s MYSRID -c -C -I -M -d -t 5x5 /tmp/geonature/*.asc ref_geo.dem|psql -h localhost -U MYPGUSER -d MYDBNAME</span>
</pre></div>
</div>
<p>Si vous souhaitez vectoriser le raster MNT pour de meilleures performances lors des calculs en masse de lâaltitude Ã  partir de la localisation des observations, vous pouvez le faire en lanÃ§ant les commandes ci-dessous. Sachez que cela prendra du temps et beaucoup dâespace disque (2.8Go supplÃ©mentaires environ pour le fichier DEM France Ã  250m).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;INSERT INTO ref_geo.dem_vector (geom, val) SELECT (ST_DumpAsPolygons(rast)).* FROM ref_geo.dem;&quot;</span>
<span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;REINDEX INDEX ref_geo.index_dem_vector_geom;&quot;</span>
</pre></div>
</div>
<p>Si <code class="docutils literal notranslate"><span class="pre">ref_geo.dem_vector</span></code> est remplie, cette table est utilisÃ©e pour le calcul de lâaltitude Ã  la place de la table <code class="docutils literal notranslate"><span class="pre">ref_geo.dem</span></code></p>
<p><strong>2.</strong> Si vous souhaitez modifier ou ajouter des zonages administratifs, rÃ©glementaires ou naturels :</p>
<ul class="simple">
<li><p>VÃ©rifiez que leur type existe dans la table <code class="docutils literal notranslate"><span class="pre">ref_geo.bib_areas_types</span></code>, sinon ajoutez-les</p></li>
<li><p>Ajoutez vos zonages dans la table <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code> en faisant bien rÃ©fÃ©rence Ã  un <code class="docutils literal notranslate"><span class="pre">id_type</span></code> de <code class="docutils literal notranslate"><span class="pre">ref_geo.bib_areas_types</span></code>. Vous pouvez faire cela en SQL ou en faisant des copier/coller de vos zonages directement dans QGIS</p></li>
<li><p>Pour les grilles et les communes, vous pouvez ensuite complÃ©ter leurs tables dâextension <code class="docutils literal notranslate"><span class="pre">ref_geo.li_grids</span></code> et <code class="docutils literal notranslate"><span class="pre">ref_geo.li_municipalities</span></code>.</p></li>
</ul>
<p>Il est Ã©galement possible de dÃ©sactiver des Ã©lÃ©ments des rÃ©fÃ©rentiels gÃ©ographiques sans les supprimer de la base, en passant la valeur de la colonne <code class="docutils literal notranslate"><span class="pre">enable</span></code> en <cite>false</cite> dans la table <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code>.</p>
</section>
<section id="affichage-des-referentiels-geographiques-dans-geonature">
<h3>Affichage des rÃ©fÃ©rentiels gÃ©ographiques dans GeoNature<a class="headerlink" href="#affichage-des-referentiels-geographiques-dans-geonature" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Il est possible de choisir les Ã©lÃ©ments des rÃ©fÃ©rentiels gÃ©ographiques pouvant sâafficher sur les cartes. Par exemple si on souhaite modifier lâaffichage des communes :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configuration par dÃ©faut :</span>
<span class="k">[[MAPCONFIG.REF_LAYERS]]</span>
<span class="w">    </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;COM&quot;</span><span class="w"> </span><span class="c1"># correspond Ã  type_code de la couche ref_geo.bib_areas_types</span>
<span class="w">    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Communes&quot;</span><span class="w"> </span><span class="c1"># nom s&#39;affichant dans leafmap</span>
<span class="w">    </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;area&quot;</span>
<span class="w">    </span><span class="n">activate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="c1"># ne s&#39;affiche pas par dÃ©faut sur la carte</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;grey&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;0.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">limit</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2000</span><span class="p">}</span><span class="w"> </span><span class="c1"># nombre d&#39;Ã©lÃ©ments maximum pouvant Ãªtre affichÃ©s</span>
</pre></div>
</div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configuration modifiÃ©e</span>
<span class="k">[[MAPCONFIG.REF_LAYERS]]</span>
<span class="w">    </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;COM&#39;</span>
<span class="w">    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Limite de commune&#39;</span>
<span class="w">    </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;area&#39;</span>
<span class="w">    </span><span class="n">activate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s1">&#39;SlateGray&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">fillOpacity</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s1">&#39;0.2&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">limit</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5000</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="donnees-externes">
<h3>DonnÃ©es externes<a class="headerlink" href="#donnees-externes" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Il peut sâagir de donnÃ©es partenaires, de donnÃ©es historiques ou de donnÃ©es saisies dans dâautres outils.</p>
<p>2 possibilitÃ©s sâoffrent Ã  vous :</p>
<ul class="simple">
<li><p>Utiliser le module Import intÃ©grÃ© Ã  GeoNature</p></li>
<li><p>Importer les donnÃ©es manuellement directement dans la BDD, dans la SynthÃ¨se ou dans les tables dâun module de saisie</p></li>
</ul>
<p>Pour des exemples dâimports manuels prÃ©cis, illustrÃ©s et commentÃ©s, vous pouvez consulter ceux partagÃ©s dans lâespace de ressources techniques : <a class="reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/V2">https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/V2</a>.</p>
<p>Vous pouvez aussi vous inspirer des exemples avancÃ©s de migration des donnÃ©es de GeoNature V1 vers GeoNature V2 : <a class="reference external" href="https://github.com/PnX-SI/GeoNature/tree/master/data/migrations/v1tov2">https://github.com/PnX-SI/GeoNature/tree/master/data/migrations/v1tov2</a></p>
<ul class="simple">
<li><p>Import depuis SICEN (ObsOcc) : <a class="reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/sicen">https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/sicen</a></p></li>
<li><p>Import depuis SERENA : <a class="reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/serena">https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/serena</a></p></li>
<li><p>Import continu : <a class="reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/generic">https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/generic</a></p></li>
<li><p>Import dâun CSV historique (Flavia) : <a class="reference external" href="https://github.com/PnX-SI/Ressources-techniques/blob/master/GeoNature/V2/2018-12-csv-vers-synthese-FLAVIA.sql">https://github.com/PnX-SI/Ressources-techniques/blob/master/GeoNature/V2/2018-12-csv-vers-synthese-FLAVIA.sql</a></p></li>
</ul>
</section>
</section>
<section id="authentification">
<h2>Authentification<a class="headerlink" href="#authentification" title="Lien vers cette rubrique">Â¶</a></h2>
<section id="demande-de-creation-de-compte">
<h3>Demande de crÃ©ation de compte<a class="headerlink" href="#demande-de-creation-de-compte" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Depuis la version 2.1.0, UsersHub propose une API de crÃ©ation de compte utilisateur. Une interface a Ã©tÃ© ajoutÃ©e Ã  GeoNature pour permettre aux futurs utilisateurs de faire des demandes de crÃ©ation de compte depuis la page dâauthentification de GeoNature. Ce mode est activable/dÃ©sactivable depuis la configuration globale de GeoNature.</p>
<p>Pour des raisons de sÃ©curitÃ©, lâAPI de crÃ©ation de compte est rÃ©servÃ©e aux utilisateurs Â«Â adminÂ Â» grÃ¢ce Ã  un token secret. GeoNature a donc besoin de se connecter en tant quâadministrateur Ã  UsersHub pour Ã©xecuter les requÃªtes dâadministration de compte.
Renseigner les paramÃ¨tres suivants dans le fichier de configuration (<code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>). Lâutilisateur doit avoir des droits 6 dans UsersHub</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[USERSHUB]</span>
<span class="w">    </span><span class="n">URL_USERSHUB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;http://mon_adresse_usershub.fr&#39;</span><span class="w"> </span><span class="c1"># sans slash final</span>
<span class="w">    </span><span class="c1"># Administrateur de mon application</span>
<span class="w">    </span><span class="n">ADMIN_APPLICATION_LOGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;login_admin_usershub&quot;</span>
<span class="w">    </span><span class="n">ADMIN_APPLICATION_PASSWORD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;password_admin_usershub</span>
</pre></div>
</div>
<p>Les fonctionnalitÃ©s de crÃ©ation de compte nÃ©cessitent lâenvoi dâemails pour vÃ©rifier lâidentitÃ© des demandeurs de compte. Il est donc nÃ©cessaire dâavoir un serveur SMTP capable dâenvoyer des emails. Renseigner la rubrique <code class="docutils literal notranslate"><span class="pre">MAIL_CONFIG</span></code> de la configuration. La description dÃ©taillÃ©es des paramÃ¨tres de configuration dâenvoie des emails est disponible dans <a class="reference external" href="https://flask-mail.readthedocs.io/en/latest/#configuring-flask-mail">la documentation de Flask-Mail</a>. Exemple :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[MAIL_CONFIG]</span>
<span class="w">    </span><span class="n">MAIL_SERVER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mail.espaces-naturels.fr&#39;</span>
<span class="w">    </span><span class="n">MAIL_PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">465</span>
<span class="w">    </span><span class="n">MAIL_USE_TLS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">MAIL_USE_SSL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">MAIL_USERNAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mon_email@email.io&#39;</span>
<span class="w">    </span><span class="n">MAIL_PASSWORD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;monpassword&#39;</span>
<span class="w">    </span><span class="n">MAIL_DEFAULT_SENDER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mon_email@email.io&#39;</span>
<span class="w">    </span><span class="n">MAIL_ASCII_ATTACHMENTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</pre></div>
</div>
<p>Pour activer cette fonctionnalitÃ© (qui est par dÃ©faut dÃ©sactivÃ©e), modifier le fichier de configuration de la maniÃ¨re suivante :</p>
<p>NB : tous les paramÃ¨tres dÃ©crits ci-dessous doivent Ãªtre dans la rubriqueÂ <code class="docutils literal notranslate"><span class="pre">[ACCOUNT_MANAGEMENT]</span></code></p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[ACCOUNT_MANAGEMENT]</span>
<span class="w">    </span><span class="n">ENABLE_SIGN_UP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</pre></div>
</div>
<p>Deux modes sont alors disponibles. Soit lâutilisateur est automatiquement acceptÃ© et un compte lui est crÃ©Ã© aprÃ¨s une confirmation de son email, soit un mail est envoyÃ© Ã  un administrateur pour confirmer la demande. Le compte ne sera crÃ©e quâaprÃ¨s validation par lâadministrateur. Le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">AUTO_ACCOUNT_CREATION</span></code> contrÃ´le ce comportement (par dÃ©faut le compte crÃ©Ã© sans validation par un administrateur: true). Dans le mode Â«Â crÃ©ation de compte validÃ© par administrateurÂ Â», il est indispensable de renseigner un email oÃ¹ seront envoyÃ©s les emails de validation (paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">VALIDATOR_EMAIL</span></code>)</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># automatique</span>
<span class="k">[ACCOUNT_MANAGEMENT]</span>
<span class="w">    </span><span class="n">ENABLE_SIGN_UP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">AUTO_ACCOUNT_CREATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="c1"># validÃ© par admin</span>
<span class="k">[ACCOUNT_MANAGEMENT]</span>
<span class="w">    </span><span class="n">ENABLE_SIGN_UP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">AUTO_ACCOUNT_CREATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">VALIDATOR_EMAIL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;email@validateur.io&#39;</span>
</pre></div>
</div>
<p>Lâutilisateur qui demande la crÃ©ation de compte est automatiquement mis dans un Â«Â groupeÂ Â» UsersHub (par dÃ©faut, il sâagit du groupe Â«Â En posteÂ Â»). Ce groupe est paramÃ©trable depuis la table <code class="docutils literal notranslate"><span class="pre">utilisateurs.cor_role_app_profil</span></code>. (La ligne oÃ¹ <code class="docutils literal notranslate"><span class="pre">is_default_group_for_app</span> <span class="pre">=</span> <span class="pre">true</span></code> sera utilisÃ©e comme groupe par dÃ©faut pour GeoNature). Il nâest pas en paramÃ¨tre de GeoNature pusquâil serait falsifiable via lâAPI.</p>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Si vous effectuez une migration depuis une version de GeoNature &lt; 2.2.0, aucun groupe par dÃ©faut nâest dÃ©fini, vous devez dÃ©finir Ã  la main le groupe par dÃ©faut pour lâapplication GeoNature dans la table <code class="docutils literal notranslate"><span class="pre">utilisateurs.cor_role_app_profil</span></code>.</p>
</div>
<p>Dans le mode Â«Â crÃ©ation de compte validÃ© par administrateurÂ Â», lorsque lâinscription est validÃ©e par un administrateur, un email est envoyÃ© Ã  lâutilisateur pour lui indiquer la confirmation de son inscription.
Il est possible de personnaliser le texte de la partie finale de cet email situÃ©e juste avant la signature Ã  lâaide du paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">ADDON_USER_EMAIL</span></code> (toujours Ã  ajouter Ã  la rubriqueÂ <code class="docutils literal notranslate"><span class="pre">[ACCOUNT_MANAGEMENT]</span></code>).
Vous pouvez utiliser des balises HTML compatibles avec les emails pour ce texte.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[ACCOUNT_MANAGEMENT]</span>
<span class="w">    </span><span class="n">ADDON_USER_EMAIL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;&lt;p&gt;</span>
<span class="s2">        Toute l&#39;Ã©quipe de GeoNature vous remercie pour votre inscription.</span>
<span class="s2">      &lt;/p&gt;&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Il est Ã©galement possible de crÃ©er automatiquement un jeu de donnÃ©es et un cadre dâacquisition Â«Â personnelÂ Â» Ã  lâutilisateur afin quâil puisse saisir des donnÃ©es dÃ¨s sa crÃ©ation de compte via le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">AUTO_DATASET_CREATION</span></code>. Par la suite lâadministrateur pourra rattacher lâutilisateur Ã  des JDD et CA via son organisme.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[ACCOUNT_MANAGEMENT]</span>
<span class="w">    </span><span class="n">AUTO_ACCOUNT_CREATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">ENABLE_SIGN_UP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">AUTO_DATASET_CREATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</pre></div>
</div>
<section id="customisation-du-formulaire">
<h4>Customisation du formulaire<a class="headerlink" href="#customisation-du-formulaire" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Le formulaire de crÃ©ation de compte est par dÃ©faut assez minimaliste (nom, prÃ©nom, email, mot de passe, organisme, remarque).</p>
<p><em>NB</em> lâorganisme est demandÃ© Ã  lâutilisateur Ã  titre Â«Â informatifÂ Â», câest Ã  lâadministrateur de rattacher individuellement lâutilisateur Ã  son organisme, et Ã©ventuellement de le crÃ©er, sâil nâexiste pas.</p>
<p>Il est possible dâajouter des champs au formulaire grÃ¢ce Ã  un gÃ©nÃ©rateur controlÃ© par la configuration. Plusieurs type de champs peuvent Ãªtre ajoutÃ©s (text, textarea, number, select, checkbox mais aussi taxonomy, nomenclature etcâ¦).</p>
<p>Lâexemple ci-dessous permet de crÃ©er un champs de type Â«Â checkboxÂ Â» obligatoire, avec un lien vers un document (une charte par exemple) et un champ de type Â«Â selectÂ Â», non obligatoire. (voir le fichier <code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml.example</span></code> pour un exemple plus exhaustif).</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[ACCOUNT_MANAGEMENT]</span>
<span class="k">[[ACCOUNT_MANAGEMENT.ACCOUNT_FORM]]</span>
<span class="w">    </span><span class="n">type_widget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checkbox&quot;</span>
<span class="w">    </span><span class="n">attribut_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      &lt;a target=&quot;_blank&quot; href=&quot;http://docs.geonature.fr&quot;&gt;</span>
<span class="s2">        J&#39;ai lu et j&#39;accepte la charte</span>
<span class="s2">      &lt;/a&gt;&quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">attribut_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;validate_charte&quot;</span>
<span class="w">    </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="kc">true</span><span class="p">]</span>
<span class="w">    </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="k">[[ACCOUNT_MANAGEMENT.ACCOUNT_FORM]]</span>
<span class="w">    </span><span class="n">type_widget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;select&quot;</span>
<span class="w">    </span><span class="n">attribut_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Exemple select&quot;</span>
<span class="w">    </span><span class="n">attribut_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;select_test&quot;</span>
<span class="w">    </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;value1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;value2&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</pre></div>
</div>
</section>
</section>
<section id="espace-utilisateur">
<h3>Espace utilisateur<a class="headerlink" href="#espace-utilisateur" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Un espace Â«Â utilisateurÂ Â» est accessible lorsque lâon est connectÃ©, permettant de modifier ses informations personnelles, y compris son mot de passe.</p>
<p>Cet espace est activable grÃ¢ce au paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">ENABLE_USER_MANAGEMENT</span></code>. Par dÃ©faut, il est dÃ©sactivÃ©.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[ACCOUNT_MANAGEMENT]</span>
<span class="n">AUTO_ACCOUNT_CREATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">ENABLE_SIGN_UP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">ENABLE_USER_MANAGEMENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</pre></div>
</div>
</section>
<section id="acces-public">
<h3>AccÃ¨s public<a class="headerlink" href="#acces-public" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Cette section de la documentation concerne lâimplÃ©mentation dâun utilisateur gÃ©nÃ©rique et public accÃ©dant Ã  votre instance GeoNature sans authentification.
Cela ajoute sur la page dâauthentification de GeoNature, un bouton Â«Â AccÃ¨s publicÂ Â» donnant accÃ¨s Ã  GeoNature sans authentification.</p>
<p>Etapes :</p>
<dl>
<dt>1/ UsersHub :</dt><dd><ul class="simple">
<li><p>Aller dans la section <cite>Utilisateurs</cite></p></li>
<li><p>CrÃ©er un utilisateur</p></li>
<li><p>DÃ©finir un identifiant et un mot de passe (par exemple utilisateur âpublicâ et mot de passe âpublicâ)</p></li>
<li><p>Sâassurer quâil ne soit dans aucun groupe</p></li>
<li><p>Aller ensuite dans la section <cite>Applications</cite></p></li>
<li><p>Pour GeoNature, cliquer sur le premier icÃ´ne âVoir les membresâ</p></li>
<li><p>Cliquer sur ajouter un rÃ´le</p></li>
<li><p>Choisir lâutilisateur juste crÃ©Ã©</p></li>
<li><p>Attribuer le rÃ´le 1, âLecteurâ</p></li>
</ul>
</dd>
<dt>2/ Configuration GeoNature :</dt><dd><ul class="simple">
<li><p>Dans le fichier de configuration de GeoNature (<code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code>), spÃ©cifier le nom dâutilisateur pour lâaccÃ¨s public via le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">PUBLIC_ACCESS_USERNAME</span></code> :</p></li>
</ul>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="na">PUBLIC_ACCESS_USERNAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;public&#39;</span>
</pre></div>
</div>
</dd>
</dl>
<p><a class="reference internal" href="#post-config-change"><span class="std std-ref">ExÃ©cuter les actions post-modification de la configuration</span></a>.</p>
<p>A ce moment-lÃ , cet utilisateur nâa aucune permission dans GeoNature.
Il sâagit maintenant de gÃ©rer ses permissions dans GeoNature.</p>
<dl class="simple">
<dt>3/ GeoNature</dt><dd><ul class="simple">
<li><p>Se connecter Ã  GeoNature avec un utilisateur administrateur</p></li>
<li><p>Aller dans le module Admin</p></li>
<li><p>Cliquer sur âBackofficeâ, puis Â«Â PermissionsÂ Â» / Â«Â Par utilisateursÂ Â»</p></li>
<li><p>Choisissez lâutilisateur sÃ©lectionnÃ©</p></li>
<li><p>Ajouter des permissions pour chacun des modules de lâinstance auquel vous souhaitez que lâutilisateur public accÃ¨de</p></li>
</ul>
</dd>
</dl>
<section id="acces-public-automatique">
<h4>AccÃ¨s public automatique<a class="headerlink" href="#acces-public-automatique" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Un lien GeoNature peut dÃ©clencher automatiquement une connexion avec lâutilisateur public en lui rajoutant les paramÃ¨tres <code class="docutils literal notranslate"><span class="pre">access=public</span></code>.</p>
<p>Exemple : <a class="reference external" href="https://demo.geonature.fr/geonature/#/synthese?access=public">https://demo.geonature.fr/geonature/#/synthese?access=public</a></p>
</section>
</section>
<section id="se-connecter-a-d-autres-fournisseurs-d-identites">
<h3>Se connecter Ã  dâautres fournisseurs dâidentitÃ©s<a class="headerlink" href="#se-connecter-a-d-autres-fournisseurs-d-identites" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Depuis la version 2.15, il est maintenant possible de se connecter Ã  GeoNature Ã  lâaide de fournisseurs dâidentitÃ©s externes (comme Google, GitHub ou INPN).
Pour cela, il est nÃ©cessaire dâimplÃ©menter le protocole de connexion pour permettre Ã  GeoNature de communiquer avec ces fournisseurs.
Actuellement, GeoNature vient avec plusieurs protocoles de connexion implÃ©mentÃ©s, tels que :</p>
<ul class="simple">
<li><p>OpenID</p></li>
<li><p>OpenIDConnect (OAuth2.0)</p></li>
<li><p>GeoNature Externe</p></li>
</ul>
<section id="ajouter-un-nouveau-fournisseur-d-identite">
<h4>Ajouter un nouveau fournisseur dâidentitÃ©<a class="headerlink" href="#ajouter-un-nouveau-fournisseur-d-identite" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Pour ajouter un nouveau fournisseur dâidentitÃ©s Ã  votre instance de GeoNature, vous devez ajouter une section <code class="docutils literal notranslate"><span class="pre">[[AUTHENTICATION.PROVIDERS]]</span></code> dans la partie <code class="docutils literal notranslate"><span class="pre">AUTHENTICATION</span></code> de votre fichier de configuration.
Chaque section doit comporter deux variables obligatoires: <code class="docutils literal notranslate"><span class="pre">module</span></code> et <code class="docutils literal notranslate"><span class="pre">id_provider</span></code>. La variable <code class="docutils literal notranslate"><span class="pre">module</span></code> indique le chemin vers la classe Python qui implÃ©mente le protocole de connexion, tandis que <code class="docutils literal notranslate"><span class="pre">id_provider</span></code> indique lâidentifiant unique du fournisseur dâidentitÃ©.
Vous devez Ã©galement ajouter les variables de configuration spÃ©cifiques au protocole de connexion correspondant.</p>
<p>Dans lâexemple ci-dessous, on dÃ©clare deux fournisseurs dâidentitÃ©s : le premier est le fournisseur dâidentitÃ© par dÃ©faut (local) et le deuxiÃ¨me permet de se connecter Ã  lâINPN.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[AUTHENTICATION]</span>
<span class="w">    </span><span class="n">DEFAULT_RECONCILIATION_GROUP_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="k">[[AUTHENTICATION.PROVIDERS]]</span>
<span class="w">        </span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;pypnusershub.auth.providers.default.LocalProvider&quot;</span>
<span class="w">        </span><span class="n">id_provider</span><span class="o">=</span><span class="s2">&quot;local_provider&quot;</span>

<span class="w">    </span><span class="k">[[AUTHENTICATION.PROVIDERS]]</span>
<span class="w">        </span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;pypnusershub.auth.providers.cas_inpn_provider.AuthenficationCASINPN&quot;</span>
<span class="w">        </span><span class="n">id_provider</span><span class="o">=</span><span class="s2">&quot;connexion_inpn_1&quot;</span>
<span class="w">        </span><span class="n">WS_ID</span><span class="w"> </span><span class="o">=</span><span class="s2">&quot;secret&quot;</span>
<span class="w">        </span><span class="n">WS_PASSWORD</span><span class="w"> </span><span class="o">=</span><span class="s2">&quot;secret&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<dl class="simple">
<dt>Les protocoles de connexion implÃ©mentÃ©s sont les suivants :</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pypnusershub.auth.providers.default.LocalProvider</span></code> : protocole de connexion par dÃ©faut dans GeoNature.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pypnusershub.auth.providers.cas_inpn_provider.AuthenficationCASINPN</span></code> : CAS de lâINPN.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pypnusershub.auth.providers.openid_provider.OpenIDConnectProvider</span></code> : OpenIDConnect.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pypnusershub.auth.providers.openid_provider.OpenIDProvider</span></code> : OpenID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pypnusershub.auth.providers.usershub_provider.ExternalUsersHubAuthProvider</span></code> : Autre application utilisant <code class="docutils literal notranslate"><span class="pre">UsersHub-authentification-module</span></code> comme systÃ¨me dâauthentification.</p></li>
</ul>
</dd>
</dl>
<p>Vous pouvez consulter la documentation dÃ©taillÃ©e sur le <a class="reference external" href="https://github.com/PnX-SI/UsersHub-authentification-module?tab=readme-ov-file#param%C3%A8tres-de-configurations-des-protocoles-de-connexions-inclus">lien suivant</a> pour obtenir la liste et les descriptions des paramÃ¨tres de configuration de chaque protocole de connexion.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Soyez prudent lors de la modification de la variable de configuration <code class="docutils literal notranslate"><span class="pre">AUTHENTICATION.PROVIDERS</span></code>. Si vous nâindiquez pas le fournisseur dâidentitÃ© par dÃ©faut, vous ne pourrez plus vous connecter Ã  GeoNature avec lâauthentification par dÃ©faut. Par consÃ©quent, si vous souhaitez Ã©galement utiliser lâauthentification par dÃ©faut de GeoNature en plus dâun autre fournisseur dâidentitÃ©, vous devez le redÃ©clarer dans la configuration. (voir lâexemple ci-dessus)</p>
</div>
</section>
<section id="se-connecter-a-un-autre-geonature">
<h4>Se connecter Ã  un autre GeoNature<a class="headerlink" href="#se-connecter-a-un-autre-geonature" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Si vous souhaitez ajouter le moyen de se connecter Ã  lâaide dâun autre GeoNature, nous avons crÃ©e un module dÃ©crivant le protocole de connexion nÃ©cessaire : <code class="docutils literal notranslate"><span class="pre">pypnusershub.auth.providers.usershub_provider.ExternalUsersHubAuthProvider</span></code>.</p>
<p>Pour utiliser ce dernier, ajouter la section <code class="docutils literal notranslate"><span class="pre">[[AUTHENTICATION.PROVIDERS]]</span></code> suivante dans la partie <code class="docutils literal notranslate"><span class="pre">AUTHENTICATION</span></code> de la configuration :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[AUTHENTICATION.PROVIDERS]]</span>
<span class="w">    </span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;pypnusershub.auth.providers.usershub_provider.ExternalUsersHubAuthProvider&quot;</span>
<span class="w">    </span><span class="n">id_provider</span><span class="o">=</span><span class="s2">&quot;autre_geonature&quot;</span>
<span class="w">    </span><span class="n">login_url</span><span class="o">=</span><span class="s2">&quot;&lt;UrlVersAPIdeVotreGeoNature&gt;/login&quot;</span>
<span class="w">    </span><span class="n">logout_url</span><span class="o">=</span><span class="s2">&quot;&lt;UrlVersAPIdeVotreGeoNature&gt;/logout&quot;</span>
</pre></div>
</div>
</section>
<section id="creer-son-propre-module-de-connexion">
<h4>CrÃ©er son propre module de connexion<a class="headerlink" href="#creer-son-propre-module-de-connexion" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Si les protocoles de connexion que nous avons implÃ©mentÃ©s ne vous suffisent pas, vous pouvez ajouter votre propre protocole de connexion en utilisant la classe <code class="docutils literal notranslate"><span class="pre">pypnusershub.auth.Authentication</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">marshmallow</span> <span class="kn">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">pypnusershub.auth</span> <span class="kn">import</span> <span class="n">Authentication</span><span class="p">,</span> <span class="n">ProviderConfigurationSchema</span>
<span class="kn">from</span> <span class="nn">pypnusershub.db</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">db</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Response</span>


<span class="k">class</span> <span class="nc">NEW_PROVIDER</span><span class="p">(</span><span class="n">Authentication</span><span class="p">):</span>
    <span class="n">is_external</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># si redirection vers un portail de connexion externe</span>

    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Response</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">]:</span>
        <span class="k">pass</span> <span class="c1"># doit retourner un utilisateur (User) ou rediriger (flask.Redirect) vers le portail de connexion du fournisseur d&#39;identitÃ©s</span>

    <span class="k">def</span> <span class="nf">authorize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># appeler par /auth/authorize si redirection d&#39;un portail de connexion externe</span>
        <span class="k">pass</span> <span class="c1"># doit retourner un utilisateur</span>

    <span class="k">def</span> <span class="nf">revoke</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c1"># si une action spÃ©cifique doit Ãªtre faite lors de la dÃ©connexion</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="k">class</span> <span class="nc">SchemaConf</span><span class="p">(</span><span class="n">ProviderConfigurationSchema</span><span class="p">):</span>
            <span class="n">VAR</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">configuration</span> <span class="o">=</span> <span class="n">SchemaConf</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span> <span class="c1"># Si besoin d&#39;un processus de validation</span>
        <span class="o">...</span><span class="c1"># Configuration du fournisseur d&#39;identitÃ©s</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Plus de dÃ©tails sur la classe <code class="docutils literal notranslate"><span class="pre">pypnusershub.auth.Authentication</span></code> sont disponibles dans la documentation de lâ<a class="reference external" href="https://github.com/PnX-SI/UsersHub-authentification-module?tab=readme-ov-file#ajouter-son-propre-protocole-de-connexion">API</a>.</p>
</div>
</section>
<section id="desactiver-l-authentification-par-defaut">
<h4>DÃ©sactiver lâauthentification par dÃ©faut<a class="headerlink" href="#desactiver-l-authentification-par-defaut" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Si vous souhaitez dÃ©sactiver lâauthentification par dÃ©faut au profit dâun ou plusieurs autres fournisseurs dâidentitÃ©s, il suffit de ne pas dÃ©clarer celui-ci dans la section <cite>[[AUTHENTICATION.PROVIDERS]]</cite> dans la partie <cite>AUTHENTICATION</cite> de la configuration.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si un seul fournisseur dâidentitÃ©s (diffÃ©rent de lâauthentification par dÃ©faut) est dÃ©clarÃ© dans la section <cite>[[AUTHENTICATION.PROVIDERS]]</cite> de la configuration, lâutilisateur sera redirigÃ© automatiquement vers le portail de connexion de ce dernier.</p>
</div>
</section>
</section>
</section>
<section id="gestion-de-la-sensibilite">
<h2>Gestion de la sensibilitÃ©<a class="headerlink" href="#gestion-de-la-sensibilite" title="Lien vers cette rubrique">Â¶</a></h2>
<section id="id1">
<h3>Introduction<a class="headerlink" href="#id1" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Les rÃ©gles de sensibilitÃ© dÃ©finies par dÃ©faut sont issues des rÃ¨gles du SINP.
Elles dÃ©pendent de lâespÃ¨ce et de lâobservation. Câest-Ã -dire que pour une espÃ¨ce donnÃ©e,
plusieurs niveaux de sensibilitÃ© sont possibles selon lâobservation.</p>
<section id="criteres-de-sensibilite">
<h4>CritÃ¨res de sensibilitÃ©<a class="headerlink" href="#criteres-de-sensibilite" title="Lien vers cette rubrique">Â¶</a></h4>
<ul class="simple">
<li><p>Taxon</p></li>
<li><p>Emplacement</p></li>
<li><p>AnciennetÃ©</p></li>
<li><p>PÃ©riode de lâannÃ©e</p></li>
<li><p>Statut biologique</p></li>
<li><p>Comportement de lâoccurence</p></li>
</ul>
<p>Certaines rÃ¨gles de sensibilitÃ© peuvent porter uniquement sur lâespÃ¨ce,
rendant lâentiÃ¨retÃ© des observations dâune espÃ¨ce (et donc une espÃ¨ce) sensible.</p>
</section>
<section id="niveaux-de-sensibilite">
<h4>Niveaux de sensibilitÃ©<a class="headerlink" href="#niveaux-de-sensibilite" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Voici les 5 niveaux de sensibilitÃ© dÃ©finis par le SINP :</p>
<ul class="simple">
<li><p>Sensible - Aucune diffusion</p></li>
<li><p>Sensible - Diffusion au dÃ©partement</p></li>
<li><p>Sensible - Diffusion Ã  la maille 10km</p></li>
<li><p>Sensible - Diffusion Ã  la Commune ou Znieff</p></li>
<li><p>Non sensible - Diffusion prÃ©cise</p></li>
</ul>
</section>
<section id="pour-plus-d-informations">
<h4>Pour plus dâinformations<a class="headerlink" href="#pour-plus-d-informations" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Vous pouvez consulter :</p>
<ul class="simple">
<li><p>La page du site du <a class="reference external" href="https://inpn.mnhn.fr/programme/donnees-observations-especes/references/sensibilite">SINP traitant de la sensibilitÃ©</a>.</p></li>
<li><p>Le rapport de 2020 sur <a class="reference external" href="https://inpn.mnhn.fr/docs-web/docs/download/355449">La sensibilitÃ© des donnÃ©es du systÃ¨me  dâinformation  de lâinventaire  du  patrimoine naturel : mÃ©thodes, pratiques et usages (J. Ichter et S. Robert)</a>.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Lâobjectif de ce document nâest pas de modifier les rÃ¨gles Ã©tablies par
le SINP. Il est donc conseillÃ© de respecter ces rÃ¨gles dÃ©finies au niveau
rÃ©gional et national et donc de ne pas ajouter de rÃ¨gles locales.</p>
</div>
</section>
</section>
<section id="integration-dans-geonature">
<h3>IntÃ©gration dans GeoNature<a class="headerlink" href="#integration-dans-geonature" title="Lien vers cette rubrique">Â¶</a></h3>
<section id="stockage-des-regles-en-base">
<h4>Stockage des rÃ¨gles en base<a class="headerlink" href="#stockage-des-regles-en-base" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Les rÃ¨gles de sensibilitÃ© sont stockÃ©es dans le schÃ©ma <code class="docutils literal notranslate"><span class="pre">gn_sensitivity</span></code>
qui contient 3 tables :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code> qui relie notamment une espÃ¨ce Ã  un niveau de
sensibilitÃ©</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code> qui permet de restreindre une rÃ¨gle de
sensibilitÃ© en fonction dâun critÃ¨re (par exemple, statut biologique)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cor_sensitivity_area</span></code> qui permet de restreindre une rÃ¨gle de
sensibilitÃ© Ã  une zone gÃ©ographique</p></li>
</ul>
<p>Sâil nây a aucune entrÃ©e dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code>, le niveau de
sensibilitÃ© dÃ©fini dans <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code> est appliquÃ© peu importe
le statut biologique ou le comportement de lâoccurence.
De mÃªme, sâil nây a aucune entrÃ©e dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_area</span></code>, le niveau
de sensibilitÃ© est appliquÃ© peu importe la localisation de lâobservation.
Ã lâinverse, sâil y a plusieurs entrÃ©es, la sensibilitÃ© est appliquÃ©e dÃ¨s
que lâun des critÃ¨res ou lâune des zones correspond Ã  lâobservation.</p>
<p>Si des rÃ¨gles de sensibilitÃ© sont dÃ©finies avec des conditions de critÃ¨res
sur une nomenclature (Statut biologique ou Comportement),
alors ces rÃ¨gles sont appliquÃ©es aussi si la nomenclature nâest pas renseignÃ©e
(par principe de prÃ©caution), en associant aussi des critÃ¨res Ã  ces rÃ¨gles
(dans la table <cite>gn_sensitivity.cor_sensitivity_criteria</cite>) pour les valeurs
de nomenclature Â«Â Non renseignÃ©Â Â», Â«Â Ne sait pasÂ Â», Â«Â IndÃ©terminÃ©Â Â»,â¦
(<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/30c27266495b4affc635f79748c9984feb81a6d7/backend/geonature/core/sensitivity/utils.py#L37-L54">https://github.com/PnX-SI/GeoNature/blob/30c27266495b4affc635f79748c9984feb81a6d7/backend/geonature/core/sensitivity/utils.py#L37-L54</a>).</p>
<p>Certaines rÃ¨gles sont dÃ©finies non pas pour une espÃ¨ce donnÃ©e mais pour un
rang supÃ©rieur. Ces rÃ¨gles sont artificiellement dupliquÃ©es pour chaques espÃ¨ces
sous-jacentes dans la vue matÃ©rialisÃ©e <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules_cd_ref</span></code>.
Il est nÃ©cessaire de la rafraichir lors de lâÃ©volution du rÃ©fÃ©rentiel
de sensibilitÃ©.</p>
</section>
<section id="attribution-aux-observations-de-la-synthese">
<h4>Attribution aux observations de la synthÃ¨se<a class="headerlink" href="#attribution-aux-observations-de-la-synthese" title="Lien vers cette rubrique">Â¶</a></h4>
<p>La sensibilitÃ© des observations de la synthÃ¨se est stockÃ©e dans la
colonne <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code>.</p>
<p>A chaque insertion dâune donnÃ©e dans la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code>,
un trigger (<code class="docutils literal notranslate"><span class="pre">tri_insert_calculate_sensitivity</span></code>) fait appel Ã  une
fonction (<code class="docutils literal notranslate"><span class="pre">fct_tri_cal_sensitivity_on_each_statement</span></code>) qui appelle
elle-mÃªme la fonction <code class="docutils literal notranslate"><span class="pre">gn_sensitivity.get_id_nomenclature_sensitivity</span></code>
pour le calcul de la sensibilitÃ©.</p>
</section>
<section id="gestion-du-referentiel">
<h4>Gestion du rÃ©fÃ©rentiel<a class="headerlink" href="#gestion-du-referentiel" title="Lien vers cette rubrique">Â¶</a></h4>
<p>GeoNature fournit la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span></code> pour gÃ©rer son rÃ©fÃ©rentiel
de sensibilitÃ© :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">info</span></code> : statistiques sur les rÃ¨gles prÃ©sentes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">add-referential</span></code> : import de nouvelles rÃ¨gles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">remove-referential</span></code> : suppression de rÃ¨gles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">refresh-rules-cache</span></code> : mise Ã  jour de la vue matÃ©rialisÃ©es des rÃ¨gles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">update-synthese</span></code> : recalcul de la sensibilitÃ© des observations de la synthÃ¨se</p></li>
</ul>
<p>Le rÃ©fÃ©rentiel de sensibilitÃ© fourni par le SINP est normalement intÃ©grÃ©
Ã  GeoNature lors de son installation. Sinon, il peut Ãªtre manuellement
intÃ©grÃ© ou mis Ã  jour avec lâune ou lâautre des commandes suivantes (selon votre version de Taxref) :</p>
<dl>
<dt>Taxref v17 :</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--source-name<span class="w"> </span><span class="s2">&quot;RÃ©fÃ©rentiel sensibilitÃ© TAXREF v17 20240325&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--url<span class="w"> </span>https://geonature.fr/data/inpn/sensitivity/RefSensibiliteV17_20240325.zip<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--zipfile<span class="w"> </span>RefSensibiliteV17_20240325.zip<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--csvfile<span class="w"> </span>RefSensibilite_17.csv<span class="w">  </span><span class="se">\</span>
<span class="w">         </span>--encoding<span class="o">=</span>utf-8
</pre></div>
</div>
</dd>
<dt>Taxref v16 :</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--source-name<span class="w"> </span><span class="s2">&quot;RÃ©fÃ©rentiel sensibilitÃ© TAXREF v16 20230203&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--url<span class="w"> </span>https://geonature.fr/data/inpn/sensitivity/RefSensibiliteV16_20230203.zip<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--zipfile<span class="w"> </span>RefSensibiliteV16_20230203.zip<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--csvfile<span class="w"> </span>RefSensibiliteV16_20230203/RefSensibilite_16.csv<span class="w">  </span><span class="se">\</span>
<span class="w">         </span>--encoding<span class="o">=</span>iso-8859-15
</pre></div>
</div>
</dd>
<dt>Taxref v15 :</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--source-name<span class="w"> </span><span class="s2">&quot;RÃ©fÃ©rentiel sensibilitÃ© TAXREF v15 20220331&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--url<span class="w"> </span>https://inpn.mnhn.fr/docs-web/docs/download/401875<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--zipfile<span class="w"> </span>RefSensibiliteV15_20220331.zip<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--csvfile<span class="w"> </span>RefSensibilite_V15_31032022/RefSensibilite_15.csv<span class="w">  </span><span class="se">\</span>
<span class="w">         </span>--encoding<span class="o">=</span>iso-8859-15
</pre></div>
</div>
</dd>
<dt>Taxref v14 :</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--source-name<span class="w"> </span><span class="s2">&quot;RÃ©fÃ©rentiel sensibilitÃ© TAXREF v14 20220331&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--url<span class="w"> </span>https://inpn.mnhn.fr/docs-web/docs/download/401876<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--zipfile<span class="w"> </span>RefSensibiliteV14_20220331.zip<span class="w"> </span><span class="se">\</span>
<span class="w">         </span>--csvfile<span class="w"> </span>RefSensibilite_V14_31032022/RefSensibilite_14.csv<span class="w">  </span><span class="se">\</span>
<span class="w">         </span>--encoding<span class="o">=</span>iso-8859-15
</pre></div>
</div>
</dd>
</dl>
<p>Le jeu de rÃ¨gles est fourni pour chaque version prÃ©cise de Taxref, certaines
espÃ¨ces sensibles pouvant voir leur <em>cd_nom</em> changer dâune version Ã  lâautre.</p>
<p>Si vous mettez Ã  jour votre version du rÃ©fÃ©rentiel de sensibilitÃ©, il faut ensuite relancer
le calcul des rÃ¨gles de sensibilitÃ© avec la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">refresh-rules-cache</span></code>.</p>
</section>
<section id="personnalisation">
<h4>Personnalisation<a class="headerlink" href="#personnalisation" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Pour lâinstant, seule la personnalisation de la sensibilitÃ© pour
une espÃ¨ce donnÃ©e (peu importe lâobservation) est abordÃ©e ici.</p>
<ol class="arabic">
<li><p>Dans <code class="docutils literal notranslate"><span class="pre">gn_sensitivity.t_sensitivity_rules</span></code> : Changez le niveau de
sensibilitÃ© <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code> par celui dÃ©sirÃ©. Pour la
valeur Ã  renseigner, voir dans <code class="docutils literal notranslate"><span class="pre">t_nomenclature</span></code> en filtrant avec
<code class="docutils literal notranslate"><span class="pre">id_type=ref_nomenclatures.get_id_nomenclature_type('SENSIBILITE')</span></code>.</p></li>
<li><p>Dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code> : sâil y a une correspondance
dâ<code class="docutils literal notranslate"><span class="pre">id_sensitivity</span></code> avec <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code>, modifiez ou supprimez cette ligne.</p></li>
<li><p>Rafraichissez le cache des rÃ¨gles extrapolÃ©es aux espÃ¨ces :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>refresh-rules-cache
</pre></div>
</div>
<p>Ceci est Ã©quivalent Ã  lancer manuellement la commande SQL suivante :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">REFRESH</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">gn_sensitivity</span><span class="p">.</span><span class="n">t_sensitivity_rules_cd_ref</span>
</pre></div>
</div>
</li>
<li><p>Il est maintenant nÃ©cessaire de mettre Ã  jour la sensibilitÃ© de vos
observations prÃ©sentes dans la synthÃ¨se. Pour cela, lancez la commande suivante :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>update-synthese
</pre></div>
</div>
</li>
</ol>
<p>Les valeurs dans la colonne <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code> des observations sensibles
de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code> auront alors
changÃ©. Vous pouvez le vÃ©rifier en navigant dans le module SynthÃ¨se
puis dans les dÃ©tails dâune observation de votre/vos espÃ¨ce(s).</p>
</section>
<section id="utilisation">
<h4>Utilisation<a class="headerlink" href="#utilisation" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Un lien entre la synthÃ¨se et la sensibilitÃ© a Ã©tÃ© mis en place : le floutage des donnÃ©es sensibles.</p>
<p>Lâobjectif et de pouvoir donner accÃ¨s aux utilisateurs Ã  des donnÃ©es sensibles mais pas de faÃ§on prÃ©cise.
Câest-Ã -dire, en fonction du niveau de sensibilitÃ© de lâobservation, un utilisateur pourra voir uniquement
lâobservation Ã  la maille de 10km par exemple.</p>
<p>Comme dÃ©crit ci-dessous, un paramÃ¨tre en configuration a Ã©tÃ© ajoutÃ© pour donner la possibilitÃ© dâexclure
toutes les donnÃ©es sensibles plutÃ´t que de les flouter.</p>
<section id="implementation">
<h5>Implementation<a class="headerlink" href="#implementation" title="Lien vers cette rubrique">Â¶</a></h5>
<p>BasÃ©e sur le nouveau systÃ¨me de permissions (v2.13), lâimplÃ©mentation dans ce systÃ¨me se rÃ©sout Ã 
lâajout dâun filtre : exclure/flouter les donnÃ©es sensibles.
Le choix entre lâexclusion et le floutage est dÃ©fini par le paramÃ¨tre en configuration :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[SYNTHESE]</span>
<span class="n">BLUR_SENSITIVE_OBSERVATIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</pre></div>
</div>
<p>Si <code class="docutils literal notranslate"><span class="pre">BLUR_SENSITIVE_OBSERVATIONS=true</span></code> alors les observations seront floutÃ©es. Sinon exclues.</p>
<p>Lâexclusion des donnÃ©es sensibles est simple : si le filtre Â«Â exclure les donnÃ©es sensiblesÂ Â» est cochÃ©,
lâutilisateur nâaura pas accÃ¨s (pour un scope dÃ©fini) aux donnÃ©es sensibles quelque soit leur niveau
de sensibilitÃ© soit :</p>
<ul class="simple">
<li><p>Sensible - Diffusion Ã  la Commune ou Znieff</p></li>
<li><p>Sensible - Diffusion Ã  la maille 10km</p></li>
<li><p>Sensible - Diffusion au dÃ©partement</p></li>
<li><p>Sensible - Aucune diffusion</p></li>
</ul>
<p>Pour la suite de la documentation, le paramÃ¨tre est considÃ©rÃ© comme le suivant : <code class="docutils literal notranslate"><span class="pre">BLUR_SENSITIVE_OBSERVATIONS=true</span></code>.
Donc toute donnÃ©e sensible avec restriction dâaccÃ¨s sera floutÃ©e.</p>
<p>Si ce filtre nâest pas activÃ©, la rÃ©cupÃ©ration des donnÃ©es de la synthÃ¨se en backend reste inchangÃ©e.
En effet, lâajout du floutage des donnÃ©es nuit forcÃ©ment aux performances.</p>
<p>Sâil est activÃ©, une requÃªte SQL est construite comme suit :</p>
<img alt="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/blurring_query.svg" src="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/blurring_query.svg" />
<p>Le but est dâajouter Ã  la requÃªte principale une sous-requÃªte exÃ©cutant deux requÃªtes <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> dans
la table de synthÃ¨se afin de sÃ©parer les donnÃ©es prÃ©cises des donnÃ©es floutÃ©es. Ensuite un <code class="docutils literal notranslate"><span class="pre">UNION</span></code>
est fait afin de rassembler les donnÃ©es avec prioritÃ© sur les donnÃ©es prÃ©cises.</p>
<p>Dans ces deux requÃªtes, les permissions ainsi que les filtres utilisateurs sont pris en comptes, donc
lâutilisateur nâa pas obligatoirement accÃ¨s Ã  toutes les donnÃ©es, câest Ã  la charge de lâadministrateur.
Le fait de prendre en compte les filtres dans chacune des deux requÃªtes permet une cohÃ©rence dans les
rÃ©sultats renvoyÃ©s par ces deux requÃªtes (car un <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> est souvent prÃ©sent).</p>
<p>Ce floutage des donnÃ©es a Ã©tÃ© implÃ©mentÃ© sur 3 routes de la synthÃ¨se :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/for_web</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/vsynthese/&lt;id_synthese&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/export_observations</span></code></p></li>
</ul>
<p>Des tests unitaires ont Ã©galement Ã©tÃ© Ã©crits.</p>
</section>
<section id="traitement-des-problematiques-lies-aux-zonages">
<h5>Traitement des problÃ©matiques liÃ©s aux zonages<a class="headerlink" href="#traitement-des-problematiques-lies-aux-zonages" title="Lien vers cette rubrique">Â¶</a></h5>
<p><strong>Traitement de lâaffichage en mode maille</strong></p>
<p>Il a Ã©tÃ© dÃ©cidÃ© dâexclure les donnÃ©es sensibles dont la gÃ©omÃ©trie floutÃ©e est plus grande que la
maille affichÃ©e en mode maille dans la synthÃ¨se.</p>
<p>Câest-Ã -dire que si une observation est dÃ©gradÃ©e/floutÃ©e Ã  la maille M10 (10kmÂ²) et que le mode maille
affiche les observations regroupÃ©es dans les mailles de type M5 (5km), lâobservation nâapparaitra dans
aucune maille mais dans seulement dans la liste des observations.</p>
<p>Pour rappel la maille de regroupement pour affichage dans le mode maille est dÃ©finie par le paramÃ¨tre
suivant :</p>
<p>Pour que ce filtrage soit effectuÃ©, il Ã©tait nÃ©cessaire dâintroduire une nouvelle colonne dans la table
<code class="docutils literal notranslate"><span class="pre">ref_geo.bib_area_types</span></code> : <code class="docutils literal notranslate"><span class="pre">size_hierarchy</span></code> qui permet dâordonner les types de zones par leur
taille moyenne. Pour les mailles cela est simple, pour les dÃ©partements et les communes notamment
utilisÃ©es pour flouter la donnÃ©e, cela est plus complexe. Leur taille a donc Ã©tÃ© donnÃ©e arbitrairement.
Le floutage des donnÃ©es est censÃ© Ã©voluer vers des zonages de floutage basÃ©es exclusivement sur des
mailles. Le problÃ¨me de la taille arbitraire ne sera alors plus dâactualitÃ©.</p>
<p><strong>Traitement des zonages associÃ©s</strong></p>
<p>Lâintroduction de la nouvelle colone <code class="docutils literal notranslate"><span class="pre">size_hierarchy</span></code> permet Ã©galement dâafficher uniquement les
zonages plus grands que la gÃ©omÃ©trie floutÃ©e dans lâonglet Â«Â ZonageÂ Â» des dÃ©tails dâune observation en
synthÃ¨se. Par exemple, les mailles M1 (1kmÂ²) et M5 (5kmÂ²) dâune observation floutÃ©e Ã  la maille M10
(10kmÂ²) nâapparaitront pas.</p>
<p><strong>Traitement du filtre de type Â«Â zonageÂ Â»</strong></p>
<p>Pour rappel, ce filtre permet de rechercher si des observations intersectent des zones choisies par
lâutilisateur. Ces zones sont disponibles dans la section Â«Â OÃ¹Â Â» dans le module SynthÃ¨se.</p>
<p>En backend, quand lâutilisateur voit les donnÃ©es prÃ©cisÃ©ment, le filtre fonctionne grÃ¢ce Ã  la
table <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code>, Ã©vitant de procÃ©der Ã  lâappel de <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code> plus lent.</p>
<p>Ce filtre fonctionne diffÃ©remment quand lâutilisateur dispose de permissions floutant les
donnÃ©es. En effet, un <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code> est effectuÃ© sur la gÃ©omÃ©trie floutÃ©e car lâutilisation de
<code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code> pourrait donner trop dâinformations Ã  lâutilisateur et ce dernier
pourrait obtenir des donnÃ©es plus prÃ©cises que souhaitÃ© par recherche sur diffÃ©rentes communes alors
que lâobservation est floutÃ©e au dÃ©partement par exemple.</p>
</section>
</section>
</section>
</section>
<section id="module-occtax">
<h2>Module OCCTAX<a class="headerlink" href="#module-occtax" title="Lien vers cette rubrique">Â¶</a></h2>
<section id="installer-le-module">
<h3>Installer le module<a class="headerlink" href="#installer-le-module" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Le module est fourni par dÃ©faut avec lâinstallation de GeoNature.</p>
<p>Si vous lâavez supprimÃ©, lancez les commandes suivantes depuis le rÃ©pertoire <code class="docutils literal notranslate"><span class="pre">backend</span></code> de GeoNature</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source venv/bin/activate</span>
<span class="go">geonature install_gn_module /home/&lt;mon_user&gt;/geonature/contrib/occtax occtax</span>
</pre></div>
</div>
</section>
<section id="configuration-du-module">
<h3>Configuration du module<a class="headerlink" href="#configuration-du-module" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Le paramÃ©trage du module OCCTAX se fait en crÃ©ant le fichier <code class="docutils literal notranslate"><span class="pre">config/occtax_config.toml</span></code>, en sâinspirant du fichier dâexemple <code class="docutils literal notranslate"><span class="pre">contrib/occtax/occtax_config.toml.example</span></code>.
Reportez vous Ã  la section <a class="reference internal" href="#configuration-d-un-gn-module">Configuration dâun gn_module</a> pour effectuer les opÃ©rations supplÃ©mentaires nÃ©cessaires pour la prise en compte des modifications.</p>
<section id="afficher-masquer-des-champs-du-formulaire">
<h4>Afficher/masquer des champs du formulaire<a class="headerlink" href="#afficher-masquer-des-champs-du-formulaire" title="Lien vers cette rubrique">Â¶</a></h4>
<p>La quasi-totalitÃ© des champs du standard Occurrences de taxons sont prÃ©sents dans la base de donnÃ©es, et peuvent donc Ãªtre saisis Ã  partir du formulaire.</p>
<p>Pour plus de souplesse et afin de rÃ©pondre aux besoins de chacun, lâensemble des champs sont masquables (sauf les champs essentiels : observateur, taxon â¦)</p>
<p>En modifiant les variables des champs ci-dessous, vous pouvez donc personnaliser le formulaire :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[form_fields]</span>
<span class="w">    </span><span class="n">date_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">date_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">hour_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">hour_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">altitude_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">altitude_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">obs_technique</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">group_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">comment_releve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">obs_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">bio_condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">bio_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">naturalness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">exist_proof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">observation_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">diffusion_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">blurring</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">determiner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">determination_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">sample_number_proof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">digital_proof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">non_digital_proof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">source_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">comment_occ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">life_stage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">obj_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">type_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">count_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">count_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">validation_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</pre></div>
</div>
<p>Si le champ est masquÃ©, une valeur par dÃ©faut est inscrite en base (voir plus loin pour dÃ©finir ces valeurs).</p>
</section>
<section id="modifier-le-champ-observateurs">
<h4>Modifier le champ Observateurs<a class="headerlink" href="#modifier-le-champ-observateurs" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Par dÃ©faut le champ <code class="docutils literal notranslate"><span class="pre">Observateurs</span></code> est une liste dÃ©roulante qui pointe vers une liste du schÃ©ma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>.
Il est possible de passer ce champ en texte libre en mettant Ã  <code class="docutils literal notranslate"><span class="pre">true</span></code> la variable <code class="docutils literal notranslate"><span class="pre">observers_txt</span></code>.</p>
<p>Le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">id_observers_list</span></code> permet de changer la liste dâobservateurs proposÃ©e dans le formulaire. Vous pouvez modifier le numÃ©ro de liste du module ou modifier le contenu de la liste dans UsersHub (<code class="docutils literal notranslate"><span class="pre">utilisateurs.t_listes</span></code> et <code class="docutils literal notranslate"><span class="pre">utilisateurs.cor_role_liste</span></code>)</p>
<p>Par dÃ©faut, lâensemble des observateurs de la liste 9 (observateurs faune/flore) sont affichÃ©s.</p>
</section>
<section id="personnaliser-la-liste-des-taxons-et-habitats-saisissables-dans-le-module">
<h4>Personnaliser la liste des taxons et habitats saisissables dans le module<a class="headerlink" href="#personnaliser-la-liste-des-taxons-et-habitats-saisissables-dans-le-module" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Il est possible de limiter la liste des taxons saisissables dans Occtax, en renseignant le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">id_taxon_list</span></code>. Celui-ci nâest pas dÃ©fini par dÃ©faut et câest donc tout Taxref qui est proposÃ© Ã  la saisie par dÃ©faut.</p>
<p>Une liste restreinte de taxons (8 seulement) est proposÃ©e par dÃ©faut (<code class="docutils literal notranslate"><span class="pre">id_taxon_list</span> <span class="pre">=</span> <span class="pre">100</span></code>). Lâadministrateur peut changer, complÃ©ter ou supprimer cette liste.</p>
<p>Le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">id_taxon_list</span> <span class="pre">=</span> <span class="pre">100</span></code> correspond donc Ã  un ID de liste de la table <code class="docutils literal notranslate"><span class="pre">taxonomie.bib_listes</span></code> (LâID 100 correspond Ã  la liste Â«Â Saisie OcctaxÂ Â»).</p>
<p>Voici un exemple de requÃªte SQL pour remplir la liste 100 avec tous les taxons de flore de Taxref Ã  partir du rang <code class="docutils literal notranslate"><span class="pre">genre</span></code> :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">taxonomie</span><span class="p">.</span><span class="n">cor_nom_liste</span><span class="w"> </span><span class="p">(</span><span class="n">id_liste</span><span class="p">,</span><span class="n">id_nom</span><span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="n">tx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">cd_nom</span><span class="p">,</span><span class="w"> </span><span class="n">cd_ref</span><span class="p">,</span><span class="w"> </span><span class="n">nom_vern</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">taxonomie</span><span class="p">.</span><span class="n">taxref</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">id_rang</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Dumm&#39;</span><span class="p">,</span><span class="s1">&#39;SPRG&#39;</span><span class="p">,</span><span class="s1">&#39;KD&#39;</span><span class="p">,</span><span class="s1">&#39;SSRG&#39;</span><span class="p">,</span><span class="s1">&#39;IFRG&#39;</span><span class="p">,</span><span class="s1">&#39;PH&#39;</span><span class="p">,</span><span class="s1">&#39;SBPH&#39;</span><span class="p">,</span><span class="s1">&#39;IFPH&#39;</span><span class="p">,</span><span class="s1">&#39;DV&#39;</span><span class="p">,</span><span class="s1">&#39;SBDV&#39;</span><span class="p">,</span><span class="s1">&#39;SPCL&#39;</span><span class="p">,</span><span class="s1">&#39;CLAD&#39;</span><span class="p">,</span><span class="s1">&#39;CL&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;SBCL&#39;</span><span class="p">,</span><span class="s1">&#39;IFCL&#39;</span><span class="p">,</span><span class="s1">&#39;LEG&#39;</span><span class="p">,</span><span class="s1">&#39;SPOR&#39;</span><span class="p">,</span><span class="s1">&#39;COH&#39;</span><span class="p">,</span><span class="s1">&#39;OR&#39;</span><span class="p">,</span><span class="s1">&#39;SBOR&#39;</span><span class="p">,</span><span class="s1">&#39;IFOR&#39;</span><span class="p">,</span><span class="s1">&#39;SPFM&#39;</span><span class="p">,</span><span class="s1">&#39;FM&#39;</span><span class="p">,</span><span class="s1">&#39;SBFM&#39;</span><span class="p">,</span><span class="s1">&#39;TR&#39;</span><span class="p">,</span><span class="s1">&#39;SSTR&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="n">tr</span><span class="p">.</span><span class="n">cd_nom</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">taxonomie</span><span class="p">.</span><span class="n">taxref</span><span class="w"> </span><span class="n">tr</span>
<span class="w">  </span><span class="k">join</span><span class="w"> </span><span class="n">tx</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">cd_nom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tr</span><span class="p">.</span><span class="n">cd_nom</span>
<span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">tr</span><span class="p">.</span><span class="n">regne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Plantae&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Il est Ã©galement possible de gÃ©rer les listes de taxons avec le module TaxHub.</p>
<p>Il est de mÃªme possible de restreindre la liste dâhabitats proposÃ©s dans le module :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ID_LIST_HABITAT</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Avec <code class="docutils literal notranslate"><span class="pre">ID_LIST_HABITAT</span></code> faisant rÃ©fÃ©rence aux listes dÃ©finies dans <code class="docutils literal notranslate"><span class="pre">ref_habitats.bib_list_habitat</span></code>. La liste est peuplÃ©e dâhabitats grÃ¢ce Ã  la table <code class="docutils literal notranslate"><span class="pre">ref_habitats.cor_list_habitat</span></code>. Par exemple :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- CrÃ©ation d&#39;une liste restreinte d&#39;habitats pour Occtax</span>
<span class="c1">-- (typologie EUNIS de niveau 2)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ref_habitats</span><span class="p">.</span><span class="n">cor_list_habitat</span><span class="w"> </span><span class="n">clh</span><span class="p">(</span>
<span class="w">        </span><span class="n">cd_hab</span><span class="p">,</span>
<span class="w">        </span><span class="n">id_list</span>
<span class="p">)</span>
<span class="k">SELECT</span>
<span class="w">        </span><span class="n">hr</span><span class="p">.</span><span class="n">cd_hab</span><span class="p">,</span>
<span class="w">        </span><span class="mi">2</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">ref_habitats</span><span class="p">.</span><span class="n">habref</span><span class="w"> </span><span class="n">hr</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">hr</span><span class="p">.</span><span class="n">cd_typo</span><span class="p">,</span><span class="n">hr</span><span class="p">.</span><span class="n">niveau</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
</section>
<section id="gerer-les-valeurs-par-defaut-des-nomenclatures">
<h4>GÃ©rer les valeurs par dÃ©faut des nomenclatures<a class="headerlink" href="#gerer-les-valeurs-par-defaut-des-nomenclatures" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Le formulaire de saisie prÃ©-remplit des valeurs par dÃ©faut pour simplifier la saisie. Ce sont Ã©galement ces valeurs qui sont prises en compte pour remplir dans la BDD les champs du formulaire qui sont masquÃ©s.</p>
<p>La table <code class="docutils literal notranslate"><span class="pre">pr_occtax.defaults_nomenclatures_value</span></code> dÃ©finit les valeurs par dÃ©faut pour chaque nomenclature.</p>
<p>La table contient les deux colonnes suivantes :</p>
<ul class="simple">
<li><p>lâ<code class="docutils literal notranslate"><span class="pre">id_type</span></code> de nomenclature (voir table <code class="docutils literal notranslate"><span class="pre">ref_nomenclature.bib_nomenclatures_types</span></code>)</p></li>
<li><p>lâ<code class="docutils literal notranslate"><span class="pre">id_nomenclature</span></code> (voir table <code class="docutils literal notranslate"><span class="pre">ref_nomenclature.t_nomenclatures</span></code>)</p></li>
</ul>
<p>Pour chaque type de nomenclature, on associe lâID de la nomenclature que lâon souhaite voir apparaitre par dÃ©faut.</p>
<p>Le mÃ©canisme peut Ãªtre poussÃ© plus loin en associant une nomenclature par dÃ©faut par organisme, rÃ¨gne et group2_inpn.
La valeur 0 pour ses champs revient Ã  mettre la valeur par dÃ©faut pour tous les organismes, tous les rÃ¨gnes et tous les group2_inpn.</p>
<p>Une interface de gestion des nomenclatures est prÃ©vue dâÃªtre dÃ©veloppÃ©e pour simplifier cette configuration.</p>
<p>TODO : valeur par dÃ©faut de la validation</p>
</section>
<section id="personnaliser-l-interface-map-list">
<h4>Personnaliser lâinterface Map-list<a class="headerlink" href="#personnaliser-l-interface-map-list" title="Lien vers cette rubrique">Â¶</a></h4>
<p>La liste des champs affichÃ©s par dÃ©faut dans le tableau peut Ãªtre modifiÃ©e avec le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">default_maplist_columns</span></code>.</p>
<p>Par dÃ©faut :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="n">default_maplist_columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">prop</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;taxons&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Taxon&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">prop</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;date_min&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Date dÃ©but&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">prop</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;observateurs&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Observateurs&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">prop</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;dataset_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Jeu de donnÃ©es&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Voir la vue <code class="docutils literal notranslate"><span class="pre">occtax.v_releve_list</span></code> pour voir les champs disponibles.</p>
</section>
<section id="ajouter-une-contrainte-d-echelle-de-saisie-sur-la-carte">
<h4>Ajouter une contrainte dâÃ©chelle de saisie sur la carte<a class="headerlink" href="#ajouter-une-contrainte-d-echelle-de-saisie-sur-la-carte" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Il est possible de contraindre la saisie de la gÃ©omÃ©trie dâun relevÃ© sur la carte par un seuil dâÃ©chelle minimum avec le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">releve_map_zoom_level</span></code>.</p>
<p>Par dÃ©faut :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zoom level on the map from which you can add point/line/polygon</span>
<span class="n">releve_map_zoom_level</span> <span class="o">=</span> <span class="mi">6</span>
</pre></div>
</div>
<p>Il suffit de modifier la valeur qui correspond au niveau de zoom sur la carte.
Par exemple, pour contraindre la saisie Ã  lâaffichage de la carte IGN au 1/25000e :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">releve_map_zoom_level</span> <span class="o">=</span> <span class="mi">15</span>
</pre></div>
</div>
</section>
<section id="supprimer-le-remplissage-automatique-de-la-date">
<h4>Supprimer le remplissage automatique de la date<a class="headerlink" href="#supprimer-le-remplissage-automatique-de-la-date" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Pour Ã©viter les erreurs de saisie lorsque des donnÃ©es sont rentrÃ©es longtemps aprÃ¨s le retour du terrain, il est possible de supprimer lâajout automatique de la date du jour au relevÃ© :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DATE_FORM_WITH_TODAY</span> <span class="o">=</span> <span class="n">false</span>
</pre></div>
</div>
</section>
</section>
<section id="gestion-des-exports">
<h3>Gestion des exports<a class="headerlink" href="#gestion-des-exports" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Les exports du module sont basÃ©s sur une vue (par dÃ©faut <code class="docutils literal notranslate"><span class="pre">pr_occtax.export_occtax_sinp</span></code>)</p>
<p>Il est possible de dÃ©finir une autre vue pour avoir des exports personnalisÃ©s.
Pour cela, crÃ©er votre vue, et modifier les paramÃ¨tres suivants :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Name of the view based export</span>
<span class="n">export_view_name</span> <span class="o">=</span> <span class="s1">&#39;v_export_occtax&#39;</span>

<span class="c1"># Name of the geometry columns of the view</span>
<span class="n">export_geom_columns_name</span> <span class="o">=</span> <span class="s1">&#39;geom_4326&#39;</span>

<span class="c1"># Name of the primary key column of the view</span>
<span class="n">export_id_column_name</span> <span class="o">=</span> <span class="s1">&#39;permId&#39;</span>
</pre></div>
</div>
<p>La vue doit cependant contenir les champs suivants pour que les filtres de recherche fonctionnent :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date_min</span><span class="p">,</span>
<span class="n">date_max</span><span class="p">,</span>
<span class="n">id_releve_occtax</span><span class="p">,</span>
<span class="n">id_dataset</span><span class="p">,</span>
<span class="n">id_occurrence_occtax</span><span class="p">,</span>
<span class="n">id_digitiser</span><span class="p">,</span>
<span class="n">geom_4326</span><span class="p">,</span>
<span class="n">dataset_name</span>
</pre></div>
</div>
</section>
<section id="attribuer-des-permissions">
<h3>Attribuer des permissions<a class="headerlink" href="#attribuer-des-permissions" title="Lien vers cette rubrique">Â¶</a></h3>
<p>La gestion des permissions (CRUVED) se fait module par module, depuis le module Â«Â AdminÂ Â».</p>
</section>
<section id="dupliquer-le-module-occtax">
<h3>Dupliquer le module Occtax<a class="headerlink" href="#dupliquer-le-module-occtax" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Il est possible de Â«Â dupliquerÂ Â» le module Occtax pour crÃ©er des nouveaux modules, basÃ© sur le moteur dâOcctax, en y ajoutant des champs additionnels propre au module.</p>
<p>Le schÃ©ma de base de donnÃ©es ainsi que les routes du backend utilisÃ©es restent les mÃªmes (celles dâOcctax). En base de donnÃ©es un nouveau champs <code class="docutils literal notranslate"><span class="pre">id_module</span></code> permet de diffÃ©rencier les donnÃ©es venant des differents modules. Concernant lâAPI, les routes sont appelÃ©es avec le prÃ©fixe du module code :</p>
<ul class="simple">
<li><p>route Occtax : <code class="docutils literal notranslate"><span class="pre">/occtax/releves</span></code></p></li>
<li><p>route du module dupliquÃ© : <cite>occtax/&lt;MODULE_CODE&gt;/releves</cite></p></li>
</ul>
<p>Pour crÃ©er un nouveau module Â«Â Occtax dupliquÃ©Â Â», ajoutez une ligne dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules</span></code>.</p>
<p>La ligne doit contenir les informations suivantes :</p>
<ul class="simple">
<li><p>le <code class="docutils literal notranslate"><span class="pre">module_code</span></code> doit Ãªtre unique,</p></li>
<li><p>les champs <code class="docutils literal notranslate"><span class="pre">active_frontend=true</span></code>, <code class="docutils literal notranslate"><span class="pre">active_backend=false</span></code>, <code class="docutils literal notranslate"><span class="pre">ng_module=occtax</span></code> et le champs <code class="docutils literal notranslate"><span class="pre">module_path</span></code> pour lâURL derriÃ¨re lequel le module sera servi (<code class="docutils literal notranslate"><span class="pre">/florestation</span></code> par exemple)</p></li>
</ul>
<p>Exemple :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="p">(</span><span class="n">module_code</span><span class="p">,</span><span class="w"> </span><span class="n">module_label</span><span class="p">,</span><span class="w"> </span><span class="n">module_picto</span><span class="p">,</span><span class="w"> </span><span class="n">module_desc</span><span class="p">,</span><span class="w"> </span><span class="n">module_path</span><span class="p">,</span><span class="n">active_frontend</span><span class="p">,</span><span class="w"> </span><span class="n">active_backend</span><span class="p">,</span><span class="w"> </span><span class="n">ng_module</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="w">     </span><span class="p">(</span><span class="s1">&#39;FLORE_STATION&#39;</span><span class="p">,</span><span class="s1">&#39;Flore station v2&#39;</span><span class="p">,</span><span class="s1">&#39;fa-leaf&#39;</span><span class="p">,</span><span class="s1">&#39;Module de saisie Flore station (sous module Occtax)&#39;</span><span class="p">,</span><span class="s1">&#39;flore_station&#39;</span><span class="p">,</span><span class="k">true</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="s1">&#39;occtax&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Ajoutez ensuite une Â«Â sourceÂ Â» dans la synthese (<code class="docutils literal notranslate"><span class="pre">gn_synthese.t_sources</span></code>) pour ce nouveau module.</p>
<p>Dans lâexemple ci-dessous, remplacez <code class="docutils literal notranslate"><span class="pre">&lt;MODULE_PATH&gt;</span></code> par le contenu de la colonne <code class="docutils literal notranslate"><span class="pre">module_path</span></code> ainsi que <code class="docutils literal notranslate"><span class="pre">&lt;ID_MODULE&gt;</span></code> par lâid du module que vous venez de crÃ©er.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">t_sources</span><span class="w"> </span><span class="p">(</span><span class="n">name_source</span><span class="p">,</span><span class="n">desc_source</span><span class="p">,</span><span class="n">entity_source_pk_field</span><span class="p">,</span><span class="n">url_source</span><span class="p">,,</span><span class="n">id_module</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">(</span><span class="s1">&#39;Flore station (sous-module Occtax)&#39;</span><span class="p">,</span><span class="s1">&#39;DonnÃ©es issues du protocole Flore station&#39;</span><span class="p">,</span><span class="s1">&#39;pr_occtax.cor_counting_occtax.id_counting_occtax&#39;</span><span class="p">,</span><span class="s1">&#39;#/&lt;MODULE_PATH&gt;/info/id_counting&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ID_MODULE</span><span class="o">&gt;</span><span class="p">);</span>
</pre></div>
</div>
<p>Bien que le module soit une copie dâOcctax, il est tout de mÃªme nÃ©cessaire de dÃ©finir les permissions disponibles pour ce module (ce sont les mÃªmes quâOcctax). Jouez le scrit SQL suivant en remplacant :MODULE_CODE par le code du module que vous venez de crÃ©er.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span>
<span class="w">    </span><span class="n">gn_permissions</span><span class="p">.</span><span class="n">t_permissions_available</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">id_module</span><span class="p">,</span>
<span class="w">        </span><span class="n">id_object</span><span class="p">,</span>
<span class="w">        </span><span class="n">id_action</span><span class="p">,</span>
<span class="w">        </span><span class="n">label</span><span class="p">,</span>
<span class="w">        </span><span class="n">scope_filter</span>
<span class="w">    </span><span class="p">)</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">id_module</span><span class="p">,</span>
<span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">id_object</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">id_action</span><span class="p">,</span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">label</span><span class="p">,</span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">scope_filter</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="p">(</span>
<span class="w">        </span><span class="k">VALUES</span>
<span class="w">              </span><span class="p">(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;CrÃ©er des relevÃ©s&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">,(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Voir les relevÃ©s&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">,(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Modifier les relevÃ©s&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">,(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Exporter les relevÃ©s&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">,(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Supprimer des relevÃ©s&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">(</span><span class="n">module_code</span><span class="p">,</span><span class="w"> </span><span class="n">object_code</span><span class="p">,</span><span class="w"> </span><span class="n">action_code</span><span class="p">,</span><span class="w"> </span><span class="n">scope_filter</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">)</span>
<span class="k">JOIN</span>
<span class="w">    </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">module_code</span>
<span class="k">JOIN</span>
<span class="w">    </span><span class="n">gn_permissions</span><span class="p">.</span><span class="n">t_objects</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">code_object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">object_code</span>
<span class="k">JOIN</span>
<span class="w">    </span><span class="n">gn_permissions</span><span class="p">.</span><span class="n">bib_actions</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">code_action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">action_code</span><span class="p">;</span>
</pre></div>
</div>
<section id="associer-des-jeux-de-donnees-et-des-champs-additionnels">
<h4>Associer des jeux de donnÃ©es et des champs additionnels<a class="headerlink" href="#associer-des-jeux-de-donnees-et-des-champs-additionnels" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Dans le module MÃ©tadonnÃ©es (formulaire des jeux de donnÃ©es), associez les jeux de donnÃ©es que vous souhaitez rendre saisissables au nouveau module dupliquÃ©.</p>
</section>
<section id="ajouter-le-nouveau-module-dans-la-liste-des-modules-implementes">
<h4>Ajouter le nouveau module dans la liste des modules implÃ©mentÃ©s<a class="headerlink" href="#ajouter-le-nouveau-module-dans-la-liste-des-modules-implementes" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Dans le fichier de configuration de GeoNature (geonature_config.toml) ajoutez une section <cite>ADDITIONAL_FIELDS</cite> qui contient tableau <cite>IMPLEMENTED_MODULES</cite> listant les modules qui implÃ©mentent les champs additionnels (Occtax doit y figurer en plus du nouveau module)</p>
<p>Vous pouvez ensuite crÃ©er des nouveaux champs additionnels et les associer Ã  ce module. De la mÃªme maniÃ¨re que dans Occtax, on peut les associer aux trois niveaux du formulaire (relevÃ©, occurrence, dÃ©nombrement).</p>
</section>
</section>
</section>
<section id="module-admin">
<h2>Module Admin<a class="headerlink" href="#module-admin" title="Lien vers cette rubrique">Â¶</a></h2>
<section id="administration-des-champs-additionnels">
<h3>Administration des champs additionnels<a class="headerlink" href="#administration-des-champs-additionnels" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Certains protocoles nÃ©cessitent la saisie de champs qui vont au-delÃ  des standards du SINP sur lesquels GeoNature sâappuie. Les champs additionnels permettent ainsi dâÃ©tendre les formulaires en ajoutant des informations spÃ©cifiques pour des jeux de donnÃ©es (JDD) ou pour lâensemble dâun module.</p>
<p>Les champs additionnels ne sont pas crÃ©Ã©s comme des colonnes Ã  part entiÃ¨re, mais leurs valeurs sont stockÃ©es dans un champs <code class="docutils literal notranslate"><span class="pre">additional_data</span></code> au format JSON.</p>
<p>Actuellement seul le module Occtax implÃ©mente la gestion de ces champs additionnels.</p>
<p>Le module Â«Â AdminÂ Â» de GeoNature offre une interface de crÃ©ation et de gestion de ces champs additionnels.
Un champ additionnel est dÃ©finit par:</p>
<ul class="simple">
<li><p>son nom (nom dans la base de donnÃ©es)</p></li>
<li><p>son label (nom tel quâil sera affichÃ© sur lâinterface)</p></li>
<li><p>son type de widget : vous devez dÃ©finir si le champs est une liste dÃ©roulante, une checkbox, une nomenclature, un entier, un champ texte, etcâ¦</p></li>
<li><p>le (ou les) module(s) auquel il est rattachÃ©</p></li>
<li><p>le (ou les) objet(s) auquel il est rattachÃ©. Il sâagit du placement et de la table de rattachement du champs dans le module. Par exemple Occtax est composÃ© de 3 Â«Â objets/tableÂ Â». Les objets Â«Â relevÃ©Â Â», Â«Â occurrenceÂ Â» et Â«Â dÃ©nombrementÂ Â».</p></li>
<li><p>le (ou les) JDD auquel il est rattachÃ©. Si aucun JDD nâest renseignÃ© le champ sera proposÃ© dans tout le module pour tous les JDD. Sâil est rattachÃ© Ã  un JDD, le champs sera chargÃ© dynamiquement Ã  la selection du JDD dans le formulaire</p></li>
<li><p>une sÃ©rie dâautres options pour paramÃ©trer le comportement du champs (obligatoire, ordre, description, exportable etcâ¦)</p></li>
</ul>
<p>Les champs additionnels sont stockÃ©s dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_additional_fields</span></code>.</p>
<p>Exemples de configuration :</p>
<p>Pour les champs de type Â«Â selectÂ Â», Â«Â multiselectÂ Â», Â«Â checkboxÂ Â» et Â«Â radioÂ Â», le champs Â«Â valeurÂ Â» doit Ãªtre rempli par un JSON reprÃ©sentant une liste de dictionnaire Â«Â labelÂ Â» (reprÃ©sentant la valeur affichÃ©), et Â«Â valeurÂ Â» (reprÃ©sentant la valeur Ã©crite en base de donnÃ©es).</p>
<p>Exemples :</p>
<ul class="simple">
<li><p><cite>[{Â«Â labelÂ Â»: Â«Â TroisÂ Â», Â«Â valueÂ Â»: 3}, {Â«Â labelÂ Â»: Â«Â QuatreÂ Â», Â«Â valueÂ Â»: 4}]</cite></p></li>
<li><p><cite>[{Â«Â labelÂ Â»: Â«Â 1Â Â», Â«Â valueÂ Â»: Â«Â Ãtude gÃ©nÃ©raleÂ Â»}, {Â«Â labelÂ Â»: Â«Â Gestion de siteÂ Â», Â«Â valueÂ Â»: Â«Â 2Â Â»}, {Â«Â labelÂ Â»: Â«Â PartenariatÂ Â», Â«Â valueÂ Â»: Â«Â 3Â Â»}]</cite></p></li>
<li><p>Un champs type Â«Â multiselectÂ Â»:</p></li>
</ul>
<img alt="_images/label_value_multiselect.png" src="_images/label_value_multiselect.png" />
<ul class="simple">
<li><p>Un champs type Â«Â htmlÂ Â». Câest un champs de type Â«Â prÃ©sentationÂ Â», aucune valeur ne sera enregistrÃ© en base de donnÃ©es pour ce champs :</p></li>
</ul>
<img alt="_images/html1.png" src="_images/html1.png" />
<ul class="simple">
<li><p>Un champs de type Â«Â datalistÂ Â». Ce champs permet de gÃ©nÃ©rer une liste de valeurs Ã  partir dâune API (non portÃ© sur Occtax-mobile). Dans le champ Â«Â attributs additionnelsÂ Â», renseignez les Ã©lÃ©ments suivants :</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;api&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;url_vers_la_ressource&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;keyValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;champ Ã  stocker en base&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;keyLabel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;champ Ã  afficher en interface&quot;</span><span class="p">}</span>
</pre></div>
</div>
<section id="configuration-avancee-des-champs">
<h4>Configuration avancÃ©e des champs<a class="headerlink" href="#configuration-avancee-des-champs" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Le champs Â«Â Attribut additionnelsÂ Â» permet dâajouter des Ã©lÃ©ments de configuration sur les formulaires sour forme de JSON:</p>
<ul class="simple">
<li><p>Ajouter une icone Â«Â ?Â Â» et un tooltip au survol du formulaire : <cite>{Â«Â descriptionÂ Â» : Â«Â mon toolitpÂ Â»}</cite></p></li>
<li><p>Ajouter un sous-titre descriptif : <cite>{Â«Â helpÂ Â» : Â«Â mon sous titreÂ Â»}</cite></p></li>
<li><p>Ajouter des valeurs min/max pour un input <cite>number</cite> : <cite>{Â«Â minÂ Â»: 1, Â«Â maxÂ Â»: 10}</cite></p></li>
</ul>
</section>
</section>
<section id="taxhub">
<h3>TaxHub<a class="headerlink" href="#taxhub" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Module de gestion des taxons (basÃ© sur TaxHub) permettant de faire des listes de taxons ainsi que dâajouter des attributs et des mÃ©dias aux taxons.
Voir la documentation de TaxHub : <a class="reference external" href="https://taxhub.readthedocs.io/fr/">https://taxhub.readthedocs.io/fr/</a></p>
</section>
</section>
<section id="module-occhab">
<h2>Module OCCHAB<a class="headerlink" href="#module-occhab" title="Lien vers cette rubrique">Â¶</a></h2>
<section id="id2">
<h3>Installer le module<a class="headerlink" href="#id2" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Le module OCCHAB fait partie du coeur de GeoNature. Son installation est au choix de lâadministrateur.</p>
<p>Pour lâinstaller, lancer les commandes suivantes :</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>backend
<span class="nb">source</span><span class="w"> </span>venv/bin/activate
geonature<span class="w"> </span>install_gn_module<span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/geonature/contrib/gn_module_occhab<span class="w"> </span>occtax
</pre></div>
</div>
</section>
<section id="id3">
<h3>Base de donnÃ©es<a class="headerlink" href="#id3" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Le module sâappuie sur deux schÃ©mas :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ref_habitats</span></code> correspond au rÃ©fÃ©rentiel habitat du SINP,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pr_occhab</span></code> correspond au schÃ©ma qui contient les donnÃ©es dâoccurrence dâhabitat, basÃ© sur standard du SINP.</p></li>
</ul>
</section>
<section id="id4">
<h3>Configuration<a class="headerlink" href="#id4" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Le paramÃ©trage du module OCCHAB se fait en crÃ©ant le fichier <code class="docutils literal notranslate"><span class="pre">config/occhab_config.toml</span></code>, en sâinspirant du fichier dâexemple <code class="docutils literal notranslate"><span class="pre">contrib/gn_module_occhab/occhab_config.toml.example</span></code>.</p>
<p>Reportez vous Ã  la section <a class="reference internal" href="#configuration-d-un-gn-module">Configuration dâun gn_module</a> pour effectuer les opÃ©rations supplÃ©mentaires nÃ©cessaires pour la prise en compte des modifications.</p>
<section id="formulaire">
<h4>Formulaire<a class="headerlink" href="#formulaire" title="Lien vers cette rubrique">Â¶</a></h4>
<ul class="simple">
<li><p>La liste des habitats fournie pour la saisie est basÃ©e sur une liste dÃ©finie dans la base de donnÃ©es (table <code class="docutils literal notranslate"><span class="pre">ref_habitat.cor_list_habitat</span></code> et <code class="docutils literal notranslate"><span class="pre">ref_habitat.bib_list_habitat</span></code>). Il est possible de modifier cette liste directement dnns la base de donnÃ©es, dâen crÃ©er une autre et de changer la liste utiliser par le module. Modifier alors ce paramÃ¨tre :</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ID_LIST_HABITAT</span> <span class="pre">=</span> <span class="pre">1</span></code></p>
<ul class="simple">
<li><p>Le formulaire permet de saisir des observateurs basÃ©s sur le rÃ©fÃ©rentiel utilisateurs (<code class="docutils literal notranslate"><span class="pre">false</span></code>) ou de les saisir en texte libre (<code class="docutils literal notranslate"><span class="pre">true</span></code>).</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">OBSERVER_AS_TXT</span> <span class="pre">=</span> <span class="pre">false</span></code></p>
<ul class="simple">
<li><p>Lâensemble des champs du formulaire son masquables. Pour en masquer certains, passer Ã  <code class="docutils literal notranslate"><span class="pre">false</span></code> les variables suivantes :</p></li>
</ul>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[formConfig]</span>
<span class="w">  </span><span class="n">date_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">date_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">depth_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">depth_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">altitude_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">altitude_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">exposure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">comment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">area_surface_calculation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">geographic_object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">determination_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">determiner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">collection_technique</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">technical_precision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">recovery_percentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">abundance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="n">community_interest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</pre></div>
</div>
<p>Voir le fichier <code class="docutils literal notranslate"><span class="pre">occhab_config.example</span></code> qui liste lâensemble des paramÃ¨tres de configuration du module.</p>
</section>
</section>
</section>
<section id="module-synthese">
<h2>Module SYNTHESE<a class="headerlink" href="#module-synthese" title="Lien vers cette rubrique">Â¶</a></h2>
<p>Le module SynthÃ¨se est un module du coeur de GeoNature, fourni par dÃ©faut lors de lâinstallation.</p>
<section id="id5">
<h3>Configuration<a class="headerlink" href="#id5" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Lâensemble des paramÃ¨tres de configuration du module se trouve dans le fichier gÃ©nÃ©ral de configuration de GeoNature <code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code> puisquâil sâagit dâun module du coeur.</p>
<p><strong>1.</strong> Modifier les filtres gÃ©ographiques disponibles par dÃ©faut dans lâinterface de recherche.</p>
<p>Editer la variable <code class="docutils literal notranslate"><span class="pre">AREA_FILTERS</span></code> en y ajoutant le label et le code du type dâentitÃ© gÃ©ographique que vous souhaitez rajouter. Voir table <code class="docutils literal notranslate"><span class="pre">ref_geo.bib_areas_types</span></code>. Dans lâexemple on ajoute le type ZNIEFF1 (<code class="docutils literal notranslate"><span class="pre">code_type</span> <span class="pre">=</span> <span class="pre">&quot;ZNIEFF1&quot;</span></code>). Attention, dans ce cas les entitÃ©s gÃ©ographiques correspondantes au type <cite>ZNIEFF1</cite>, doivent Ã©galement Ãªtre prÃ©sentes dans la table <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code>.
Attention : Si des donnÃ©es sont dÃ©jÃ  prÃ©sentes dans la synthÃ¨se et que lâon ajoute de nouvelles entitÃ©s gÃ©ographiques Ã  <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code>, il faut Ã©galement recalculer les valeurs de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code> qui assure la correspondance entre les donnÃ©es de la synthÃ¨se et les entitÃ©s gÃ©ographiques.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[SYNTHESE]</span>
<span class="w">    </span><span class="c1"># Liste des entitÃ©s gÃ©ographiques sur lesquels les filtres</span>
<span class="w">    </span><span class="c1"># gÃ©ographiques de la synthese s&#39;appuient (type_code = code du type de l&#39;entitÃ© gÃ©o, table ref_geo.bib_areas_types)</span>
<span class="w">    </span><span class="n">AREA_FILTERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Communes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type_code</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;COM&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;ZNIEFF1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type_code</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;ZNIEFF1&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>
</pre></div>
</div>
<p>Il est aussi possible de passer plusieurs <code class="docutils literal notranslate"><span class="pre">type_code</span></code> regroupÃ©s dans un mÃªme filtre gÃ©ographique (exemple : <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">label</span> <span class="pre">=</span> <span class="pre">&quot;Zonages</span> <span class="pre">rÃ©glementaires&quot;,</span> <span class="pre">type_code</span> <span class="pre">=</span> <span class="pre">[&quot;ZC&quot;,</span> <span class="pre">&quot;ZPS&quot;,</span> <span class="pre">&quot;SIC&quot;]</span> <span class="pre">}</span></code>).</p>
<p><strong>2.</strong> Configurer les champs des exports</p>
<p>Dans tous les exports, lâordre et le nom des colonnes sont basÃ©s sur la vue SQL servant lâexport.</p>
<p><strong>Export des observations</strong></p>
<p>Les exports (CSV, GeoJSON, Geopackage, Shapefile) sont basÃ©s sur la vue <code class="docutils literal notranslate"><span class="pre">gn_synthese.v_synthese_for_export</span></code>.</p>
<p>Il est possible de ne pas intÃ©grer certains champs prÃ©sents dans cette vue dâexport. Pour cela modifier le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">EXPORT_COLUMNS</span></code>.</p>
<p>Enlevez la ligne de la colonne que vous souhaitez dÃ©sactiver. Les noms de colonne de plus de 10 caractÃ¨res seront tronquÃ©s dans lâexport au format shapefile.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>LâentÃªte <code class="docutils literal notranslate"><span class="pre">[SYNTHESE]</span></code> au dessus <code class="docutils literal notranslate"><span class="pre">EXPORT_COLUMNS</span></code> indique simplement que cette variable appartient au bloc de configuration de la synthese. Ne pas rajouter lâentÃªte Ã  chaque paramÃ¨tre de la synthese mais une seule fois au dessus de toutes les variables de configuration du module.</p>
</div>
<p>Il est Ã©galement possible de personnaliser ses exports en crÃ©ant vos propres vues personnalisÃ©es et en remplissant le paramÃ¨tre suivant avec une ou plusieurs vues dâexport spÃ©cifiques :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[SYNTHESE]</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">EXPORT_OBSERVATIONS_CUSTOM_VIEWS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">          </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;format personnalisÃ©&quot;</span><span class="err">,</span>
<span class="w">          </span><span class="n">view_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gn_synthese.v_synthese_for_web_app&quot;</span><span class="err">,</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">  </span><span class="err">]</span>
</pre></div>
</div>
<p>Ces vues doivent obligatoirement avoir une colonne <cite>id_synthese</cite>, une colonne <cite>geojson_local</cite> reprÃ©sentant le geojson de la gÃ©ometrie en projection locale (pour la gÃ©nÃ©ration du shapefile et geopackage) et une colonne <cite>geojson_4326</cite> reprÃ©sentant le geojson de la gÃ©omÃ©trie en projection 4326 (pour la gÃ©nÃ©ration du geojson) (utilisez la fonction <cite>st_asgeojson</cite> - voir la vue par dÃ©faut <cite>gn_synthese.v_synthese_for_export</cite>).</p>
<p>Selon les permissions de lâutilisation sur lâaction Â«Â ExportÂ Â» du module SynthÃ¨se, le floutage pourra sâappliquer automatiquement Ã  la vue dâexport sur les mÃªmes champs gÃ©omÃ©triques que la vue <cite>gn_synthese.v_synthese_for_export</cite>, Ã  savoir <cite>geometrie_wkt_4326</cite>, <cite>x_centroid_4326</cite>, <cite>y_centroid_4326</cite>, <cite>geojson_local</cite> et <cite>geojson_4326</cite>. Si vous ajoutez des champs reprÃ©sentant la gÃ©omÃ©trie de lâobservation portant des noms diffÃ©rents que les 4 noms prÃ©citÃ©s, ceux-ci ne pourront pas Ãªtre floutÃ©s.</p>
<p><strong>Export des mÃ©tadonnÃ©es</strong></p>
<p>En plus des observations brutes, il est possible dâeffectuer un export des mÃ©tadonnÃ©es associÃ©es aux observations. Lâexport est au format CSV et est construit Ã  partir de la vue <code class="docutils literal notranslate"><span class="pre">gn_synthese.v_metadata_for_export</span></code>.</p>
<p>Deux champs sont cependant obligatoires dans cette vue :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jdd_id</span></code> (qui correspond Ã  lâid du JDD de la table <code class="docutils literal notranslate"><span class="pre">gn_meta.t_datasets</span></code>). Le nom de ce champs est modifiable. Si vous le modifiez, Ã©ditez la variable <code class="docutils literal notranslate"><span class="pre">EXPORT_METADATA_ID_DATASET_COL</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">acteurs</span></code>:  Le nom de ce champs est modifiable. Si vous le modifiez, Ã©ditez la variable <code class="docutils literal notranslate"><span class="pre">EXPORT_METADATA_ACTOR_COL</span></code></p></li>
</ul>
<p><strong>Export des statuts taxonomiques (rÃ©glementations)</strong></p>
<p>Cet export nâest pas basÃ© sur une vue.</p>
<p><strong>3.</strong> Configurer les seuils du nombre de donnÃ©es pour la recherche et les exports</p>
<p>Par dÃ©faut et pour des questions de performance (du navigateur et du serveur) on limite Ã  50000 le nombre de rÃ©sultats affichÃ©s sur la carte et le nombre dâobservations dans les exports.</p>
<p>Ces seuils sont modifiables respectivement par les variables <code class="docutils literal notranslate"><span class="pre">NB_MAX_OBS_MAP</span></code> et <code class="docutils literal notranslate"><span class="pre">NB_MAX_OBS_EXPORT</span></code> :</p>
<p>Le mode cluster activÃ© par dÃ©faut peut Ãªtre dÃ©sactivÃ© via le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">ENABLE_LEAFLET_CLUSTER</span></code>. Dans ce cas, il est conseillÃ© de repasser le paramÃ¨tre <cite>NB_MAX_OBS_MAP</cite> Ã  10000.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[SYNTHESE]</span>
<span class="w">    </span><span class="c1"># Nombre d&#39;observation maximum Ã  afficher sur la carte aprÃ¨s une recherche</span>
<span class="w">    </span><span class="n">NB_MAX_OBS_MAP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span>
<span class="w">    </span><span class="c1"># Nombre max d&#39;observation dans les exports</span>
<span class="w">    </span><span class="n">NB_MAX_OBS_EXPORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40000</span>
</pre></div>
</div>
<p><strong>4.</strong> DÃ©sactiver des filtres gÃ©nÃ©riques</p>
<p>Lâinterface de recherche de la synthÃ¨se permet de filtrer sur lâensemble des nomenclatures de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese</span></code>, il est cependant possible de dÃ©sactiver les filtres de certains champs.</p>
<p>Modifiez la variable <code class="docutils literal notranslate"><span class="pre">EXCLUDED_COLUMNS</span></code></p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[SYNTHESE]</span>
<span class="w">    </span><span class="n">EXCLUDED_COLUMNS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;non_digital_proof&#39;</span><span class="p">]</span><span class="w"> </span><span class="c1">#Â pour enlever le filtre &#39;preuve non numÃ©rique&#39;</span>
</pre></div>
</div>
<p><strong>5.</strong> Configurer les filtres des statuts de protection et des listes rouges</p>
<p>Il existe deux paramÃ¨tres qui permettent de configurer les statuts de protection et les listes rouges Ã  afficher dans la fenÃªtre avancÃ©e du module Synthese.</p>
<p>Il sâagit de :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RED_LISTS_FILTERS</span></code> : pour configurer les listes rouges. Les listes dÃ©roulantes configurÃ©es affichent les codes et intitulÃ©s des valeurs des listes (<em>CR - En danger critique</em>, <em>DD - DonnÃ©es insuffisantes</em>, â¦).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STATUS_FILTERS</span></code> : pour configurer les statuts de protection. Les listes dÃ©roulantes configurÃ©es affichent lâintitulÃ© suivi du code des types de textes (<em>Protection dÃ©partementale - PD</em>, <em>Protection nationale - PN</em>).</p></li>
</ul>
<p>Ces paramÃ¨tres se prÃ©sentent sous la forme dâune liste de dictionnaires. Il est possible dâajouter de nouveaux filtres en ajoutant de nouveaux dictionnaires Ã  la liste.</p>
<p>Voici un exemple :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[SYNTHESE]</span>
<span class="w">    </span><span class="n">RED_LISTS_FILTERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;worldwide&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;show&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;display_name&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Liste rouge mondiale&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status_type&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;LRM&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;european&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;show&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;display_name&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Liste rouge europÃ©enne&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status_type&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;LRE&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;national&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;show&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;display_name&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Liste rouge nationale&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status_type&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;LRN&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;regional&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;show&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;display_name&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Liste rouge rÃ©gionale&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status_type&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;LRR&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="n">STATUS_FILTERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;protections&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;show&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;display_name&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Taxons protÃ©gÃ©s&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status_types&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;PN&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PR&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PD&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;regulations&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;show&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;display_name&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Taxons rÃ©glementÃ©s&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status_types&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;REGLII&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;REGL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;REGLSO&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;invasive&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;show&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;display_name&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;EspÃ¨ces envahissantes&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status_types&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;REGLLUTTE&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;znief&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;show&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;display_name&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;EspÃ¨ces dÃ©terminantes ZNIEFF&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status_types&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ZDET&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">]</span>
</pre></div>
</div>
<p>Pour chaque dictionnaire, voici le dÃ©tail des champs (ils sont tous obligatoires) :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> : correspond Ã  un mot clÃ© (sans caractÃ¨res spÃ©ciaux ou accentuÃ©s) qui doit Ãªtre unique dans la liste.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code> : permet de rapidement afficher (= <code class="docutils literal notranslate"><span class="pre">true</span></code>) ou cacher (= <code class="docutils literal notranslate"><span class="pre">false</span></code>) un filtre sur lâinterface sans avoir Ã  supprimer la ligne.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">display_name</span></code> : indique le texte de lâintitulÃ© de la liste dÃ©roulante qui sera affichÃ© sur lâinterface.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">status_type</span></code> : pour les statuts de protection cela correspond Ã  une liste des codes de types de statuts de protections Ã  afficher dans la liste dÃ©roulante. Les codes existant sont consultables dans le champ <code class="docutils literal notranslate"><span class="pre">cd_type_statut</span></code> de la table <code class="docutils literal notranslate"><span class="pre">taxonomie.bdc_statut_type</span></code>. Pour les listes rouges, il faut seulement indiquer le code de la liste.</p></li>
</ul>
<p>Au niveau de la base de donnÃ©es, il est possible de limiter les recherches uniquement aux textes correspondant Ã  la zone gÃ©ographique des observations de votre installation.
Pour cela, il suffit de mettre une valeur <code class="docutils literal notranslate"><span class="pre">false</span></code> dans le champ <code class="docutils literal notranslate"><span class="pre">enable</span></code> de la table <code class="docutils literal notranslate"><span class="pre">taxonomie.bdc_statut_text</span></code> pour tous les textes que vous ne souhaitez pas prendre en compte. Si vous avez une grande quantitÃ© dâobservations, cette Ã©tape est fortement recommandÃ©e !</p>
<p>Exemple de requÃªte de mise Ã  jour de la table <code class="docutils literal notranslate"><span class="pre">taxonomie.bdc_statut_text</span></code> pour dÃ©sactiver les textes des DOM-TOM :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">taxonomie</span><span class="p">.</span><span class="n">bdc_statut_text</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">cd_sig</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;TER971&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TER972&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TER973&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TER971&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TER974&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Une commande dans TaxHub permet de dÃ©sactiver automatiquement les textes en dehors dâune liste de dÃ©partements (en passant leur <code class="docutils literal notranslate"><span class="pre">area_code</span></code>) :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>~/geonature/backend/venv/bin/activate
geonature<span class="w"> </span>taxref<span class="w"> </span>enable-bdc-statut-text<span class="w"> </span>-d<span class="w"> </span>&lt;MON_DEP_1&gt;<span class="w"> </span>-d<span class="w"> </span>&lt;MON_DEP_2&gt;<span class="w"> </span>--clean
</pre></div>
</div>
<p><strong>6.</strong> DÃ©finir des filtres par dÃ©faut</p>
<p>Il sâagit du paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">DEFAULT_FILTERS</span></code>.
Câest un dictionnaire qui liste la valeur des champs par dÃ©faut.
Il faut fournir le code des nomenclature par dÃ©faut (liste de chaÃ®ne de caractÃ¨re).
(On prend les champs en <code class="docutils literal notranslate"><span class="pre">id_nomenclature_...</span></code> et on remplace <code class="docutils literal notranslate"><span class="pre">id_nomenclature_</span></code> par <code class="docutils literal notranslate"><span class="pre">cd_nomenclature_</span></code>)</p>
<p>Exemple de filtres par dÃ©faut :</p>
<p>Dâautres Ã©lements sont paramÃ¨trables dans le module Synthese. La liste complÃ¨te est disponible dans le fichier <code class="docutils literal notranslate"><span class="pre">config/default_config.toml.example</span></code> rubrique <code class="docutils literal notranslate"><span class="pre">SYNTHESE</span></code>.</p>
</section>
</section>
<section id="module-validation">
<h2>Module VALIDATION<a class="headerlink" href="#module-validation" title="Lien vers cette rubrique">Â¶</a></h2>
<p>Le module VALIDATION, integrÃ© depuis la version 2.1.0 dans le coeur de GeoNature (mais optionnel) permet de valider des occurrences de taxon en sâappuyant sur les donnÃ©es prÃ©sentes dans la SYNTHESE. Le module sâappuie sur le standard Validation du SINP et sur ses <a class="reference external" href="https://inpn.mnhn.fr/programme/donnees-observations-especes/references/validation">nomenclatures officielles</a>.</p>
<p>Afin de valider une occurrence de taxons, celle-ci doit impÃ©rativement avoir un UUID. En effet, la validation est stockÃ©e en BDD dans la table transversale <code class="docutils literal notranslate"><span class="pre">gn_commons.t_validations</span></code>  (<a class="reference external" href="admin-manual.html#tables-transversales">voir doc</a> ) qui impose la prÃ©sence de cet UUID.</p>
<p>La table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_validations</span></code> contient lâensemble de lâhistorique de validation des occurrences de taxons. Pour une mÃªme occurrence (identifiÃ©e par un UUID unique) on peut donc retrouver plusieurs lignes dans la table correspondant aux diffÃ©rents statuts de validation attribuÃ©s Ã  cette occurrence dans le temps.</p>
<p>La vue <code class="docutils literal notranslate"><span class="pre">gn_commons.v_latest_validation</span></code> permet de rÃ©cupÃ©rer le dernier statut de validation dâune occurrence.</p>
<p>NB : une donnÃ©e non prÃ©sente dans la SYNTHESE, ne remontera pas dans lâinterface du module VALIDATION. Cependant rien nâempÃªche un administrateur avancÃ© dâutiliser la table de validation et son mÃ©canisme pour des donnÃ©es qui ne seraient pas en SYNTHESE (du moment que les donnÃ©es disposent dâun UUID).</p>
<p>Au niveau de lâinterface, le formulaire de recherche est commun avec le module SYNTHESE. Les paramÃ¨tres de configuration du formulaire sont donc Ã©galement partagÃ©s et administrables depuis le fichier <code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>, rubrique SYNTHESE.</p>
<section id="id6">
<h3>Configuration<a class="headerlink" href="#id6" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Le paramÃ©trage du module VALIDATION se fait en crÃ©ant le fichier <code class="docutils literal notranslate"><span class="pre">config/validation_config.toml</span></code>, en sâinspirant du fichier dâexemple <code class="docutils literal notranslate"><span class="pre">contrib/gn_module_validation/validation_config.toml.example</span></code>
Reportez vous Ã  la section <a class="reference internal" href="#configuration-d-un-gn-module">Configuration dâun gn_module</a> pour effectuer les opÃ©rations supplÃ©mentaires nÃ©cessaires pour la prise en compte des modifications.</p>
<section id="liste-des-champs-visibles">
<h4>Liste des champs visibles<a class="headerlink" href="#liste-des-champs-visibles" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Gestion de lâaffichage des colonnes de la liste via le paramÃ¨tre <code class="docutils literal notranslate"><span class="pre">COLUMN_LIST</span></code> :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[COLUMN_LIST]]</span>
<span class="n">column_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nomenclature_life_stage.label_default&quot;</span><span class="w"> </span><span class="c1"># Champs de la synthÃ¨se, Ã©ventuellement en suivant des relationships</span>
<span class="n">column_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Stade de vie&quot;</span><span class="w"> </span><span class="c1"># Titre de la colonne</span>
<span class="n">min_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="c1"># Taille minimale de la colonne</span>
<span class="n">max_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="c1"># Taille maximale de la colonne</span>
</pre></div>
</div>
</section>
<section id="e-mail">
<h4>E-mail<a class="headerlink" href="#e-mail" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Il est possible de personnaliser le message de lâemail envoyÃ© aux observateurs dâune observation quand on clique sur le bouton dÃ©diÃ© Ã  cela depuis la fiche dÃ©tail dâune observation.
Pour ce faire il faut modifier les  paramÃ¨tres <code class="docutils literal notranslate"><span class="pre">MAIL_BODY</span></code> et <code class="docutils literal notranslate"><span class="pre">MAIL_SUBJECT</span></code></p>
<p>Pour afficher dans lâemail des donnÃ©es relatives Ã  lâobservation ou au taxon il faut respecter la syntaxe suivante :
<code class="docutils literal notranslate"><span class="pre">${</span> <span class="pre">d.NOM_PROPRIETE</span> <span class="pre">}</span></code></p>
<p>Liste des propriÃ©tÃ©s disponibles :</p>
<ul class="simple">
<li><p>communes : liste des communes</p></li>
<li><p>medias : Titre, auteur et lien vers le mÃ©dia associÃ©e</p></li>
<li><p>data_link : lien vers lâobservation dans son module de saisie</p></li>
<li><p>tous les champs de la synthÃ¨se (acquisition_framework, altitude_max, altitude_min, bio_status, blurring, cd_hab, cd_nom, comment_context, comment_description, date_min, depth_max, depth_min, determiner, diffusion_level, digital_proof, entity_source_pk_value, exist_proof, grp_method, grp_typ, last_action, life_stage, meta_create_date, meta_update_date, meta_v_taxref, meta_validation_date, nat_obj_geo, naturalness, nom_cite, non_digital_proof, obj_count, obs_technique, observation_status, observers, occ_behaviour, occ_stat_biogeo, place_name, precision, sample_number_proof, sensitivity, sex, source, type_count, unique_id_sinp, unique_id_sinp_grp, valid_status, validation_comment)</p></li>
<li><p>tous les champs du taxon (cd_nom, cd_ref, cd_sup, cd_taxsup, regne, ordre, classe, famille, group1_inpn, group2_inpn, id_rang, nom_complet, nom_habitat, nom_rang, nom_statut, nom_valide, nom_vern)</p></li>
</ul>
<p>Il est aussi possible de modifier la structure du message de notification envoyÃ© automatiquement Ã  un observateur quand une de ses observations voit son statut de validation modifiÃ©, dans la table <cite>gn_notifications.bib_notifications_templates</cite>.</p>
</section>
</section>
<section id="validation-automatique">
<h3>Validation automatique<a class="headerlink" href="#validation-automatique" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Depuis la version 2.14, il est possible dâactiver la validation automatique dâobservations.</p>
<section id="activation">
<h4>Activation<a class="headerlink" href="#activation" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Lâactivation de la validation automatique sâeffectue en ajoutant la ligne suivante dans le fichier de configuration du module de validation <code class="docutils literal notranslate"><span class="pre">config/validation_config.toml</span></code> :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="n">AUTO_VALIDATION_ENABLED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</pre></div>
</div>
</section>
<section id="conditions-de-validation-automatique">
<h4>Conditions de validation automatique<a class="headerlink" href="#conditions-de-validation-automatique" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Une observation sera validÃ©e automatiquement si elle rencontre les conditions suivantes :</p>
<ul class="simple">
<li><p>Son statut de validation est <code class="docutils literal notranslate"><span class="pre">En</span> <span class="pre">attente</span> <span class="pre">de</span> <span class="pre">validation</span></code></p></li>
<li><p>Si le score calculÃ© Ã  partir du profil de taxons est de 3. Se rÃ©fÃ©rer Ã  la section <a class="reference internal" href="#profils-de-taxons">Profils de taxons</a> pour plus dâinformations.</p></li>
</ul>
<p>Si ces conditions sont remplies, alors le statut de validation de lâobservation est mis Ã  <code class="docutils literal notranslate"><span class="pre">Probable</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si le comportement de validation automatique ne vous correspond pas, il est possible de dÃ©finir soi-mÃªme ce dernier dans la base de donnÃ©es sous forme dâune fonction. Reportez-vous Ã  la section <a class="reference internal" href="#modification-de-la-fonction-de-validation-automatique">Modification de la fonction de validation automatique</a> pour plus dâinformations.</p>
</div>
</section>
<section id="modification-de-la-periodicite-de-la-validation-automatique">
<h4>Modification de la pÃ©riodicitÃ© de la validation automatique<a class="headerlink" href="#modification-de-la-periodicite-de-la-validation-automatique" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Le processus de validation automatique est exÃ©cutÃ© Ã  une frÃ©quence dÃ©finie, par dÃ©faut toutes les heures. Si toutefois, vous souhaitez diminuer ou augmenter la durÃ©e entre chaque validation automatique, dÃ©finissez cette derniÃ¨re dans le fichier de configuration (<code class="docutils literal notranslate"><span class="pre">config/validation_config.toml</span></code>) dans la variable <code class="docutils literal notranslate"><span class="pre">AUTO_VALIDATION_CRONTAB</span></code>.</p>
<p>Ce paramÃ¨tre est composÃ© de cinq valeurs, chacune sÃ©parÃ©e par un espace: minute, heure, jour du mois, mois de lâannÃ©e, journÃ©e de la semaine. Dans lâexemple ci-dessus, il est indiquÃ© que le processus dâauto-validation sera rÃ©pÃ©tÃ© toutes les minutes. Pour plus dâinformations, vous pouvez consulter la documentation de Celery Ã  ce sujet : <a class="reference external" href="https://docs.celeryq.dev/en/stable/userguide/periodic-tasks.html#crontab-schedules">https://docs.celeryq.dev/en/stable/userguide/periodic-tasks.html#crontab-schedules</a>.</p>
<p><strong>Note</strong> Si vous ne voulez pas dÃ©finir un des paramÃ¨tres de pÃ©riodicitÃ©, utilisez un astÃ©risque (<code class="docutils literal notranslate"><span class="pre">*</span></code>).</p>
</section>
<section id="modification-de-la-fonction-de-validation-automatique">
<h4>Modification de la fonction de validation automatique<a class="headerlink" href="#modification-de-la-fonction-de-validation-automatique" title="Lien vers cette rubrique">Â¶</a></h4>
<p>Dans GeoNature, la validation automatique est effectuÃ©e par une fonction en <code class="docutils literal notranslate"><span class="pre">PL/pgSQL</span></code> dÃ©clarÃ©e dans le schÃ©ma <code class="docutils literal notranslate"><span class="pre">gn_profiles</span></code>. Si toutefois, le fonctionnement de celle-ci ne correspond pas Ã  vos besoins, indiquez le nom de la nouvelle fonction dans la variable <code class="docutils literal notranslate"><span class="pre">AUTO_VALIDATION_SQL_FUNCTION</span></code>. Attention, cette fonction doit aussi Ãªtre stockÃ©e dans le schema <code class="docutils literal notranslate"><span class="pre">gn_profiles</span></code>. Pour vous aider, nâhÃ©sitez pas Ã  regarder la dÃ©finition de la fonction par dÃ©faut nommÃ©e <code class="docutils literal notranslate"><span class="pre">fct_auto_validation</span></code>.</p>
</section>
</section>
</section>
<section id="module-taxhub">
<h2>Module TaxHub<a class="headerlink" href="#module-taxhub" title="Lien vers cette rubrique">Â¶</a></h2>
<p>Depuis la version 2.15 de GeoNature, TaxHub est integrÃ© comme un module de GeoNature. Il est disponible depuis le module Â«Â AdminÂ Â» de GeoNature.</p>
<p>Lâemplacement de stockage des mÃ©dias est contrÃ´lÃ© par le paramÃ¨tre <cite>MEDIA_FOLDER</cite>. Les mÃ©dias de TaxHub seront Ã  lâemplacement <cite>&lt;MEDIA_FOLDER&gt;/taxhub</cite>. Par dÃ©faut tous les mÃ©dias de GeoNature sont stockÃ©s dans le rÃ©pertoire de GeoNature : <cite>&lt;GEONATURE_DIR&gt;/backend/media</cite>. Via ce paramÃ¨tre, il est possible de mettre un chemin absolu pour stocker les mÃ©dias nâimporte oÃ¹ ailleurs sur votre serveur.</p>
<section id="gestion-des-permissions">
<h3>Gestion des permissions<a class="headerlink" href="#gestion-des-permissions" title="Lien vers cette rubrique">Â¶</a></h3>
<p>La gestion des permissions du module TaxHub est entierement gÃ©rÃ©e par le module de gestion de permissions de GeoNature. Dans le cas dâune installation standalone de TaxHub, se rÃ©ferer Ã  la documentation de TaxHub pour la gestion des permissions.</p>
<p>Les permissions du module TaxHub peuvent Ãªtre reglÃ©es aux trois niveaux (objets) suivants :</p>
<ul class="simple">
<li><p>TAXONS : permet voir et modifier des taxons (ajout de mÃ©dias, dâattributs et association de taxons Ã  des listes)</p></li>
<li><p>THEMES : permet de voir / crÃ©er / modifier / supprimer des thÃ¨mes. Les thÃ¨mes sont des groupes dâattributs</p></li>
<li><p>LISTES : permet de voir / crÃ©er / modifier / supprimer des listes de taxons</p></li>
<li><p>ATTRIBUTS : permet de voir / crÃ©er / modifier / supprimer des attributs de taxons</p></li>
</ul>
</section>
<section id="commandes-taxhub">
<h3>Commandes TaxHub<a class="headerlink" href="#commandes-taxhub" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Depuis la version 2.15, les commandes de TaxHub sont maintenant acessibles depuis la commande <cite>geonature</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geonature</span> <span class="n">taxref</span> <span class="n">info</span> <span class="c1"># avant flask taxref info</span>
<span class="n">geonature</span> <span class="n">taxref</span> <span class="n">enable</span><span class="o">-</span><span class="n">bdc</span><span class="o">-</span><span class="n">statut</span><span class="o">-</span><span class="n">text</span> <span class="c1"># avant flask taxref enable-bdc-statut-text</span>
<span class="n">geonature</span> <span class="n">taxref</span> <span class="n">migrate</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">v17</span> <span class="c1"># flask taxref migrate-to-v17</span>
</pre></div>
</div>
</section>
</section>
<section id="module-import">
<h2>Module Import<a class="headerlink" href="#module-import" title="Lien vers cette rubrique">Â¶</a></h2>
<p>Ce module permet dâimporter des donnÃ©es depuis un fichier CSV dans GeoNature.</p>
<section id="concepts">
<h3>Concepts<a class="headerlink" href="#concepts" title="Lien vers cette rubrique">Â¶</a></h3>
<p><strong>Destination.</strong> Une destination est dÃ©terminÃ©e par le module dans lequel on souhaite importer des donnÃ©es (e.g. Occhab, SynthÃ¨se, etc.).</p>
<p><strong>EntitÃ©s.</strong> Une entitÃ© correspond Ã  un objet dans une destination (e.g. <em>station</em> est une entitÃ© de la destination <em>Occhab</em>)</p>
</section>
<section id="faire-un-import-le-minimum-requis">
<h3>Faire un import, le minimum requis<a class="headerlink" href="#faire-un-import-le-minimum-requis" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Pour quâun utilisateur puisse mener au bout un import, il doit possÃ©der Ã  minima les permissions suivantes :</p>
<ul class="simple">
<li><p>CrÃ©ation dâun import (C)</p></li>
<li><p>Voir les imports (R)</p></li>
<li><p>Voir des mappings (R)</p></li>
<li><p>Droit de crÃ©er/saisir dans le module de destination (C dans OccHab par ex.)</p></li>
<li><p>Voir les mÃ©ta-donnÃ©es (R)</p></li>
</ul>
<p><strong>Jeu de donnÃ©es.</strong> Un import sâeffectue dans un jeu de donnÃ©es, par consÃ©quent, ce dernier doit :</p>
<ul class="simple">
<li><p>Ãªtre associÃ© aux modules de destination de lâimport (Voir champ dans lâÃ©dition/crÃ©ation dâun JDDÂ : Module(s) GeoNature associÃ©(s) au jeu de donnÃ©es)</p></li>
<li><p>Ãªtre actif.</p></li>
</ul>
</section>
<section id="deroulement-dun-import">
<h3>DÃ©roulement dâun import<a class="headerlink" href="#deroulement-dun-import" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Dans le module dâimport, trois actions sont possiblesÂ : la crÃ©ation dâun import, la modification de ce dernier et la suppression dâun import.
Lors du lancement de la crÃ©ation dâun import, il faut sÃ©lectionner la destination. Une fois la destination choisie, la phase de prÃ©paration de lâimport se dÃ©roule de la maniÃ¨re suivanteÂ :</p>
<ol class="arabic simple">
<li><p>TÃ©lÃ©verser le fichier contenant les donnÃ©es et sÃ©lection du jeu de donnÃ©es. Le format de fichier acceptÃ© est le CSV.</p></li>
<li><p>DÃ©finir les paramÃ¨tres de lecture du fichier tÃ©lÃ©versÃ©. Les donnÃ©es du fichier source sont stockÃ©es en binaire dans la table des imports (<code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports.source_file</span></code>).</p></li>
<li><p>Faire correspondre les colonnes de votre fichier avec les champs du modÃ¨le de donnÃ©es dÃ©fini dans le module de destination. Pour aider lâutilisateur dans le remplissage du formulaire, il est possible de sauvegarder et rÃ©utiliser des  _mappings_. Plusieurs mappings sont disponibles avec lâinstallation de GeoNature. Ces mappings permettent notamment de faire la correspondance des  colonnes dâun fichier produit par un export GeoNature (Occhab et SynthÃ¨se). Les correspondances de champs sont stockÃ©es dans un champs JSON dans <code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports.fieldmapping</span></code>.</p></li>
<li><p>Si des champs correspondant Ã  des types de nomenclatures sont indiquÃ©s dans lâÃ©tape 3, une mise en correspondance des valeurs du fichier source avec les nomenclatures dans la base doit Ãªtre faite. Si le fichier source comprend des lignes vides, on propose en plus de mapper le cas Â«Â Pas de valeurÂ Â». Tout comme la correspondance des champs, la correspondance des valeurs de nomenclature est sauvegardÃ©e dans un champs JSONB <code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports.valuemapping</span></code>.</p></li>
<li><p>ContrÃ´les des donnÃ©es du fichier source sÃ©lectionnÃ©es (<a class="reference internal" href="admin/import-admin.html#controle-donnees"><span class="std std-ref">c.f. ContrÃ´les de donnÃ©es</span></a>:).</p></li>
</ol>
<p>Une fois, cette phase de prÃ©paration terminÃ©e, lâutilisateur se voit prÃ©senter les donnÃ©es jugÃ©es comme valides (resp. les donnÃ©es invalides). A cette Ã©tape, lâutilisateur a la choix de modifier les donnÃ©es invalides dans son fichier source et recommencer le processus de prÃ©paration de lâimport OU lancer lâimport des donnÃ©es dans la destination.
Une fois lâimport de donnÃ©es terminÃ©, lâutilisateur est redirigÃ© vers un rapport rÃ©capitulant les paramÃ¨tres de lâimport et un affichage de quelques statistiques spÃ©cifiques au type de donnÃ©es importÃ©es.
Une fois les donnÃ©es importÃ©es, les donnÃ©es sont supprimÃ©es de la table temporaire (<code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports_synthese</span></code> pour la SynthÃ¨se, <code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports_occhab</span></code> pour Occhab).</p>
<img alt="_images/import_etapes.png" src="_images/import_etapes.png" />
</section>
<section id="configuration-du-module-dimport">
<h3>Configuration du module dâimport<a class="headerlink" href="#configuration-du-module-dimport" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Vous pouvez surcoucher ces diffÃ©rents paramÃ¨tres en les ajoutant directement dans le fichier de configuration principal de GeoNature (<code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>).</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ENCODAGE</p></td>
<td><p>Liste des encodages</p></td>
</tr>
<tr class="row-odd"><td><p>acceptÃ©s</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>MAX_FILE_SIZE</p></td>
<td><p>Taille maximale du fichier chargÃ© (en Mo)</p></td>
</tr>
<tr class="row-odd"><td><p>SRID</p></td>
<td><p>SRID autorisÃ©s pour les fichiers en entrÃ©e</p></td>
</tr>
<tr class="row-even"><td><p>ALLOWED_EXTENSIONS</p></td>
<td><p>Extensions autorisÃ©es (seul le format CSV est acceptÃ© actuellement)</p></td>
</tr>
<tr class="row-odd"><td><p>ALLOW_VALUE_MAPPING</p></td>
<td><p>Activer ou non lâÃ©tape du mapping des valeurs</p></td>
</tr>
<tr class="row-even"><td><p>DEFAULT_VALUE_MAPPING_ID</p></td>
<td><p>Si le mapping des valeurs est dÃ©sactivÃ©, specifier lâidentifiant du mapping qui doit Ãªtre utilisÃ©</p></td>
</tr>
<tr class="row-odd"><td><p>FILL_MISSING_NOMENCLATURE_WITH_DEFAULT_VALUE</p></td>
<td><p>Rempli les valeurs de nomenclature erronÃ©es par la valeur par dÃ©faut</p></td>
</tr>
<tr class="row-even"><td><p>CHECK_PRIVATE_JDD_BLURING</p></td>
<td><p>Active la vÃ©rification de lâexistence du champs Â«Â floutageÂ Â» si le JDD est privÃ©</p></td>
</tr>
<tr class="row-odd"><td><p>CHECK_REF_BIBLIO_LITTERATURE</p></td>
<td><p>Active la vÃ©rification de la rÃ©fÃ©rence bibliographique fournie si la valeur du champs source = Â«Â litteratureÂ Â»</p></td>
</tr>
<tr class="row-even"><td><p>CHECK_EXIST_PROOF</p></td>
<td><p>Active la vÃ©rification quâune preuve dâexistence est fournie si preuve existence = Â«Â ouiÂ Â»</p></td>
</tr>
<tr class="row-odd"><td><p>EXPORT_REPORT_PDF_FILENAME</p></td>
<td><p>Customiser le nom du fichier de rapport de lâimport</p></td>
</tr>
<tr class="row-even"><td><p>DEFAULT_RANK</p></td>
<td><p>ParamÃ¨tre pour dÃ©finir le rang utilisÃ© pour le diagramme camembert du rapport dâimport.</p></td>
</tr>
<tr class="row-odd"><td><p>DEFAULT_GENERATE_MISSING_UUID</p></td>
<td><p>LâUUID dâune entitÃ© importÃ©e sera gÃ©nÃ©rÃ© sâil nâest pas indiquÃ© dans le fichier source</p></td>
</tr>
<tr class="row-even"><td><p>ID_AREA_RESTRICTION</p></td>
<td><p>Identifiant dâune gÃ©omÃ©trie prÃ©sente dans RefGeo. Si diffÃ©rent de -1, vÃ©rifie si les gÃ©omÃ©tries des entitÃ©s importÃ©es sont bien dans lâemprise spatiale de cette derniÃ¨re.</p></td>
</tr>
<tr class="row-odd"><td><p>ID_LIST_TAXA_RESTRICTION</p></td>
<td><p>Identifiant dâune liste de taxons permettant de restreindre lâimport dâobservations dont les taxons appartiennent Ã  cette derniÃ¨re</p></td>
</tr>
<tr class="row-even"><td><p>MODULE_URL</p></td>
<td><p>URL dâaccÃ¨s au module dâimport</p></td>
</tr>
<tr class="row-odd"><td><p>DATAFRAME_BATCH_SIZE</p></td>
<td><p>Taille des <cite>batch</cite> de donnÃ©es importÃ©es en mÃªme temps</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="permissions-de-limport">
<h3>Permissions de lâimport<a class="headerlink" href="#permissions-de-limport" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Dans le module Import, il existe le jeu de permissions suivantÂ :</p>
<ul class="simple">
<li><p>CrÃ©ation dâun import â C</p></li>
<li><p>Voir les imports â R</p></li>
<li><p>Modifier des imports â U (nÃ©cessaire dâavoir le C)</p></li>
<li><p>Supprimer des imports â D</p></li>
<li><p>CrÃ©er des mappings - C</p></li>
<li><p>Voir des mappings - R</p></li>
<li><p>Modifier des mappings - U</p></li>
<li><p>Supprimer des mappings - D</p></li>
</ul>
<p><strong>Scope.</strong> Similaire Ã  dâautres permissions dans GeoNature, il est possible de limiter lâaccÃ¨s Ã  lâutilisateur sur les donnÃ©es sur lesquelles il peut agir. Lâ ajout de scope sur une permission de lâimport limite  la visibilitÃ© des imports dans lâinterface Â«Â Liste des ImportsÂ Â» ainsi que la possibilitÃ© (resp. impossbilitÃ©) de modifier ou supprimer un import. Par exemple,  un R2 sur Â«Â IMPORTÂ Â» permet uniquement de voir les imports effectuÃ©s par soi-mÃªme ou un utilisateur de son organisme.
A noter! La liste des jeux de donnÃ©es disponibles sâappuie bien sur les permissions de lâutilisateur dans ce dernierÂ !</p>
<p><strong>Mapping.</strong> Certains mappings sont dÃ©finis comme Â«Â publicÂ Â» et sont accessibles Ã  tout le monde. Seuls les administrateurs (U=3) et les propriÃ©taires de ces mappings peuvent les modifier. Si vous modifiez un mapping sur lequel vous nâavez pas les droits, il vous sera proposÃ© de crÃ©er un nouveau mapping vous appartenant avec les modifications que vous avez faites, mais sans modifier le mapping initial.</p>
<p><strong>Jeu de donnÃ©es accessibles Ã  lâimport.</strong> Les jeux de donnÃ©es selectionnables par un utilisateur lors de la crÃ©ation dâun import sont eux controlÃ©s par les permissions sur le C de lâobjet Â«Â importÂ Â» (combinÃ© au R du module Â«Â MÃ©tadonnÃ©es). Les mappings constituent un Â«Â objetÂ Â» du module dâimport disposant de droits paramÃ©trables pour les diffÃ©rents utilisateurs, indÃ©pendamment des permissions sur les imports. Le rÃ©glage des permissions se fait dans le module Â«Â AdminÂ Â» de GeoNature (Â«Â AdminÂ Â» -&gt; Â«Â PermissionsÂ Â»).</p>
</section>
<section id="modification-et-suppression-d-un-import">
<h3>Modification et Suppression dâun import<a class="headerlink" href="#modification-et-suppression-d-un-import" title="Lien vers cette rubrique">Â¶</a></h3>
<p><strong>Comment sait-on quâun import est terminÃ© ?</strong> Si une date apparait dans la colonne Â«Â Fin importÂ Â» de la liste des imports, alors lâimport est terminÃ©.</p>
<p><strong>Suppression dâun import</strong> La suppression dâun import implique : la supression de lâimport (lâobjet) et <strong>les donnÃ©es importÃ©es dans la table transitoire</strong>. Si lâimport est terminÃ©, les donnÃ©es importÃ©es dans la destination sont supprimÃ©es. Dans le cas dâune destination avec plusieurs entitÃ©s, si lâentitÃ© mÃ¨re est associÃ©e Ã  des entitÃ©s filles ajoutÃ©es en dehors de lâimport (un habitat est rajoutÃ© sur un station importÃ©e par exemple), la supression est bloquÃ©e.</p>
<p><strong>Modification dâun import</strong> Lors de la modification dâun import, vous serez redirigez vers lâÃ©tape de Â«Â Correspondances de champsÂ Â». Si vous modifiez la correspondance des champs en cliquant sur Â«Â SuivantÂ Â», cela entrainera la suppression des donnÃ©es dans la table transitoire et dans la destination si lâimport est terminÃ©.</p>
</section>
<section id="controles-de-donnees">
<h3>ContrÃ´les de donnÃ©es<a class="headerlink" href="#controles-de-donnees" title="Lien vers cette rubrique">Â¶</a></h3>
<p><strong>Erreurs</strong></p>
<p>Le tableau ci-dessous liste les codes dâerreur et leur description.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Code Erreur</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DATASET_NOT_FOUND</p></td>
<td><p>Lâidentifiant ne correspond Ã  aucun jeu de donnÃ©es existant.</p></td>
</tr>
<tr class="row-odd"><td><p>DATASET_NOT_AUTHORIZED</p></td>
<td><p>Lâutilisateur ne peut pas importer de nouvelles entitÃ©s dans le jeu de donnÃ©es.</p></td>
</tr>
<tr class="row-even"><td><p>DATASET_NOT_ACTIVE</p></td>
<td><p>Aucune donnÃ©e ne peut Ãªtre importÃ©e dans le JDD indiquÃ© car il nâest pas actif.</p></td>
</tr>
<tr class="row-odd"><td><p>MULTIPLE_ATTACHMENT_TYPE_CODE</p></td>
<td><p>Plusieurs gÃ©orÃ©fÃ©rencements sont indiquÃ©s dans les colonnes : codeCommune, codeMaille, codeDÃ©partement (Erreur SynthÃ¨se)</p></td>
</tr>
<tr class="row-even"><td><p>MULTIPLE_CODE_ATTACHMENT</p></td>
<td><p>Plusieurs codes de rattachement fournis pour une mÃªme ligne. Une ligne doit avoir un seul code rattachement (code commune OU code maille OU code dÃ©partement)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_DATE</p></td>
<td><p>Format de date invalide (Voir formats de date autorisÃ©s)</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_UUID</p></td>
<td><p>Format de lâidentifiant donnÃ© ne respecte pas le format UUID (<a class="reference external" href="https://fr.wikipedia.org/wiki/Universally_unique_identifier">https://fr.wikipedia.org/wiki/Universally_unique_identifier</a>)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_INTEGER</p></td>
<td><p>La donnÃ©e indiquÃ©e ne correspond pas un nombre entier.</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_NUMERIC</p></td>
<td><p>La donnÃ©e indiquÃ©e ne correspond pas Ã  un nombre rÃ©el (float)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_WKT</p></td>
<td><p>La donnÃ©e indiquÃ©e ne respecte pas le format WKT <a class="reference external" href="https://fr.wikipedia.org/wiki/Well-known_text">https://fr.wikipedia.org/wiki/Well-known_text</a></p></td>
</tr>
<tr class="row-even"><td><p>INVALID_GEOMETRY</p></td>
<td><p>La gÃ©omÃ©trie de la donnÃ©e renseignÃ©e est invalide (c.fÂ  ST_VALID)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_BOOL</p></td>
<td><p>La donnÃ©e fournie nâest pas un boolÃ©en</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_ATTACHMENT_CODE</p></td>
<td><p>Le code commune/maille/dÃ©partement indiquÃ© ne fait pas partie du rÃ©fÃ©rentiel des gÃ©ographique.</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_CHAR_LENGTH</p></td>
<td><p>La chaine de caractÃ¨re de la donnÃ©e est trop longue</p></td>
</tr>
<tr class="row-even"><td><p>DATE_MIN_TOO_HIGH</p></td>
<td><p>La date de dÃ©but est dans le futur</p></td>
</tr>
<tr class="row-odd"><td><p>DATE_MAX_TOO_LOW</p></td>
<td><p>La date de fin est infÃ©rieure Ã  1900</p></td>
</tr>
<tr class="row-even"><td><p>DATE_MAX_TOO_HIGH</p></td>
<td><p>La date de fin est dans le futur</p></td>
</tr>
<tr class="row-odd"><td><p>DATE_MIN_TOO_LOW</p></td>
<td><p>La date de dÃ©but est infÃ©rieure Ã  1900</p></td>
</tr>
<tr class="row-even"><td><p>DATE_MIN_SUP_DATE_MAX</p></td>
<td><p>La date de dÃ©but est supÃ©rieure Ã  la date de fin</p></td>
</tr>
<tr class="row-odd"><td><p>DEPTH_MIN_SUP_ALTI_MAX</p></td>
<td><p>La profondeur minimum est supÃ©rieure Ã  la profondeur maximale</p></td>
</tr>
<tr class="row-even"><td><p>ALTI_MIN_SUP_ALTI_MAX</p></td>
<td><p>Lâaltitude minimum est supÃ©rieure Ã  lâaltitude maximale</p></td>
</tr>
<tr class="row-odd"><td><p>ORPHAN_ROW</p></td>
<td><p>La ligne du fichier nâa pÃ» Ãªtre rattachÃ©e Ã  aucune entitÃ©.</p></td>
</tr>
<tr class="row-even"><td><p>DUPLICATE_ROWS</p></td>
<td><p>Deux lignes du fichier sont identiquesÂ ; les lignes ne peuvent pas Ãªtre dupliquÃ©es.</p></td>
</tr>
<tr class="row-odd"><td><p>DUPLICATE_UUID</p></td>
<td><p>Lâidentifiant UUID dâune entitÃ© nâest pas unique dans le fichier fournis</p></td>
</tr>
<tr class="row-even"><td><p>EXISTING_UUID</p></td>
<td><p>Lâidentifiant UUID dâune entitÃ© fournie existe dÃ©jÃ  dans la base de donnÃ©es. Il faut en fournir un autre ou laisser la valeur vide pour une attribution automatique.</p></td>
</tr>
<tr class="row-odd"><td><p>SKIP_EXISTING_UUID</p></td>
<td><p>Les entitÃ©s existantes selon UUID sont ignorÃ©es.</p></td>
</tr>
<tr class="row-even"><td><p>MISSING_VALUE</p></td>
<td><p>Valeur manquante dans un champs obligatoire</p></td>
</tr>
<tr class="row-odd"><td><p>MISSING_GEOM</p></td>
<td><p>GÃ©orÃ©fÃ©rencement manquant ; un gÃ©orÃ©fÃ©rencement doit Ãªtre fourni, câest Ã  dire quâil faut livrer : soit une gÃ©omÃ©trie, soit une ou plusieurs commune(s), ou dÃ©partement(s), ou maille(s), dont le champ âtypeInfoGeoâ est indiquÃ© Ã  1.</p></td>
</tr>
<tr class="row-even"><td><p>GEOMETRY_OUTSIDE</p></td>
<td><p>La gÃ©omÃ©trie se trouve Ã  lâextÃ©rieur du territoire renseignÃ©</p></td>
</tr>
<tr class="row-odd"><td><p>NO-GEOM</p></td>
<td><p>Aucune gÃ©ometrie fournie (ni X/Y, WKT ou code)</p></td>
</tr>
<tr class="row-even"><td><p>GEOMETRY_OUT_OF_BOX</p></td>
<td><p>CoordonnÃ©es gÃ©ographiques en dehors du pÃ©rimÃ¨tre gÃ©ographique de lâinstance</p></td>
</tr>
<tr class="row-odd"><td><p>ERRONEOUS_PARENT_ENTITY</p></td>
<td><p>LâentitÃ© parente est en erreur.</p></td>
</tr>
<tr class="row-even"><td><p>NO_PARENT_ENTITY</p></td>
<td><p>Aucune entitÃ© parente identifiÃ©e.</p></td>
</tr>
<tr class="row-odd"><td><p>DUPLICATE_ENTITY_SOURCE_PK</p></td>
<td><p>Deux lignes du fichier ont la mÃªme clÃ© primaire dâorigineÂ ; les clÃ©s primaires du fichier source ne peuvent pas Ãªtre dupliquÃ©es.</p></td>
</tr>
<tr class="row-even"><td><p>COUNT_MIN_SUP_COUNT_MAX</p></td>
<td><p>IncohÃ©rence entre les champs dÃ©nombrement. La valeur de denombrement_min est supÃ©rieure Ã  celle de denombrement_max ou la valeur de denombrement_max est infÃ©rieure Ã  denombrement_min.</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_NOMENCLATURE</p></td>
<td><p>Code nomenclature erronÃ© ; La valeur du champ nâest pas dans la liste des codes attendus pour ce champ. Pour connaÃ®tre la liste des codes autorisÃ©s, reportez-vous au Standard en cours.</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_EXISTING_PROOF_VALUE</p></td>
<td><p>IncohÃ©rence entre les champs de preuve ; si le champ âpreuveExistanteâ vaut oui, alors lâun des deux champs âpreuveNumÃ©riqueâ ou âpreuveNonNumÃ©riqueâ doit Ãªtre rempli. A lâinverse, si lâun de ces deux champs est rempli, alors âpreuveExistanteâ ne doit pas prendre une autre valeur que Â«Â ouiÂ Â» (code 1).</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_NOMENCLATURE_WARNING</p></td>
<td><p>(Non bloquant) Code nomenclature erronÃ© et remplacÃ© par sa valeur par dÃ©faut ; La valeur du champ nâest pas dans la liste des codes attendus pour ce champ. Pour connaÃ®tre la liste des codes autorisÃ©s, reportez-vous au Standard en cours.</p></td>
</tr>
<tr class="row-even"><td><p>CONDITIONAL_MANDATORY_FIELD_ERROR</p></td>
<td><p>Champs obligatoires conditionnels manquants. Il existe des ensembles de champs liÃ©s Ã  un concept qui sont âobligatoires conditionnelsâ, câest Ã  dire que si lâun des champs du concept est utilisÃ©, alors dâautres champs du concept deviennent obligatoires.</p></td>
</tr>
<tr class="row-odd"><td><p>UNKNOWN_ERROR</p></td>
<td><p>Erreur inconnue</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_STATUT_SOURCE_VALUE</p></td>
<td><p>RÃ©fÃ©rence bibliographique manquante ; si le champ âstatutSourceâ a la valeur âLiâ (LittÃ©rature), alors une rÃ©fÃ©rence bibliographique doit Ãªtre indiquÃ©e.</p></td>
</tr>
<tr class="row-odd"><td><p>CONDITIONAL_INVALID_DATA</p></td>
<td><p>Erreur de valeur</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_URL_PROOF</p></td>
<td><p>PreuveNumerique nâest pas une url ; le champ âpreuveNumÃ©riqueâ indique lâadresse web Ã  laquelle on pourra trouver la preuve numÃ©rique ou lâarchive contenant toutes les preuves numÃ©riques. Il doit commencer par â<a class="reference external" href="http://">http://</a>â, â<a class="reference external" href="https://">https://</a>â, ou â<a class="reference external" href="ftp://">ftp://</a>â.</p></td>
</tr>
<tr class="row-odd"><td><p>ROW_HAVE_TOO_MUCH_COLUMN</p></td>
<td><p>Une ligne du fichier source a plus de colonnes que lâen-tÃªte.</p></td>
</tr>
<tr class="row-even"><td><p>ROW_HAVE_LESS_COLUMN</p></td>
<td><p>Une ligne du fichier source a moins de colonnes que lâen-tÃªte.</p></td>
</tr>
<tr class="row-odd"><td><p>EMPTY_ROW</p></td>
<td><p>Une ligne dans le fichier source est vide</p></td>
</tr>
<tr class="row-even"><td><p>HEADER_SAME_COLUMN_NAME</p></td>
<td><p>Au moins deux colonnes du fichier source possÃ¨dent des noms identiques</p></td>
</tr>
<tr class="row-odd"><td><p>EMPTY_FILE</p></td>
<td><p>Le fichier source est vide</p></td>
</tr>
<tr class="row-even"><td><p>NO_FILE_SENDED</p></td>
<td><p>Aucun fichier source nâa Ã©tÃ© tÃ©lÃ©versÃ©.</p></td>
</tr>
<tr class="row-odd"><td><p>ERROR_WHILE_LOADING_FILE</p></td>
<td><p>Une erreur sâest produite lors du chargement du fichier.</p></td>
</tr>
<tr class="row-even"><td><p>FILE_FORMAT_ERROR</p></td>
<td><p>Le format du fichier est incorrect.</p></td>
</tr>
<tr class="row-odd"><td><p>FILE_EXTENSION_ERROR</p></td>
<td><p>Lâextension de fichier source est incorrect</p></td>
</tr>
<tr class="row-even"><td><p>FILE_OVERSIZE</p></td>
<td><p>Volume du fichier source est trop important</p></td>
</tr>
<tr class="row-odd"><td><p>FILE_NAME_TOO_LONG</p></td>
<td><p>Nom du fichier de donnÃ©es trop long</p></td>
</tr>
<tr class="row-even"><td><p>FILE_WITH_NO_DATA</p></td>
<td><p>Pas de donnÃ©es dans le fichier source</p></td>
</tr>
<tr class="row-odd"><td><p>INCOHERENT_DATA</p></td>
<td><p>Une mÃªme entitÃ© est dÃ©clarÃ© avec diffÃ©rents attributs dans le fichier source</p></td>
</tr>
<tr class="row-even"><td><p>CD_HAB_NOT_FOUND</p></td>
<td><p>CdHab nâexiste pas dans le rÃ©fÃ©rentiel Habref installÃ©</p></td>
</tr>
<tr class="row-odd"><td><p>CD_NOM_NOT_FOUND</p></td>
<td><p>CdNom nâexiste pas dans le rÃ©fÃ©rentiel TaxRef installÃ©</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Format de dates autorisÃ©es</strong></p>
<p>Date :</p>
<ul class="simple">
<li><p>YYYY-MM-DD</p></li>
<li><p>DD-MM-YYYY</p></li>
<li><p>YYYY/MM/DD</p></li>
<li><p>DD/MM/YYYY</p></li>
</ul>
<p>HeureÂ :</p>
<ul class="simple">
<li><p>H</p></li>
<li><p>H-M</p></li>
<li><p>H-M-S</p></li>
<li><p>H-M-S</p></li>
<li><p>H:M</p></li>
<li><p>H:M:S</p></li>
<li><p>H:M:S</p></li>
<li><p>Hh</p></li>
<li><p>HhM</p></li>
<li><p>HhMm</p></li>
<li><p>HhMmSs</p></li>
</ul>
</section>
<section id="configuration-avancee">
<h3>Configuration avancÃ©e<a class="headerlink" href="#configuration-avancee" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Une autre partie de la configuration se fait directement dans la base de donnÃ©es, dans les tables <code class="docutils literal notranslate"><span class="pre">bib_fields</span></code>, <code class="docutils literal notranslate"><span class="pre">bib_themes</span></code> et <code class="docutils literal notranslate"><span class="pre">cor_entity_field</span></code>.</p>
<p>Dans <code class="docutils literal notranslate"><span class="pre">bib_fields</span></code>, il est possible de :</p>
<ul class="simple">
<li><p>Ajouter de nouveau(x) champ(s) pour une entitÃ© (e.g. Station) dans une destination (e.g. Occhab).</p></li>
<li><p>Masquer des champs existants. Pour cela, modifier la valeur de lâattribut <code class="docutils literal notranslate"><span class="pre">display</span></code> dâun champ.</p></li>
<li><p>Rendre obligatoire un champ. Pour cela, modifier la valeur de lâattribut <code class="docutils literal notranslate"><span class="pre">mandatory</span></code> dâun champ.</p></li>
<li><p>Rendre obligatoire/optionnel un champ si dâautres champs sont remplis. Voir les champs <code class="docutils literal notranslate"><span class="pre">optional_conditions</span></code> et <code class="docutils literal notranslate"><span class="pre">mandatory_conditions</span></code>.</p></li>
</ul>
<p>Dans la table <code class="docutils literal notranslate"><span class="pre">cor_entity_field</span></code> :</p>
<ul class="simple">
<li><p>ParamÃ¨trer lâordre des champs dans lâinterface du mapping de champs. Voir le champ <code class="docutils literal notranslate"><span class="pre">order_field</span></code>.</p></li>
<li><p>Changer le _tooltip_ dâun champ. Voir le champ <code class="docutils literal notranslate"><span class="pre">comment</span></code>.</p></li>
<li><p>Regrouper des champs dans <strong>thÃ¨mes</strong> (voir <code class="docutils literal notranslate"><span class="pre">bib_themes</span></code>) Ã  lâaide du champs <code class="docutils literal notranslate"><span class="pre">id_theme</span></code>.</p></li>
</ul>
</section>
<section id="controle-de-donnees-dans-les-destinations-venant-avec-geonature">
<span id="controle-donnees"></span><h3>ContrÃ´le de donnÃ©es dans les destinations venant avec GeoNature<a class="headerlink" href="#controle-de-donnees-dans-les-destinations-venant-avec-geonature" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Dans cette section, nous prÃ©sentons les contrÃ´les de donnÃ©es effectuÃ©es pour les destinations intÃ©grÃ©es dans GeoNatureÂ : SynthÃ¨se, Occhab.
Lâordre des contrÃ´les dans ces listes correspond bien Ã  celui du processus dÃ©fini dans le code de GeoNature.
De maniÃ¨re gÃ©nÃ©rale, nous sÃ©parons les contrÃ´les de donnÃ©es en deux catÃ©gories, ceux effectuÃ©s en BDD avec PostgreSQL et ceux effectuÃ©e en Python Ã  lâaide des DataFrame (donnÃ©e tableau)</p>
<p><strong>Listes des contrÃ´les pour Occhab</strong></p>
<ol class="arabic simple">
<li><p>[SQL][Station]</p>
<ol class="arabic simple">
<li><p>VÃ©rification de la cohÃ©rence des donnÃ©es des stations dÃ©clarÃ©es</p></li>
</ol>
</li>
<li><p>[DataFrame][Station]</p>
<ol class="arabic simple">
<li><p>VÃ©rification de lâexistence de donnÃ©es pour les champs obligatoires</p></li>
<li><p>VÃ©rification de la concordance entre le type dâun champ et la donnÃ©es</p></li>
<li><p>VÃ©rification du jeu de donnÃ©es</p></li>
<li><p>VÃ©rification des gÃ©omÃ©tries prÃ©sentes dans les donnÃ©es (WKT ou latitude/longitude)</p></li>
</ol>
</li>
<li><p>[DataFrame][Habitat]</p>
<ol class="arabic simple">
<li><p>VÃ©rification de lâexistence de donnÃ©es pour les champs obligatoires</p></li>
<li><p>VÃ©rification de la concordance entre le type dâun champ et la donnÃ©es</p></li>
</ol>
</li>
<li><p>[SQL][Station]</p>
<ol class="arabic simple">
<li><p>Mapping des valeurs de nomenclatures</p></li>
<li><p>Conversion des donnÃ©es de gÃ©omÃ©trie dans le SRID de la BDD</p></li>
<li><p>VÃ©rification de la cohÃ©rence des donnÃ©es altitudinale, de profondeur et les dates</p></li>
<li><p>VÃ©rification de la validitÃ© des gÃ©omÃ©tries</p></li>
</ol>
</li>
<li><p>[SQL][Habitat]</p>
<ol class="arabic simple">
<li><p>Mapping des valeurs de nomenclatures</p></li>
<li><p>VÃ©rification des cdHab</p></li>
<li><p>VÃ©rification des UUID (doublons dans le fichier, existence dans la destination)</p></li>
<li><p>GÃ©nÃ©rer les UUID si manquante</p></li>
<li><p>Dans le cas dâhabitats importÃ©s sur une station existante, vÃ©rifier les droits de lâutilisateur sur cette derniÃ¨re.</p></li>
</ol>
</li>
</ol>
<p><strong>Listes des contrÃ´les pour la SynthÃ¨se</strong></p>
<ol class="arabic simple">
<li><p>[DataFrame]</p>
<ol class="arabic simple">
<li><p>VÃ©rification de lâexistence de donnÃ©es pour les champs obligatoires</p></li>
<li><p>VÃ©rification de la concordance entre le type dâun champ et la donnÃ©e</p></li>
</ol>
</li>
<li><p>[SQL]</p>
<ol class="arabic simple">
<li><p>VÃ©rification du jeu de donnÃ©es</p></li>
<li><p>VÃ©rification des gÃ©omÃ©tries prÃ©sentes dans les donnÃ©es (WKT ou latitude/longitude)</p></li>
<li><p>VÃ©rification des donnÃ©es de dÃ©nombrement</p></li>
<li><p>Mapping des nomenclatures</p></li>
<li><p>VÃ©rification de lâexistence des identifiants cdNom dans Taxref local</p></li>
<li><p>VÃ©rification de lâexistence des identifiants cdHab dans Habref local</p></li>
<li><p>VÃ©rification de la cohÃ©rence des donnÃ©es altitudinale, de profondeur et les dates</p></li>
<li><p>VÃ©rification des preuves numÃ©riques</p></li>
<li><p>VÃ©rification de lâintersection entre chaque gÃ©omÃ©trie et la gÃ©omÃ©trie de la zone autorisÃ©e.</p></li>
</ol>
</li>
</ol>
</section>
<section id="modele-de-donnees">
<h3>ModÃ¨le de donnÃ©es<a class="headerlink" href="#modele-de-donnees" title="Lien vers cette rubrique">Â¶</a></h3>
<p>Le diagramme ci-dessous prÃ©sente le schÃ©ma de la base de donnÃ©es du module Import.</p>
<img alt="_images/import_modele.png" src="_images/import_modele.png" />
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="development.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">DÃ©veloppement</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="user-manual.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Manuel utilisateur</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2018-2024, Parc National des Ãcrins, Parc National des CÃ©vennes
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Manuel administrateur</a><ul>
<li><a class="reference internal" href="#architecture">Architecture</a></li>
<li><a class="reference internal" href="#base-de-donnees">Base de donnÃ©es</a><ul>
<li><a class="reference internal" href="#administration-avec-alembic">Administration avec Alembic</a><ul>
<li><a class="reference internal" href="#description-des-branches">Description des branches</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gestion-des-droits">Gestion des droits</a><ul>
<li><a class="reference internal" href="#acces-a-geonature-et-cruved">AccÃ¨s Ã  GeoNature et CRUVED</a></li>
<li><a class="reference internal" href="#cas-particulier-de-l-action-c">Cas particulier de lâaction Â«Â CÂ Â»</a></li>
<li><a class="reference internal" href="#permissions-d-administrateur">Permissions dâadministrateur</a></li>
<li><a class="reference internal" href="#recapitulatif">RÃ©capitulatif</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nomenclatures">Nomenclatures</a></li>
<li><a class="reference internal" href="#metadonnees">MÃ©tadonnÃ©es</a></li>
<li><a class="reference internal" href="#donnees-sig">DonnÃ©es SIG</a></li>
<li><a class="reference internal" href="#profils-de-taxons">Profils de taxons</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#configuration-et-parametrage">Configuration et paramÃ©trage</a></li>
<li><a class="reference internal" href="#calcul-des-phenologies">Calcul des phÃ©nologies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fonctions">Fonctions</a></li>
<li><a class="reference internal" href="#tables-transversales">Tables transversales</a></li>
<li><a class="reference internal" href="#triggers-vers-la-synthese">Triggers vers la synthÃ¨se</a></li>
<li><a class="reference internal" href="#triggers-dans-la-synthese">Triggers dans la synthÃ¨se</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modularite">ModularitÃ©</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a><ul>
<li><a class="reference internal" href="#configuration-generale-de-l-application">Configuration gÃ©nÃ©rale de lâapplication</a></li>
<li><a class="reference internal" href="#configuration-d-un-gn-module">Configuration dâun gn_module</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exploitation">Exploitation</a><ul>
<li><a class="reference internal" href="#logs">Logs</a></li>
<li><a class="reference internal" href="#commandes-geonature">Commandes GeoNature</a></li>
<li><a class="reference internal" href="#demarrer-arreter-les-api">DÃ©marrer / arrÃªter les API</a></li>
<li><a class="reference internal" href="#supervision-des-services">Supervision des services</a></li>
<li><a class="reference internal" href="#maintenance">Maintenance</a></li>
<li><a class="reference internal" href="#parametres-gunicorn">ParamÃ¨tres Gunicorn</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sauvegarde-et-restauration">Sauvegarde et restauration</a><ul>
<li><a class="reference internal" href="#sauvegarde">Sauvegarde</a></li>
<li><a class="reference internal" href="#restauration">Restauration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customisation">Customisation</a><ul>
<li><a class="reference internal" href="#integrer-son-logo">IntÃ©grer son logo</a></li>
<li><a class="reference internal" href="#customiser-le-contenu">Customiser le contenu</a></li>
<li><a class="reference internal" href="#customiser-la-page-de-connexion">Customiser la page de connexion</a></li>
<li><a class="reference internal" href="#customiser-l-aspect-esthetique">Customiser lâaspect esthÃ©tique</a></li>
<li><a class="reference internal" href="#customiser-les-noms-et-pictos-des-modules">Customiser les noms et pictos des modules</a></li>
<li><a class="reference internal" href="#customiser-les-exports-pdf">Customiser les exports PDF</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integrer-des-donnees">IntÃ©grer des donnÃ©es</a><ul>
<li><a class="reference internal" href="#referentiel-geographique">RÃ©fÃ©rentiel gÃ©ographique</a></li>
<li><a class="reference internal" href="#affichage-des-referentiels-geographiques-dans-geonature">Affichage des rÃ©fÃ©rentiels gÃ©ographiques dans GeoNature</a></li>
<li><a class="reference internal" href="#donnees-externes">DonnÃ©es externes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authentification">Authentification</a><ul>
<li><a class="reference internal" href="#demande-de-creation-de-compte">Demande de crÃ©ation de compte</a><ul>
<li><a class="reference internal" href="#customisation-du-formulaire">Customisation du formulaire</a></li>
</ul>
</li>
<li><a class="reference internal" href="#espace-utilisateur">Espace utilisateur</a></li>
<li><a class="reference internal" href="#acces-public">AccÃ¨s public</a><ul>
<li><a class="reference internal" href="#acces-public-automatique">AccÃ¨s public automatique</a></li>
</ul>
</li>
<li><a class="reference internal" href="#se-connecter-a-d-autres-fournisseurs-d-identites">Se connecter Ã  dâautres fournisseurs dâidentitÃ©s</a><ul>
<li><a class="reference internal" href="#ajouter-un-nouveau-fournisseur-d-identite">Ajouter un nouveau fournisseur dâidentitÃ©</a></li>
<li><a class="reference internal" href="#se-connecter-a-un-autre-geonature">Se connecter Ã  un autre GeoNature</a></li>
<li><a class="reference internal" href="#creer-son-propre-module-de-connexion">CrÃ©er son propre module de connexion</a></li>
<li><a class="reference internal" href="#desactiver-l-authentification-par-defaut">DÃ©sactiver lâauthentification par dÃ©faut</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#gestion-de-la-sensibilite">Gestion de la sensibilitÃ©</a><ul>
<li><a class="reference internal" href="#id1">Introduction</a><ul>
<li><a class="reference internal" href="#criteres-de-sensibilite">CritÃ¨res de sensibilitÃ©</a></li>
<li><a class="reference internal" href="#niveaux-de-sensibilite">Niveaux de sensibilitÃ©</a></li>
<li><a class="reference internal" href="#pour-plus-d-informations">Pour plus dâinformations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integration-dans-geonature">IntÃ©gration dans GeoNature</a><ul>
<li><a class="reference internal" href="#stockage-des-regles-en-base">Stockage des rÃ¨gles en base</a></li>
<li><a class="reference internal" href="#attribution-aux-observations-de-la-synthese">Attribution aux observations de la synthÃ¨se</a></li>
<li><a class="reference internal" href="#gestion-du-referentiel">Gestion du rÃ©fÃ©rentiel</a></li>
<li><a class="reference internal" href="#personnalisation">Personnalisation</a></li>
<li><a class="reference internal" href="#utilisation">Utilisation</a><ul>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#traitement-des-problematiques-lies-aux-zonages">Traitement des problÃ©matiques liÃ©s aux zonages</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-occtax">Module OCCTAX</a><ul>
<li><a class="reference internal" href="#installer-le-module">Installer le module</a></li>
<li><a class="reference internal" href="#configuration-du-module">Configuration du module</a><ul>
<li><a class="reference internal" href="#afficher-masquer-des-champs-du-formulaire">Afficher/masquer des champs du formulaire</a></li>
<li><a class="reference internal" href="#modifier-le-champ-observateurs">Modifier le champ Observateurs</a></li>
<li><a class="reference internal" href="#personnaliser-la-liste-des-taxons-et-habitats-saisissables-dans-le-module">Personnaliser la liste des taxons et habitats saisissables dans le module</a></li>
<li><a class="reference internal" href="#gerer-les-valeurs-par-defaut-des-nomenclatures">GÃ©rer les valeurs par dÃ©faut des nomenclatures</a></li>
<li><a class="reference internal" href="#personnaliser-l-interface-map-list">Personnaliser lâinterface Map-list</a></li>
<li><a class="reference internal" href="#ajouter-une-contrainte-d-echelle-de-saisie-sur-la-carte">Ajouter une contrainte dâÃ©chelle de saisie sur la carte</a></li>
<li><a class="reference internal" href="#supprimer-le-remplissage-automatique-de-la-date">Supprimer le remplissage automatique de la date</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gestion-des-exports">Gestion des exports</a></li>
<li><a class="reference internal" href="#attribuer-des-permissions">Attribuer des permissions</a></li>
<li><a class="reference internal" href="#dupliquer-le-module-occtax">Dupliquer le module Occtax</a><ul>
<li><a class="reference internal" href="#associer-des-jeux-de-donnees-et-des-champs-additionnels">Associer des jeux de donnÃ©es et des champs additionnels</a></li>
<li><a class="reference internal" href="#ajouter-le-nouveau-module-dans-la-liste-des-modules-implementes">Ajouter le nouveau module dans la liste des modules implÃ©mentÃ©s</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-admin">Module Admin</a><ul>
<li><a class="reference internal" href="#administration-des-champs-additionnels">Administration des champs additionnels</a><ul>
<li><a class="reference internal" href="#configuration-avancee-des-champs">Configuration avancÃ©e des champs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#taxhub">TaxHub</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-occhab">Module OCCHAB</a><ul>
<li><a class="reference internal" href="#id2">Installer le module</a></li>
<li><a class="reference internal" href="#id3">Base de donnÃ©es</a></li>
<li><a class="reference internal" href="#id4">Configuration</a><ul>
<li><a class="reference internal" href="#formulaire">Formulaire</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-synthese">Module SYNTHESE</a><ul>
<li><a class="reference internal" href="#id5">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-validation">Module VALIDATION</a><ul>
<li><a class="reference internal" href="#id6">Configuration</a><ul>
<li><a class="reference internal" href="#liste-des-champs-visibles">Liste des champs visibles</a></li>
<li><a class="reference internal" href="#e-mail">E-mail</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validation-automatique">Validation automatique</a><ul>
<li><a class="reference internal" href="#activation">Activation</a></li>
<li><a class="reference internal" href="#conditions-de-validation-automatique">Conditions de validation automatique</a></li>
<li><a class="reference internal" href="#modification-de-la-periodicite-de-la-validation-automatique">Modification de la pÃ©riodicitÃ© de la validation automatique</a></li>
<li><a class="reference internal" href="#modification-de-la-fonction-de-validation-automatique">Modification de la fonction de validation automatique</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-taxhub">Module TaxHub</a><ul>
<li><a class="reference internal" href="#gestion-des-permissions">Gestion des permissions</a></li>
<li><a class="reference internal" href="#commandes-taxhub">Commandes TaxHub</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-import">Module Import</a><ul>
<li><a class="reference internal" href="#concepts">Concepts</a></li>
<li><a class="reference internal" href="#faire-un-import-le-minimum-requis">Faire un import, le minimum requis</a></li>
<li><a class="reference internal" href="#deroulement-dun-import">DÃ©roulement dâun import</a></li>
<li><a class="reference internal" href="#configuration-du-module-dimport">Configuration du module dâimport</a></li>
<li><a class="reference internal" href="#permissions-de-limport">Permissions de lâimport</a></li>
<li><a class="reference internal" href="#modification-et-suppression-d-un-import">Modification et Suppression dâun import</a></li>
<li><a class="reference internal" href="#controles-de-donnees">ContrÃ´les de donnÃ©es</a></li>
<li><a class="reference internal" href="#configuration-avancee">Configuration avancÃ©e</a></li>
<li><a class="reference internal" href="#controle-de-donnees-dans-les-destinations-venant-avec-geonature">ContrÃ´le de donnÃ©es dans les destinations venant avec GeoNature</a></li>
<li><a class="reference internal" href="#modele-de-donnees">ModÃ¨le de donnÃ©es</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=7e9e99ef"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/translations.js?v=041d0952"></script>
    </body>
</html>