<div class="row">
  <div
    *ngIf="occtaxConfig.form_fields.obj_count"
    class="col-lg-4 col-sm-6"
  >
    <pnx-nomenclature
      label="{{ 'Counting.CountingObject' | translate }}"
      codeNomenclatureType="OBJ_DENBR"
      [parentFormControl]="form.get('id_nomenclature_obj_count')"
      [regne]="(occtaxFormOccurrenceService.taxref|async)?.regne"
      [group2Inpn]="(occtaxFormOccurrenceService.taxref|async)?.group2_inpn">
    </pnx-nomenclature>
  </div>
  <div
    *ngIf="occtaxConfig.form_fields.type_count"
    class="col-lg-4 col-sm-6"
  >
    <pnx-nomenclature
      #typeDenombrement
      label="{{ 'Counting.CountingType' | translate }}"
      codeNomenclatureType="TYP_DENBR"
      [parentFormControl]="form.get('id_nomenclature_type_count')"
      [regne]="(occtaxFormOccurrenceService.taxref|async)?.regne"
      [group2Inpn]="(occtaxFormOccurrenceService.taxref|async)?.group2_inpn">
    </pnx-nomenclature>
  </div>

</div>
<small
  *ngIf="form.get('id_nomenclature_obj_count').hasError('required') && form.get('id_nomenclature_obj_count').touched"
  class="error"
  style="color:red"
>
  {{'Counting.Errors.CountingObjectRequiredError' |translate}}
</small>

<div class="row">

  <div 
    *ngIf="occtaxConfig.form_fields.count_min" 
    class="col-3"
  >
    <small> {{ 'Counting.NumberMin' | translate }} </small>
    <input
      data-qa="counting-count-min"
      class="form-control form-control-sm"
      type="number"
      min="0"
      [ngClass]="{'is-invalid': form.hasError('invalidCount')}"
      [formControl]="form.get('count_min')"
    >
  </div>

  <div 
    *ngIf="occtaxConfig.form_fields.count_max" 
    class="col-3"
  >
    <small> {{ 'Counting.NumberMax' | translate }} </small>
    <input
      data-qa="counting-count-max"
      class="form-control form-control-sm"
      type="number"
      min="0"
      [ngClass]="{'is-invalid': form.hasError('invalidCount')}"
      [formControl]="form.get('count_max')"
    >
    <small
      *ngIf="form.hasError('invalidCount')"
      class="error"
      style="color:red"
    >
      {{ 'Counting.Errors.CountError' | translate }}
    </small>
  </div>

  <div
    *ngIf="occtaxConfig.form_fields.life_stage"
    class="col-3"
  >
    <pnx-nomenclature
      label="{{ 'Counting.LifeStage' | translate }}"
      codeNomenclatureType="STADE_VIE"
      [parentFormControl]="form.get('id_nomenclature_life_stage')"
      [regne]="(occtaxFormOccurrenceService.taxref|async)?.regne"
      [group2Inpn]="(occtaxFormOccurrenceService.taxref|async)?.group2_inpn">
    </pnx-nomenclature>
    <small
      *ngIf="form.get('id_nomenclature_life_stage').hasError('required') && form.get('id_nomenclature_life_stage').touched"
      class="error"
      style="color:red"
    >
      {{'Counting.Errors.LifeStageRequiredError' |translate}}
    </small>
  </div>
  <div
    *ngIf="occtaxConfig.form_fields.sex"
    class="col-3"
  >
    <pnx-nomenclature
      label="{{ 'Counting.Sex' | translate }}"
      codeNomenclatureType="SEXE"
      [parentFormControl]="form.get('id_nomenclature_sex')"
      [regne]="(occtaxFormOccurrenceService.taxref|async)?.regne"
      [group2Inpn]="(occtaxFormOccurrenceService.taxref|async)?.group2_inpn">
    </pnx-nomenclature>
    <small
      *ngIf="form.get('id_nomenclature_sex').hasError('required') && form.get('id_nomenclature_sex').touched"
      class="error"
      style="color:red"
    >
      {{'Counting.Errors.SexRequiredError' |translate}}
    </small>
  </div>
</div>
<div class="row col-sm-12">

  <pnx-dynamic-form-generator
    [autoGenerated]="true"
    [myFormGroup]="form.get('additional_fields')"
    [formsDefinition]="additionalFieldsForm"
  >
  </pnx-dynamic-form-generator>
</div>

<div class="row">
  <div 
    id='occurrence-medias' 
    *ngIf="occtaxConfig.ENABLE_MEDIAS" 
    class="col-sm-12"
  >

    <h6 style="margin-top: 15px;">
      <span
        [matBadge]="(form.value.medias || []).length"
        matBadgeOverlap="false"
        class="color-add-media"
      >
        {{'Media.Medias' |translate}}
      </span>
    </h6>
    <pnx-medias
      schemaDotTable="pr_occtax.cor_counting_occtax"
      [parentFormControl]="form.controls.medias"
      [sizeMax]="appConfig.MEDIAS.MEDIAS_SIZE_MAX"
      [default]="defaultsMedia()"
      [details]="occtaxConfig.MEDIA_FIELDS_DETAILS"
      [disabled]="!taxref"
      disabledTxt="Veuillez choisir un taxon avant de renseigner les mÃ©dias"
    ></pnx-medias>
  </div>
</div>