"""[import] Remove id_habitat field

Revision ID: bd73fa82a3f4
Revises: 35bf3f4a80f1
Create Date: 2025-09-17 15:31:03.322596

"""

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = "bd73fa82a3f4"
down_revision = "35bf3f4a80f1"
branch_labels = None
depends_on = None


def upgrade():
    op.execute(
        """
        delete
        from
            gn_imports.bib_fields
        where
            name_field = 'id_habitat'
            and id_destination = (
            select
                id_destination
            from
                gn_imports.bib_destinations
            where
                code = 'occhab' );
        """
    )


def downgrade():
    op.execute(
        """
        insert
            into
            gn_imports.bib_fields(
            name_field,
            fr_label,
            display,
            source_field,
            dest_field,
            id_destination,mandatory,autogenerated)
            select
            'id_habitat',
            'Identifiant Habitat',
            true,
            'src_id_habitat',
            'id_habitat',
            bd.id_destination,false,false
        from
            gn_imports.bib_destinations bd
        where
            bd.code = 'occhab'
        limit 1;
        """
    )
