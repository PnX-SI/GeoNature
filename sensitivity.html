<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestion de la sensibilité &mdash; GeoNature 2.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="index.html" class="icon icon-home"> GeoNature
            <img src="_static/LogoGeonature.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">INSTALLATION</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-manual.html">MANUEL UTILISATEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin-manual.html">MANUEL ADMINISTRATEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="import-level-1.html">IMPORT NIVEAU 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="import-level-2.html">IMPORT NIVEAU 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">DEVELOPPEMENT</a></li>
<li class="toctree-l1"><a class="reference internal" href="versions-compatibility.html">COMPATIBILITE</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">AUTEURS</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">CHANGELOG</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GeoNature</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Gestion de la sensibilité</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/sensitivity.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="gestion-de-la-sensibilite">
<h1>Gestion de la sensibilité<a class="headerlink" href="#gestion-de-la-sensibilite" title="Permalink to this headline"></a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p>Les régles de sensibilité définies par défaut sont issues des règles du SINP.
Elles dépendent de l’espèce et de l’observation. C’est-à-dire que pour une espèce donnée,
plusieurs niveaux de sensibilité sont possibles selon l’observation.</p>
<div class="section" id="niveaux-de-sensibilite">
<h3>Niveaux de sensibilité<a class="headerlink" href="#niveaux-de-sensibilite" title="Permalink to this headline"></a></h3>
<p>Voici les 5 niveaux de sensibilité définis par le SINP :</p>
<ul class="simple">
<li><p>Sensible - Aucune diffusion</p></li>
<li><p>Sensible - Diffusion au département</p></li>
<li><p>Sensible - Diffusion à la maille 10km</p></li>
<li><p>Sensible - Diffusion à la Commune ou Znieff</p></li>
<li><p>Non sensible - Diffusion précise</p></li>
</ul>
<p>Dans certains cas, des demandes consistent à rendre l’entiereté des observations
d’une espèce (et donc une espèce) sensible.
Cette documentation propose une méthode pour y arriver dans l’outil GeoNature.</p>
</div>
<div class="section" id="pour-plus-d-informations">
<h3>Pour plus d’informations<a class="headerlink" href="#pour-plus-d-informations" title="Permalink to this headline"></a></h3>
<p>Vous pouvez consulter :</p>
<ul class="simple">
<li><p>La page du site du <a class="reference external" href="https://inpn.mnhn.fr/programme/donnees-observations-especes/references/sensibilite">MNHN traitant de la sensibilité</a>.</p></li>
<li><p>Le rapport de 2020 sur <a class="reference external" href="https://inpn.mnhn.fr/docs-web/docs/download/355449">La sensibilité des données du système  d’information  de l’inventaire  du  patrimoine naturel : méthodes, pratiques et usages (J. Ichter et S. Robert)</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="attention">
<h2>Attention<a class="headerlink" href="#attention" title="Permalink to this headline"></a></h2>
<p>L’objectif de ce document n’est pas de modifier les règles établies par
le SINP. Il est donc conseillé de respecter ces règles définies au niveau
régional et national et donc de ne pas ajouter de règles locales.</p>
</div>
<div class="section" id="integration-dans-geonature">
<h2>Intégration dans GeoNature<a class="headerlink" href="#integration-dans-geonature" title="Permalink to this headline"></a></h2>
<div class="section" id="schema-gn-synthese">
<h3>Schéma gn_synthese<a class="headerlink" href="#schema-gn-synthese" title="Permalink to this headline"></a></h3>
<p>A chaque insertion d’une donnée dans la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code>,
un trigger (<code class="docutils literal notranslate"><span class="pre">tri_insert_calculate_sensitivity</span></code>) fait appel à une
fonction (<code class="docutils literal notranslate"><span class="pre">fct_tri_cal_sensi_diff_level_on_each_statement</span></code>) qui appelle
elle-même les fonctions (<code class="docutils literal notranslate"><span class="pre">get_id_nomenclature_sensitivity</span></code> et
<code class="docutils literal notranslate"><span class="pre">calculate_cd_diffusion_level</span></code>) du schéma <code class="docutils literal notranslate"><span class="pre">gn_sensitivity</span></code> pour le
calcul de la sensibilité.</p>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">get_id_nomenclature_sensitivity</span></code> calcule le niveau de
sensibilité en fonction de l’espèce, du type de sensibilité, de la durée
de validité, de la période d’observation et du statut biologique.
La fonction <code class="docutils literal notranslate"><span class="pre">calculate_cd_diffusion_level</span></code> calcule le niveau de diffusion.
Actuellement, ce calcul est une simple copie du niveau de sensibilité.</p>
</div>
<div class="section" id="schema-gn-sensitivity">
<h3>Schéma gn_sensitivity<a class="headerlink" href="#schema-gn-sensitivity" title="Permalink to this headline"></a></h3>
<p>3 tables sont utilisées par ces fonctions :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code> qui relie notamment une espèce à un niveau de
sensibilité</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code> qui permet d’appliquer ce niveau de
sensibilité en fonction d’un critère (par défaut, biologique)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cor_sensitivity_area</span></code> qui permet d’appliquer un niveau de
sensibilité en fonction de la zone géographique (pas encore abordée
ici)</p></li>
</ul>
<p>S’il n’y a aucune entrée dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code>, le niveau de
sensibilité défini dans <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code> est directement appliqué.</p>
</div>
</div>
<div class="section" id="personnalisation">
<h2>Personnalisation<a class="headerlink" href="#personnalisation" title="Permalink to this headline"></a></h2>
<p>Pour l’instant, seule la personnalisation de la sensibilité pour
une espèce donnée (peu importe l’observation) est abordée ici.</p>
<div class="section" id="sensibilite-de-l-espece-toute-observation-confondue">
<h3>Sensibilité de l’espèce toute observation confondue<a class="headerlink" href="#sensibilite-de-l-espece-toute-observation-confondue" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>Dans <code class="docutils literal notranslate"><span class="pre">gn_sensitivity.t_sensitivity_rules</span></code> : Changez le niveau de
sensibilité <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code> par celui désiré. Pour la
valeur à renseigner, voir dans <code class="docutils literal notranslate"><span class="pre">t_nomenclature</span></code> en filtrant avec
<code class="docutils literal notranslate"><span class="pre">id_type=ref_nomenclatures.get_id_nomenclature_type('SENSIBILITE')</span></code>. En général l’identifiant varie entre 65 (non sensible) et 69
(aucune diffusion). Attention ces identifiants peuvent varier en fonction de
votre installation.</p></li>
<li><p>Dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code> : s’il y a une correspondance
d’<code class="docutils literal notranslate"><span class="pre">id_sensitivity</span></code> avec <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code>, supprimez cette ligne.</p></li>
<li><p>Lancez la commande SQL suivante :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">REFRESH</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="n">gn_sensitivity</span><span class="p">.</span><span class="n">t_sensitivity_rules_cd_ref</span><span class="p">;</span>
</pre></div>
</div>
<p>Pour rafraîchir la vue materialisée utilisée par les fonctions
appelées par le trigger de <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code>.</p>
</li>
<li><p>Il est maintenant nécessaire de mettre à jour les lignes concernant
la sensibilité de vos anciennes observations dans la synthèse en
déclenchant le trigger de calcul de la sensibilité. Or ce dernier est
appelé uniquement lors d’un <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> ou d’un <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>. Il est alors
possible de faire un <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> sans changer les données en lançant la
commande SQL suivante :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">gn_synthese</span><span class="p">.</span><span class="n">synthese</span>
<span class="k">SET</span> <span class="n">cd_nom</span><span class="o">=</span><span class="n">cd_nom</span>
<span class="k">WHERE</span> <span class="n">cd_nom</span><span class="o">=</span><span class="p">:</span><span class="n">cd_nom_de_votre_espece</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Note</strong> : Il n’est pas possible de définir la sensibilité à <em>NULL</em> dans
cet <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> sinon le trigger ne se déclenchera pas.</p>
<p><strong>Note 2</strong> : Si vous avez modifié plusieurs espèces à la fois, modifiez
le <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> avec un <code class="docutils literal notranslate"><span class="pre">IN</span></code> ainsi qu’un <code class="docutils literal notranslate"><span class="pre">ARRAY</span></code> contenant tous les cd_nom
de vos espèces.</p>
<p>Normalement, les valeurs dans les colonnes
<code class="docutils literal notranslate"><span class="pre">id_nomenclature_diffusion_level</span></code> et <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code> de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code> ont
changé. Vous pouvez le vérifier en navigant dans le module Synthèse
puis dans les détails d’une observation de votre/vos espèce(s).</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2019, PnE, PnC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>